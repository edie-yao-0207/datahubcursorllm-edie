{
  "dashboard": {
    "name": "Eco Driving Segmented Events Dashboard",
    "default_date_range": "30d"
  },
  "parameters": {
    "event_type": {
      "type": "multi_select",
      "default": "ALL"
    }
  },
  "datasets": {
    "lookup_event_types": "queries/lookups/event_types.sql"
  },
  "global_filters": [
    {
      "name": "date",
      "type": "date_range",
      "title": "Date Range",
      "width": 2,
      "default": { "min": "-30d", "max": "today" }
    },
    {
      "type": "parameter",
      "name": "event_type",
      "title": "Event Type",
      "lookup_dataset": "lookup_event_types",
      "lookup_field": "event_type",
      "width": 2,
      "datasets": ["device_count_by_event_type", "data_health_by_event_type", "duration_distribution"]
    }
  ],
  "tabs": [
    {
      "name": "Overview",
      "description": "High-level summary of Eco Driving segmented events across all event types",
      "widgets": [
        {
          "type": "text",
          "content": "## Eco Driving Segmented Events Overview\n\nThis dashboard monitors Eco Driving segmented events from kinesisstats. Events are generated when the vehicle exhibits specific driving behaviors:\n\n- **Cruise Control**: Vehicle using cruise control\n- **Hard Acceleration**: Aggressive acceleration events\n- **Overspeed**: Vehicle exceeding speed thresholds\n- **Coasting**: Vehicle coasting (fuel-efficient driving)\n- **Wear-Free Braking**: Regenerative or engine braking events\n\nUse the date range filter to adjust the time window.",
          "width": 6,
          "height": 3
        },
        {
          "sql": "queries/overview/total_events_by_type.sql",
          "type": "counter",
          "title": "Total Events (All Types)",
          "description": "Total count of all eco driving segmented events",
          "width": 2,
          "height": 2,
          "config": {
            "value_field": "total_events"
          }
        },
        {
          "sql": "queries/overview/unique_devices_total.sql",
          "type": "counter",
          "title": "Unique Devices",
          "description": "Total unique devices reporting eco driving events",
          "width": 2,
          "height": 2,
          "config": {
            "value_field": "unique_devices"
          }
        },
        {
          "sql": "queries/overview/valid_event_rate.sql",
          "type": "counter",
          "title": "Valid Event Rate",
          "description": "Percentage of events with valid proto_value",
          "width": 2,
          "height": 2,
          "config": {
            "value_field": "valid_rate_pct",
            "format": "percentage",
            "decimals": 1
          }
        },
        {
          "sql": "queries/overview/events_by_type_summary.sql",
          "type": "bar",
          "title": "Events by Type",
          "description": "Total event count breakdown by eco driving event type",
          "width": 3,
          "height": 6,
          "config": {
            "x_axis": "event_type",
            "y_fields": ["event_count"],
            "y_label": "Event Count"
          }
        },
        {
          "sql": "queries/overview/devices_by_type_summary.sql",
          "type": "bar",
          "title": "Unique Devices by Type",
          "description": "Unique device count breakdown by eco driving event type",
          "width": 3,
          "height": 6,
          "config": {
            "x_axis": "event_type",
            "y_fields": ["unique_devices"],
            "y_label": "Unique Devices"
          }
        },
        {
          "sql": "queries/overview/daily_device_trend.sql",
          "type": "line",
          "title": "Daily Unique Devices by Event Type",
          "description": "Daily trend of unique devices reporting each event type",
          "width": 6,
          "height": 6,
          "config": {
            "x_axis": "event_date",
            "y_fields": ["unique_devices"],
            "y_label": "Unique Devices",
            "color_by": "event_type"
          }
        },
        {
          "sql": "queries/overview/daily_event_trend.sql",
          "type": "line",
          "title": "Daily Event Count by Type",
          "description": "Daily trend of event counts by type",
          "width": 6,
          "height": 6,
          "config": {
            "x_axis": "event_date",
            "y_fields": ["event_count"],
            "y_label": "Event Count",
            "color_by": "event_type"
          }
        },
        {
          "sql": "queries/overview/avg_events_per_device_chart.sql",
          "type": "line",
          "title": "Avg Events per Device Over Time",
          "description": "Daily average events per device for each event type - normalized view of device activity over time",
          "width": 6,
          "height": 6,
          "config": {
            "x_axis": "event_date",
            "y_fields": ["avg_events_per_device"],
            "y_label": "Avg Events per Device",
            "color_by": "event_type"
          }
        },
        {
          "sql": "queries/overview/avg_events_per_device_chart.sql",
          "type": "line",
          "title": "P95 Events per Device Over Time",
          "description": "Daily P95 events per device for each event type - shows high-activity device behavior over time",
          "width": 6,
          "height": 6,
          "config": {
            "x_axis": "event_date",
            "y_fields": ["p95_events_per_device"],
            "y_label": "P95 Events per Device",
            "color_by": "event_type"
          }
        },
        {
          "sql": "queries/overview/avg_events_per_device_chart.sql",
          "type": "line",
          "title": "P99 Events per Device Over Time",
          "description": "Daily P99 events per device for each event type - shows extreme high-activity device behavior over time",
          "width": 6,
          "height": 6,
          "config": {
            "x_axis": "event_date",
            "y_fields": ["p99_events_per_device"],
            "y_label": "P99 Events per Device",
            "color_by": "event_type"
          }
        },
        {
          "sql": "queries/overview/normalized_events_per_device.sql",
          "type": "table",
          "title": "Normalized Events per Device - Detailed Statistics",
          "description": "Comprehensive per-device event statistics: device count, total events, avg/median/P95/P99 events per device, and min/max",
          "width": 6,
          "height": 6,
          "config": {
            "items_per_page": 10,
            "columns": {
              "event_type": { "format": "text" },
              "device_count": { "format": "number", "decimals": 0 },
              "total_events": { "format": "number", "decimals": 0 },
              "avg_events_per_device": { "format": "number", "decimals": 2 },
              "median_events_per_device": { "format": "number", "decimals": 2 },
              "p95_events_per_device": { "format": "number", "decimals": 2 },
              "p99_events_per_device": { "format": "number", "decimals": 2 },
              "min_events_per_device": { "format": "number", "decimals": 0 },
              "max_events_per_device": { "format": "number", "decimals": 0 }
            }
          }
        }
      ]
    },
    {
      "name": "Data Health",
      "description": "Data quality metrics - invalid rows, missing proto_value, and data breaks",
      "widgets": [
        {
          "type": "text",
          "content": "## Data Health Metrics\n\nThis tab monitors the health and validity of eco driving event data.\n\n**Invalid Rows**: Events where `proto_value IS NULL` and `is_databreak = FALSE` (or NULL). These represent events that failed to deserialize or have missing data.\n\n**Data Breaks**: Events where `is_databreak = TRUE`. These represent intentional gaps in data collection.\n\n**Valid Events**: Events with non-null `proto_value` that can be used for analysis.",
          "width": 6,
          "height": 3
        },
        {
          "sql": "queries/data_health/health_summary_by_type.sql",
          "type": "table",
          "title": "Data Health Summary by Event Type",
          "description": "Summary of total rows, valid rows, invalid rows, and percentages per event type",
          "width": 6,
          "height": 6,
          "config": {
            "items_per_page": 10,
            "columns": {
              "event_type": { "format": "text" },
              "total_rows": { "format": "number", "decimals": 0 },
              "valid_rows": { "format": "number", "decimals": 0 },
              "invalid_rows": { "format": "number", "decimals": 0 },
              "percent_valid": { "format": "percentage", "decimals": 2 },
              "percent_invalid": { "format": "percentage", "decimals": 2 }
            }
          }
        },
        {
          "sql": "queries/data_health/daily_invalid_rate.sql",
          "type": "line",
          "title": "Daily Invalid Rate by Event Type",
          "description": "Daily percentage of invalid rows per event type",
          "width": 6,
          "height": 6,
          "config": {
            "x_axis": "event_date",
            "y_fields": ["percent_invalid"],
            "y_label": "Invalid Rate (%)",
            "color_by": "event_type"
          }
        },
        {
          "sql": "queries/data_health/daily_valid_count.sql",
          "type": "line",
          "title": "Daily Valid Event Count by Type",
          "description": "Daily count of valid events per type",
          "width": 6,
          "height": 6,
          "config": {
            "x_axis": "event_date",
            "y_fields": ["valid_rows"],
            "y_label": "Valid Event Count",
            "color_by": "event_type"
          }
        }
      ]
    },
    {
      "name": "Duration Analysis",
      "description": "Analysis of event duration distributions",
      "widgets": [
        {
          "type": "text",
          "content": "## Duration Analysis\n\nThis tab analyzes the duration distribution of eco driving segmented events.\n\nDuration is extracted from `obd_segmented_event.duration_ms` and converted to seconds. Events are bucketed into 0.5-second intervals for histogram analysis.",
          "width": 6,
          "height": 2
        },
        {
          "sql": "queries/duration/duration_stats_by_type.sql",
          "type": "table",
          "title": "Duration Statistics by Event Type",
          "description": "Min, max, average, median, and percentile duration statistics per event type",
          "width": 6,
          "height": 5,
          "config": {
            "items_per_page": 10,
            "columns": {
              "event_type": { "format": "text" },
              "event_count": { "format": "number", "decimals": 0 },
              "min_duration_s": { "format": "number", "decimals": 2 },
              "max_duration_s": { "format": "number", "decimals": 2 },
              "avg_duration_s": { "format": "number", "decimals": 2 },
              "approx_median_duration_s": { "format": "number", "decimals": 2 },
              "approx_p95_duration_s": { "format": "number", "decimals": 2 }
            }
          }
        },
        {
          "sql": "queries/duration/duration_histogram_cruise_control.sql",
          "type": "bar",
          "title": "Duration Distribution - Cruise Control",
          "description": "Distribution of avg durations per device for Cruise Control (0.5s buckets)",
          "width": 3,
          "height": 5,
          "config": {
            "x_axis": "duration_bucket_s",
            "y_fields": ["device_count"],
            "y_label": "Device Count"
          }
        },
        {
          "sql": "queries/duration/duration_histogram_hard_acceleration.sql",
          "type": "bar",
          "title": "Duration Distribution - Hard Acceleration",
          "description": "Distribution of avg durations per device for Hard Acceleration (0.5s buckets)",
          "width": 3,
          "height": 5,
          "config": {
            "x_axis": "duration_bucket_s",
            "y_fields": ["device_count"],
            "y_label": "Device Count"
          }
        },
        {
          "sql": "queries/duration/duration_histogram_overspeed.sql",
          "type": "bar",
          "title": "Duration Distribution - Overspeed",
          "description": "Distribution of avg durations per device for Overspeed (0.5s buckets)",
          "width": 3,
          "height": 5,
          "config": {
            "x_axis": "duration_bucket_s",
            "y_fields": ["device_count"],
            "y_label": "Device Count"
          }
        },
        {
          "sql": "queries/duration/duration_histogram_coasting.sql",
          "type": "bar",
          "title": "Duration Distribution - Coasting",
          "description": "Distribution of avg durations per device for Coasting (0.5s buckets)",
          "width": 3,
          "height": 5,
          "config": {
            "x_axis": "duration_bucket_s",
            "y_fields": ["device_count"],
            "y_label": "Device Count"
          }
        },
        {
          "sql": "queries/duration/duration_histogram_wear_free_braking.sql",
          "type": "bar",
          "title": "Duration Distribution - Wear-Free Braking",
          "description": "Distribution of avg durations per device for Wear-Free Braking (0.5s buckets)",
          "width": 3,
          "height": 5,
          "config": {
            "x_axis": "duration_bucket_s",
            "y_fields": ["device_count"],
            "y_label": "Device Count"
          }
        }
      ]
    },
    {
      "name": "Comparison",
      "description": "Cross-event-type comparison and summary statistics",
      "widgets": [
        {
          "type": "text",
          "content": "## Event Type Comparison\n\nThis tab provides a unified view comparing all 5 eco driving event types:\n- **CruiseControl**\n- **HardAcceleration**\n- **OverSpeed**\n- **Coasting**\n- **WearFreeBraking**\n\nUse this to identify which event types have the most volume, best data quality, and typical duration characteristics.",
          "width": 6,
          "height": 2
        },
        {
          "sql": "queries/comparison/full_comparison_summary.sql",
          "type": "table",
          "title": "Full Event Type Comparison",
          "description": "Comprehensive comparison of all event types including volume, data quality, and duration metrics",
          "width": 6,
          "height": 8,
          "config": {
            "items_per_page": 10,
            "columns": {
              "event_type": { "format": "text" },
              "total_rows": { "format": "number", "decimals": 0 },
              "valid_rows": { "format": "number", "decimals": 0 },
              "invalid_rows": { "format": "number", "decimals": 0 },
              "percent_valid": { "format": "percentage", "decimals": 2 },
              "unique_devices": { "format": "number", "decimals": 0 },
              "avg_duration_s": { "format": "number", "decimals": 2 },
              "median_duration_s": { "format": "number", "decimals": 2 },
              "percent_of_total": { "format": "percentage", "decimals": 2 }
            }
          }
        },
        {
          "sql": "queries/comparison/valid_vs_invalid_stacked.sql",
          "type": "bar",
          "title": "Valid vs Invalid Rows by Event Type",
          "description": "Stacked bar showing valid and invalid rows for each event type",
          "width": 6,
          "height": 6,
          "config": {
            "x_axis": "event_type",
            "y_fields": ["valid_rows", "invalid_rows"],
            "y_label": "Row Count",
            "stacked": true
          }
        }
      ]
    }
  ]
}

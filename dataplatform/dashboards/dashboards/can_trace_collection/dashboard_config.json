{
  "dashboard": {
    "name": "CAN Trace Collection Dashboard",
    "default_date_range": "90d"
  },
  "global_filters": [
    {
      "name": "date",
      "type": "date_range",
      "title": "Date Range",
      "width": 2,
      "default": { "min": "-90d", "max": "today" }
    }
  ],
  "tabs": [
    {
      "name": "Overview",
      "widgets": [
        {
          "type": "text",
          "content": "## Overview\n\nHigh-level KPIs showing overall progress and last 90 days trends. All-time and quarter metrics are fixed snapshots (not affected by date filter).",
          "width": 6,
          "height": 2
        },
        {
          "sql": "queries/overview/kpi_snapshot.sql",
          "type": "counter",
          "title": "Total Candidates Generated",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "total_candidates",
            "row_number": 1
          }
        },
        {
          "sql": "queries/overview/kpi_snapshot.sql",
          "type": "counter",
          "title": "Total Traces Collected",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "total_collected",
            "row_number": 1
          }
        },
        {
          "sql": "queries/overview/kpi_snapshot.sql",
          "type": "counter",
          "title": "Active MMYEFs",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "active_mmyefs",
            "row_number": 1
          }
        },
        {
          "sql": "queries/overview/kpi_snapshot.sql",
          "type": "counter",
          "title": "MMYEFs with Traces",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "mmyefs_with_traces",
            "row_number": 1
          }
        },
        {
          "sql": "queries/overview/kpi_snapshot.sql",
          "type": "counter",
          "title": "Unique Devices",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "unique_devices",
            "row_number": 1
          }
        },
        {
          "sql": "queries/overview/kpi_snapshot.sql",
          "type": "counter",
          "title": "MMYEF Diversity Coverage",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "quota_fulfillment_rate",
            "row_number": 1,
            "format": "percent"
          }
        },
        {
          "type": "text",
          "content": "## Last 90 Days",
          "width": 6,
          "height": 1
        },
        {
          "sql": "queries/overview/kpi_snapshot.sql",
          "type": "counter",
          "title": "Total Candidates Generated",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "total_candidates_quarter",
            "row_number": 1
          }
        },
        {
          "sql": "queries/overview/kpi_snapshot.sql",
          "type": "counter",
          "title": "Total Traces Collected",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "total_collected_quarter",
            "row_number": 1
          }
        },
        {
          "sql": "queries/overview/kpi_snapshot.sql",
          "type": "counter",
          "title": "Active MMYEFs",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "active_mmyefs_quarter",
            "row_number": 1
          }
        },
        {
          "sql": "queries/overview/kpi_snapshot.sql",
          "type": "counter",
          "title": "MMYEFs with Traces",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "mmyefs_with_traces_quarter",
            "row_number": 1
          }
        },
        {
          "sql": "queries/overview/kpi_snapshot.sql",
          "type": "counter",
          "title": "Unique Devices",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "unique_devices_quarter",
            "row_number": 1
          }
        },
        {
          "sql": "queries/overview/kpi_snapshot.sql",
          "type": "counter",
          "title": "MMYEF Diversity Coverage",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "quota_fulfillment_rate_quarter",
            "row_number": 1,
            "format": "percent"
          }
        },
        {
          "sql": "queries/overview/quarter_candidates_generated_trend.sql",
          "type": "line",
          "title": "Candidates Generated Over Time (Last 90 Days)",
          "width": 6,
          "height": 5,
          "config": {
            "x_axis": "date",
            "y_fields": ["candidates_generated"],
            "y_label": "Candidates"
          }
        },
        {
          "sql": "queries/overview/quarter_traces_collected_trend.sql",
          "type": "line",
          "title": "Traces Collected Over Time (Last 90 Days)",
          "width": 6,
          "height": 5,
          "config": {
            "x_axis": "date",
            "y_fields": ["traces_collected"],
            "y_label": "Traces"
          }
        },
        {
          "sql": "queries/overview/quarter_candidates_by_type.sql",
          "type": "area",
          "title": "Candidates by Query Type (Last 90 Days)",
          "width": 6,
          "height": 5,
          "config": {
            "x_axis": "date",
            "y_fields": ["candidate_count"],
            "y_label": "Candidates",
            "color_by": "query_type",
            "stacked": true
          }
        }
      ]
    },
    {
      "name": "By Population",
      "widgets": [
        {
          "type": "text",
          "content": "## By Population\n\nGeneral population coverage metrics (MMYEF and Device coverage, collection distribution, diversity). No tag breakdown - this is overall population health.",
          "width": 6,
          "height": 2
        },
        {
          "sql": "queries/diversity/diversity_snapshot.sql",
          "type": "counter",
          "title": "Unique MMYEFs with Traces",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "unique_mmyefs",
            "row_number": 1
          }
        },
        {
          "sql": "queries/diversity/diversity_snapshot.sql",
          "type": "counter",
          "title": "Unique Devices with Traces",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "unique_devices",
            "row_number": 1
          }
        },
        {
          "sql": "queries/diversity/diversity_snapshot.sql",
          "type": "counter",
          "title": "MMYEF Coverage %",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "mmyef_coverage_pct",
            "row_number": 1,
            "format": "percent",
            "decimal_places": 1
          }
        },
        {
          "sql": "queries/diversity/diversity_snapshot.sql",
          "type": "counter",
          "title": "Device Coverage %",
          "width": 1,
          "height": 2,
          "config": {
            "value_field": "device_coverage_pct",
            "row_number": 1,
            "format": "percent",
            "decimal_places": 1
          }
        },
        {
          "sql": "queries/diversity/collection_distribution.sql",
          "type": "bar",
          "title": "Collection Distribution (Traces per MMYEF)",
          "width": 6,
          "height": 6,
          "config": {
            "x_axis": "trace_count_bucket",
            "y_fields": ["mmyef_count"],
            "y_label": "MMYEF Count"
          }
        },
        {
          "sql": "queries/diversity/top_mmyefs.sql",
          "type": "table",
          "title": "Top MMYEFs by Collection Count",
          "width": 3,
          "height": 6,
          "config": {
            "items_per_page": 25
          }
        },
        {
          "sql": "queries/diversity/underrepresented_mmyefs.sql",
          "type": "table",
          "title": "Underrepresented MMYEFs (0 Traces)",
          "width": 3,
          "height": 6,
          "config": {
            "items_per_page": 25
          }
        }
      ]
    },
    {
      "name": "By Tag",
      "widgets": [
        {
          "type": "text",
          "content": "## By Tag\n\nTag-focused collection metrics with device and MMYEF coverage per tag. Shows coverage trends, candidates generated, quota fulfillment, and performance summaries.",
          "width": 6,
          "height": 2
        },
        {
          "sql": "queries/tag/device_coverage_per_tag.sql",
          "type": "line",
          "title": "Device Coverage % by Tag Over Time",
          "width": 6,
          "height": 5,
          "config": {
            "x_axis": "date",
            "y_fields": ["coverage_pct"],
            "y_label": "Coverage %",
            "y_format": "percent",
            "color_by": "tag_name"
          }
        },
        {
          "sql": "queries/overview/coverage_percentage_by_tag.sql",
          "type": "line",
          "title": "MMYEF Coverage % by Tag Over Time",
          "width": 6,
          "height": 5,
          "config": {
            "x_axis": "date",
            "y_fields": ["coverage_pct"],
            "y_label": "Coverage %",
            "y_format": "percent",
            "color_by": "tag_name"
          }
        },
        {
          "sql": "queries/candidates/daily_candidates_by_type.sql",
          "type": "line",
          "title": "Candidates Generated by Tag Over Time",
          "width": 6,
          "height": 5,
          "config": {
            "x_axis": "date",
            "y_fields": ["candidate_count"],
            "y_label": "Candidates",
            "color_by": "query_type"
          }
        },
        {
          "sql": "queries/tag_performance/tag_performance_summary.sql",
          "type": "table",
          "title": "Tag Performance Summary",
          "width": 6,
          "height": 6,
          "config": {
            "items_per_page": 20,
            "columns": {
              "mmyef_coverage_pct": { "format": "percent", "decimals": 2 },
              "quota_fulfillment_rate": { "format": "percent", "decimals": 2 }
            }
          }
        },
        {
          "sql": "queries/tag/device_diversity_per_tag.sql",
          "type": "table",
          "title": "Device Diversity Per Tag",
          "width": 3,
          "height": 6,
          "config": {
            "items_per_page": 10,
            "columns": {
              "device_coverage_pct": { "format": "percent", "decimals": 2 }
            }
          }
        },
        {
          "sql": "queries/diversity/mmyef_diversity_per_tag.sql",
          "type": "table",
          "title": "MMYEF Diversity Per Tag",
          "width": 3,
          "height": 6,
          "config": {
            "items_per_page": 10,
            "columns": {
              "mmyef_coverage_pct": { "format": "percent", "decimals": 2 }
            }
          }
        },
        {
          "sql": "queries/quota/quota_fulfillment_by_type.sql",
          "type": "bar",
          "title": "Quota Fulfillment by Tag",
          "width": 6,
          "height": 5,
          "config": {
            "x_axis": "query_type",
            "y_fields": ["fulfillment_rate"],
            "y_label": "Fulfillment Rate",
            "y_format": "percent"
          }
        },
        {
          "sql": "queries/tag_performance/tag_performance_detail.sql",
          "type": "table",
          "title": "Tag Performance Detail (by MMYEF)",
          "width": 6,
          "height": 8,
          "config": {
            "items_per_page": 100,
            "columns": {
              "quota_progress": { "format": "percent", "decimals": 1 }
            }
          }
        },
        {
          "sql": "queries/candidates/top_candidates.sql",
          "type": "table",
          "title": "Top Candidates by Rank",
          "width": 6,
          "height": 6,
          "config": {
            "items_per_page": 25
          }
        },
        {
          "sql": "queries/candidates/ranking_distribution.sql",
          "type": "bar",
          "title": "Ranking Distribution (Top 100 Ranks)",
          "width": 3,
          "height": 5,
          "config": {
            "x_axis": "rank_bucket",
            "y_fields": ["candidate_count"],
            "y_label": "Candidates"
          }
        },
        {
          "sql": "queries/candidates/candidate_counts_summary.sql",
          "type": "table",
          "title": "Candidate Counts by Query Type (Latest Date)",
          "width": 3,
          "height": 5,
          "config": {
            "items_per_page": 10
          }
        }
      ]
    },
    {
      "name": "By Tag + Stream",
      "widgets": [
        {
          "type": "text",
          "content": "## By Tag + Stream\n\nTraining-specific stream ID metrics. Stream IDs represent training data needs (tied to OBD values) and show collection progress for specific signal types.",
          "width": 6,
          "height": 2
        },
        {
          "sql": "queries/stream_ids/stream_id_coverage_snapshot.sql",
          "type": "counter",
          "title": "Stream ID Coverage Snapshot",
          "width": 3,
          "height": 2,
          "config": {
            "value_field": "total_stream_ids",
            "row_number": 1
          }
        },
        {
          "sql": "queries/stream_ids/stream_id_coverage_snapshot.sql",
          "type": "counter",
          "title": "Stream IDs with Sufficient Data",
          "width": 3,
          "height": 2,
          "config": {
            "value_field": "percent_sufficient",
            "row_number": 1,
            "format": "percent",
            "decimal_places": 1
          }
        },
        {
          "sql": "queries/stream_ids/stream_id_coverage_table.sql",
          "type": "table",
          "title": "Stream ID Coverage by MMYEF",
          "width": 6,
          "height": 8,
          "config": {
            "items_per_page": 50
          }
        },
        {
          "sql": "queries/stream_ids/training_candidates_by_stream_id.sql",
          "type": "table",
          "title": "Training Candidates by Stream ID",
          "width": 6,
          "height": 8,
          "config": {
            "items_per_page": 50
          }
        },
        {
          "sql": "queries/tag_performance/training_needs_by_tag.sql",
          "type": "table",
          "title": "Training Needs by Tag (Stream IDs)",
          "width": 6,
          "height": 6,
          "config": {
            "items_per_page": 50
          }
        }
      ]
    },
    {
      "name": "Prioritized Traces",
      "widgets": [
        {
          "type": "text",
          "content": "## Prioritized Traces\n\nMost recent required traces from fct_can_traces_required, prioritized by device_day_rank (1 = highest priority). These are the traces that the cron job will attempt to collect.",
          "width": 6,
          "height": 2
        },
        {
          "sql": "queries/prioritized/latest_prioritized_traces.sql",
          "type": "table",
          "title": "Latest Prioritized Traces",
          "width": 6,
          "height": 10,
          "config": {
            "items_per_page": 100
          }
        }
      ]
    }
  ]
}

# Databricks notebook source
# MAGIC %run /backend/safety/speed_limits/utils_calling_conventions

# COMMAND ----------

# MAGIC %sql
# MAGIC SET
# MAGIC   spark.sql.broadcastTimeout = 100000;
# MAGIC SET
# MAGIC   spark.sql.autoBroadcastJoinThreshold = -1;

# COMMAND ----------

# MAGIC %run /backend/safety/speed_limits/map_match_utils

# COMMAND ----------

"""
This notebook takes in the following args:
* ARG_OSM_REGIONS_VERSION_MAP:
JSON dict from region -> version_id
"""
dbutils.widgets.text(ARG_OSM_REGIONS_VERSION_MAP, "")
osm_regions_to_version = dbutils.widgets.get(ARG_OSM_REGIONS_VERSION_MAP)
if len(osm_regions_to_version) > 0:
    osm_regions_to_version = json.loads(osm_regions_to_version)
else:
    osm_regions_to_version = {}
print(f"{ARG_OSM_REGIONS_VERSION_MAP}: {osm_regions_to_version}")

"""
* ARG_TOMTOM_VERSION:
Must be specified
Pass in "YYYYMMDD" to return skip downloading and return an older version.
"""
dbutils.widgets.text(ARG_TOMTOM_VERSION, "")
tomtom_version = dbutils.widgets.get(ARG_TOMTOM_VERSION)
print(f"{ARG_TOMTOM_VERSION}: {tomtom_version}")

DEFAULT_REGIONS = [CAN, EUR, MEX, USA]

"""
* ARG_REGIONS:
Pass in "" to generate for DEFAULT_REGIONS
Pass in a comma-separated list of regions (ex: "EUR,USA")
"""
dbutils.widgets.text(ARG_REGIONS, serialize_regions(DEFAULT_REGIONS))
desired_regions = dbutils.widgets.get(ARG_REGIONS)
if len(desired_regions) == 0:
    desired_regions = DEFAULT_REGIONS
else:
    desired_regions = deserialize_regions(desired_regions)
print(f"{ARG_REGIONS}: {desired_regions}")

# COMMAND ----------

from typing import List, Tuple

import h3
import numpy as np
from pyspark.sql.functions import (
    col,
    size,
    avg,
    max,
    sum,
    least,
    lit,
    first,
    explode,
    collect_list,
)
from pyspark.sql.types import ArrayType, IntegerType, MapType, StringType
import shapely
from shapely import (  # This import is required for shapely.geometry refs to work.
    geometry,
    wkt,
)


@udf
def get_line_string(node_list: List) -> str:
    """get_line_string takes a list of lat/lon nodes and outputs a wkt linestring."""
    pts = [(node.ind, node.latitude, node.longitude) for node in node_list]
    pts_sorted = sorted(pts, key=lambda x: x[0])
    point_list = [shapely.geometry.linestring.Point(pt[2], pt[1]) for pt in pts_sorted]
    return str(shapely.geometry.linestring.LineString(point_list).wkt)


def line_string_linear_interp(points_wkt: str, step: float = 0.00008) -> str:
    """Linear interpolates points within a line string, adding a new
    point at increments specified by step. This works by linearly
    interpolating both the x and y coordinates for each pair of points.
    We use this to ensure that sparse linestrings are able to nicely map
    into a sequence of h3 buckets.

    The default step of 0.00008 roughly corresponds to 8.88m when working with
    lat/lng coordinates. With an h3 resolution of 13, this is slightly
    more than double the hexagon edge length.

    Linear interpolation error increases closer to the poles since straight
    lines don't align well with more curved areas of the earth. However,
    since the distances between two adjacent point is so small interpolation
    error is negligible.
    """
    geom = shapely.wkt.loads(points_wkt)
    x = np.array(geom.xy[0])
    y = np.array(geom.xy[1])

    xvals = []
    yvals = []

    for i in range(len(x) - 1):
        # Determine how many additional points to add. We want at least one
        # point per incremental step. To meet this requirement, take the larger
        # of the number of points interpolation is required in either x or y.
        point_count = int(
            np.max(
                [
                    np.round(np.abs((x[i + 1] - x[i])) / step),
                    np.round(np.abs((y[i + 1] - y[i])) / step),
                ]
            )
        )
        if point_count <= 1:
            point_count = 2

        # Exclude the endpoint since it will be added in the next iteration
        # due to the pairwise loop.
        seg_x_vals = np.linspace(x[i], x[i + 1], point_count, endpoint=False)
        seg_y_vals = np.linspace(y[i], y[i + 1], point_count, endpoint=False)
        xvals.extend(seg_x_vals)
        yvals.extend(seg_y_vals)

    # Add the very last point since it was excluded.
    xvals.append(x[-1])
    yvals.append(y[-1])

    points = np.array((xvals, yvals)).T
    return str(shapely.geometry.LineString(points))


line_string_linear_interp_udf = udf(line_string_linear_interp, StringType())


def line_string_to_h3_str(geom: str, res: int) -> List[str]:
    """Converts points in a linestring to a series of h3 buckets for map-matching."""
    h3_indices = set()
    geom = shapely.wkt.loads(geom)
    for (lng, lat) in geom.coords[:]:
        h3_idx = h3.latlng_to_cell(lat, lng, res)
        h3_indices.add(h3_idx)
    return list(h3_indices)


line_string_to_h3_str_udf = udf(
    lambda geom, res: line_string_to_h3_str(geom, res), ArrayType(StringType())
)

# COMMAND ----------
# DBTITLE 1,Linear Interpolation Tests
# Visualize linestrings using https://clydedacruz.github.io/openstreetmap-wkt-playground/
def list_to_linestring(points: List[Tuple[int, int]]) -> str:
    """
    Converts a list of [(x1,y1), (xi,yi),...] coordinates to a line string.
    """
    point_list = [shapely.geometry.linestring.Point(xy[0], xy[1]) for xy in points]
    return str(shapely.geometry.linestring.LineString(point_list).wkt)


# No concavity
assert (
    line_string_linear_interp(
        list_to_linestring([(0.0, 0.0), (2.0, 2.0), (4.0, 4.0)]), step=0.5
    )
    == "LINESTRING (0 0, 0.5 0.5, 1 1, 1.5 1.5, 2 2, 2.5 2.5, 3 3, 3.5 3.5, 4 4)"
)

# Concave up monotonic - max y axis
assert (
    line_string_linear_interp(
        list_to_linestring([(0.0, 0.0), (1.0, 1.0), (2.0, 5.0)]), step=0.5
    )
    == "LINESTRING (0 0, 0.5 0.5, 1 1, 1.125 1.5, 1.25 2, 1.375 2.5, 1.5 3, 1.625 3.5, 1.75 4, 1.875 4.5, 2 5)"
)

# Concave up monotonic - max x axis
print(
    line_string_linear_interp(
        list_to_linestring([(0.0, 0.0), (1.0, 1.0), (5.0, 2.0)]), step=0.5
    )
    == "LINESTRING (0 0, 0.5 0.5, 1 1, 1.5 1.125, 2 1.25, 2.5 1.375, 3 1.5, 3.5 1.625, 4 1.75, 4.5 1.875, 5 2)"
)


# Concave down not monotonic
assert (
    line_string_linear_interp(
        list_to_linestring(
            [(0.0, 5.0), (1.0, 4.0), (2.0, 4.0), (3.0, 3.0), (2.0, 1.0)]
        ),
        step=0.33,
    )
    == "LINESTRING (0 5, 0.3333333333333333 4.666666666666667, 0.6666666666666666 4.333333333333333, 1 4, 1.3333333333333333 4, 1.6666666666666665 4, 2 4, 2.3333333333333335 3.6666666666666665, 2.6666666666666665 3.3333333333333335, 3 3, 2.8333333333333335 2.6666666666666665, 2.6666666666666665 2.3333333333333335, 2.5 2, 2.3333333333333335 1.6666666666666667, 2.166666666666667 1.3333333333333335, 2 1)"
)

# East/West interpolated way
assert (
    line_string_linear_interp(
        "LINESTRING (-89.7677115 42.51385980000001, -89.76726570000001 42.5142087, -89.7666906 42.51452500000001, -89.76629150000001 42.5146877, -89.76597770000001 42.51481560000001, -89.765608 42.5149663, -89.7655924 42.5149747, -89.76490410000001 42.515345, -89.7641727 42.5157309, -89.76344920000001 42.51602860000001, -89.7629472 42.51618180000001, -89.7626927 42.51623530000001, -89.76242760000001 42.5162541, -89.7614825 42.5162613, -89.76054330000001 42.5162555, -89.7596652 42.5162539, -89.7595285 42.5162599, -89.75942910000001 42.516274, -89.7593564 42.51629190000001, -89.75930150000001 42.5163139, -89.75922600000001 42.5163537, -89.75916170000001 42.51640620000001, -89.75910540000001 42.5164671, -89.759077 42.5165321, -89.75905990000001 42.51659710000001, -89.75905080000001 42.5166551, -89.75904680000001 42.5167226, -89.75910830000001 42.51927850000001, -89.7591118 42.51946090000001, -89.75909820000001 42.5195766, -89.75905510000001 42.5196879, -89.75897670000001 42.5197775, -89.75894600000001 42.5197981, -89.7588669 42.51985120000001, -89.7587316 42.519896, -89.7585492 42.5199191, -89.7583257 42.5199264, -89.7542179 42.5199509, -89.75373900000001 42.5199509, -89.75012570000001 42.5199509, -89.7465349 42.5199602, -89.7449053 42.5199644, -89.7424575 42.5199518, -89.7409518 42.519952, -89.7405859 42.519952, -89.7370964 42.5199524, -89.7344925 42.5199523, -89.73437580000001 42.5199511)"
    )
    == "LINESTRING (-89.7677115 42.51385980000001, -89.76763720000001 42.51391795000001, -89.7675629 42.51397610000001, -89.76748860000001 42.51403425000001, -89.76741430000001 42.5140924, -89.76734 42.51415055, -89.76726570000001 42.5142087, -89.76718354285715 42.51425388571428, -89.7671013857143 42.514299071428574, -89.76701922857144 42.51434425714286, -89.76693707142857 42.51438944285715, -89.76685491428572 42.514434628571436, -89.76677275714286 42.51447981428573, -89.7666906 42.51452500000001, -89.76661078000001 42.51455754000001, -89.76653096000001 42.51459008000001, -89.76645114 42.514622620000004, -89.76637132 42.514655160000004, -89.76629150000001 42.5146877, -89.76621305 42.51471967500001, -89.76613460000002 42.51475165000001, -89.76605615000001 42.51478362500001, -89.76597770000001 42.51481560000001, -89.76590376 42.51484574000001, -89.76582982000001 42.514875880000005, -89.76575588 42.514906020000005, -89.76568194000001 42.51493616, -89.765608 42.5149663, -89.7656002 42.514970500000004, -89.7655924 42.5149747, -89.76551592222222 42.51501584444445, -89.76543944444445 42.515056988888894, -89.76536296666667 42.51509813333334, -89.76528648888889 42.515139277777784, -89.76521001111112 42.51518042222222, -89.76513353333334 42.51522156666667, -89.76505705555556 42.51526271111111, -89.76498057777779 42.51530385555556, -89.76490410000001 42.515345, -89.76482283333334 42.51538787777778, -89.76474156666667 42.515430755555556, -89.7646603 42.515473633333336, -89.76457903333333 42.515516511111116, -89.76449776666668 42.51555938888889, -89.76441650000001 42.51560226666667, -89.76433523333334 42.51564514444445, -89.76425396666667 42.51568802222222, -89.7641727 42.5157309, -89.76409231111111 42.51576397777778, -89.76401192222222 42.51579705555556, -89.76393153333333 42.51583013333334, -89.76385114444444 42.51586321111112, -89.76377075555557 42.5158962888889, -89.76369036666668 42.515929366666676, -89.76360997777779 42.515962444444455, -89.7635295888889 42.515995522222234, -89.76344920000001 42.51602860000001, -89.76336553333334 42.51605413333335, -89.76328186666667 42.51607966666668, -89.7631982 42.51610520000001, -89.76311453333334 42.51613073333335, -89.76303086666667 42.51615626666668, -89.7629472 42.51618180000001, -89.76286236666667 42.51619963333334, -89.76277753333333 42.51621746666668, -89.7626927 42.51623530000001, -89.76260433333334 42.51624156666667, -89.76251596666667 42.51624783333334, -89.76242760000001 42.5162541, -89.76234884166668 42.5162547, -89.76227008333333 42.5162553, -89.762191325 42.5162559, -89.76211256666667 42.5162565, -89.76203380833334 42.5162571, -89.76195505000001 42.5162577, -89.76187629166667 42.5162583, -89.76179753333334 42.5162589, -89.761718775 42.5162595, -89.76164001666666 42.5162601, -89.76156125833333 42.5162607, -89.7614825 42.5162613, -89.76140423333334 42.516260816666666, -89.76132596666667 42.51626033333333, -89.7612477 42.51625985, -89.76116943333334 42.51625936666667, -89.76109116666667 42.51625888333333, -89.7610129 42.5162584, -89.76093463333333 42.51625791666667, -89.76085636666667 42.51625743333333, -89.76077810000001 42.51625695, -89.76069983333335 42.51625646666667, -89.76062156666667 42.51625598333333, -89.76054330000001 42.5162555, -89.76046347272728 42.51625535454546, -89.76038364545455 42.51625520909091, -89.76030381818182 42.516255063636365, -89.7602239909091 42.51625491818182, -89.76014416363637 42.51625477272727, -89.76006433636364 42.51625462727273, -89.75998450909091 42.51625448181818, -89.75990468181818 42.51625433636364, -89.75982485454546 42.516254190909095, -89.75974502727273 42.516254045454545, -89.7596652 42.5162539, -89.75959685000001 42.5162569, -89.7595285 42.5162599, -89.75947880000001 42.51626695, -89.7594291 42.516274, -89.75939275 42.516282950000004, -89.7593564 42.51629190000001, -89.75932895 42.51630290000001, -89.7593015 42.5163139, -89.75926375 42.5163338, -89.75922600000001 42.5163537, -89.75919385 42.51637995000001, -89.7591617 42.51640620000001, -89.75913355 42.51643665, -89.75910540000001 42.5164671, -89.7590912 42.5164996, -89.759077 42.5165321, -89.75906845 42.51656460000001, -89.75905990000001 42.51659710000001, -89.75905535000001 42.51662610000001, -89.75905080000001 42.5166551, -89.75904880000002 42.51668885, -89.75904680000001 42.5167226, -89.759048721875 42.516802471875, -89.75905064375 42.516882343750005, -89.75905256562501 42.516962215625, -89.75905448750001 42.5170420875, -89.759056409375 42.517121959375004, -89.75905833125 42.517201831250006, -89.75906025312501 42.517281703125, -89.75906217500001 42.517361575, -89.75906409687501 42.517441446875004, -89.75906601875 42.517521318750006, -89.759067940625 42.51760119062501, -89.75906986250001 42.5176810625, -89.75907178437501 42.517760934375005, -89.75907370625 42.51784080625001, -89.759075628125 42.51792067812501, -89.75907755 42.51800055000001, -89.75907947187501 42.518080421875005, -89.75908139375001 42.51816029375001, -89.759083315625 42.51824016562501, -89.7590852375 42.51832003750001, -89.75908715937501 42.518399909375006, -89.75908908125001 42.51847978125001, -89.75909100312501 42.51855965312501, -89.759092925 42.51863952500001, -89.759094846875 42.518719396875014, -89.75909676875001 42.51879926875001, -89.75909869062501 42.51887914062501, -89.7591006125 42.51895901250001, -89.759102534375 42.519038884375014, -89.75910445625001 42.51911875625001, -89.75910637812501 42.51919862812501, -89.75910830000001 42.51927850000001, -89.75911005 42.51936970000001, -89.7591118 42.51946090000001, -89.759105 42.51951875, -89.75909820000001 42.5195766, -89.75907665000001 42.51963225, -89.75905510000001 42.5196879, -89.75901590000001 42.5197327, -89.7589767 42.5197775, -89.75896135 42.5197878, -89.75894600000001 42.5197981, -89.75890645000001 42.519824650000004, -89.7588669 42.51985120000001, -89.75879925000001 42.51987360000001, -89.7587316 42.519896, -89.7586404 42.51990755, -89.7585492 42.5199191, -89.75847470000001 42.51992153333334, -89.7584002 42.51992396666667, -89.7583257 42.5199264, -89.75824515490196 42.51992688039216, -89.75816460980393 42.519927360784315, -89.75808406470588 42.519927841176475, -89.75800351960784 42.51992832156863, -89.75792297450981 42.51992880196079, -89.75784242941177 42.51992928235294, -89.75776188431372 42.5199297627451, -89.7576813392157 42.51993024313726, -89.75760079411765 42.51993072352941, -89.7575202490196 42.51993120392157, -89.75743970392156 42.519931684313725, -89.75735915882353 42.519932164705885, -89.75727861372549 42.51993264509804, -89.75719806862745 42.5199331254902, -89.75711752352942 42.51993360588236, -89.75703697843137 42.51993408627451, -89.75695643333333 42.51993456666667, -89.7568758882353 42.51993504705882, -89.75679534313726 42.51993552745098, -89.75671479803921 42.519936007843135, -89.75663425294118 42.519936488235295, -89.75655370784314 42.519936968627455, -89.7564731627451 42.51993744901961, -89.75639261764707 42.51993792941177, -89.75631207254902 42.51993840980392, -89.75623152745098 42.51993889019608, -89.75615098235293 42.51993937058823, -89.7560704372549 42.51993985098039, -89.75598989215686 42.519940331372545, -89.75590934705882 42.519940811764705, -89.75582880196079 42.519941292156865, -89.75574825686274 42.51994177254902, -89.7556677117647 42.51994225294118, -89.75558716666667 42.51994273333333, -89.75550662156863 42.51994321372549, -89.75542607647058 42.51994369411764, -89.75534553137256 42.5199441745098, -89.75526498627451 42.51994465490196, -89.75518444117647 42.519945135294115, -89.75510389607844 42.519945615686275, -89.7550233509804 42.51994609607843, -89.75494280588235 42.51994657647059, -89.75486226078431 42.51994705686274, -89.75478171568628 42.5199475372549, -89.75470117058823 42.51994801764706, -89.75462062549019 42.51994849803921, -89.75454008039216 42.51994897843137, -89.75445953529412 42.519949458823525, -89.75437899019607 42.519949939215685, -89.75429844509804 42.51995041960784, -89.7542179 42.5199509, -89.75413808333333 42.5199509, -89.75405826666668 42.5199509, -89.75397845 42.5199509, -89.75389863333334 42.5199509, -89.75381881666668 42.5199509, -89.75373900000001 42.5199509, -89.75365870444446 42.5199509, -89.7535784088889 42.5199509, -89.75349811333335 42.5199509, -89.75341781777779 42.5199509, -89.75333752222224 42.5199509, -89.75325722666668 42.5199509, -89.75317693111113 42.5199509, -89.75309663555556 42.5199509, -89.75301634000002 42.5199509, -89.75293604444445 42.5199509, -89.7528557488889 42.5199509, -89.75277545333334 42.5199509, -89.7526951577778 42.5199509, -89.75261486222223 42.5199509, -89.75253456666668 42.5199509, -89.75245427111112 42.5199509, -89.75237397555557 42.5199509, -89.75229368000001 42.5199509, -89.75221338444446 42.5199509, -89.7521330888889 42.5199509, -89.75205279333335 42.5199509, -89.75197249777779 42.5199509, -89.75189220222224 42.5199509, -89.75181190666667 42.5199509, -89.75173161111113 42.5199509, -89.75165131555556 42.5199509, -89.75157102000001 42.5199509, -89.75149072444445 42.5199509, -89.7514104288889 42.5199509, -89.75133013333334 42.5199509, -89.75124983777779 42.5199509, -89.75116954222223 42.5199509, -89.75108924666668 42.5199509, -89.75100895111112 42.5199509, -89.75092865555557 42.5199509, -89.75084836 42.5199509, -89.75076806444446 42.5199509, -89.7506877688889 42.5199509, -89.75060747333335 42.5199509, -89.75052717777778 42.5199509, -89.75044688222223 42.5199509, -89.75036658666667 42.5199509, -89.75028629111112 42.5199509, -89.75020599555556 42.5199509, -89.75012570000001 42.5199509, -89.75004590444446 42.51995110666667, -89.7499661088889 42.51995131333333, -89.74988631333335 42.51995152, -89.74980651777778 42.51995172666666, -89.74972672222223 42.51995193333333, -89.74964692666667 42.51995214, -89.74956713111112 42.51995234666666, -89.74948733555557 42.51995255333333, -89.74940754 42.519952759999995, -89.74932774444446 42.519952966666665, -89.7492479488889 42.519953173333334, -89.74916815333334 42.51995338, -89.7490883577778 42.51995358666667, -89.74900856222223 42.51995379333333, -89.74892876666668 42.519954, -89.74884897111112 42.51995420666667, -89.74876917555557 42.51995441333333, -89.74868938 42.51995462, -89.74860958444445 42.51995482666666, -89.7485297888889 42.51995503333333, -89.74844999333334 42.51995524, -89.74837019777779 42.519955446666664, -89.74829040222222 42.519955653333334, -89.74821060666667 42.519955859999996, -89.74813081111111 42.519956066666666, -89.74805101555556 42.519956273333335, -89.74797122000001 42.51995648, -89.74789142444445 42.51995668666667, -89.7478116288889 42.51995689333333, -89.74773183333333 42.5199571, -89.74765203777778 42.51995730666667, -89.74757224222222 42.51995751333333, -89.74749244666667 42.51995772, -89.74741265111112 42.51995792666666, -89.74733285555556 42.51995813333333, -89.74725306 42.51995834, -89.74717326444444 42.519958546666665, -89.74709346888889 42.519958753333334, -89.74701367333334 42.51995896, -89.74693387777778 42.519959166666666, -89.74685408222223 42.519959373333336, -89.74677428666666 42.51995958, -89.74669449111111 42.51995978666667, -89.74661469555555 42.51995999333333, -89.7465349 42.5199602, -89.74645342 42.51996041, -89.74637194 42.51996062, -89.74629046 42.51996083, -89.74620898 42.51996104, -89.7461275 42.51996125, -89.74604602 42.51996146, -89.74596454 42.51996167, -89.74588306 42.51996188, -89.74580158 42.51996209, -89.7457201 42.5199623, -89.74563862 42.51996251, -89.74555714 42.51996272, -89.74547566 42.51996293, -89.74539418 42.51996314, -89.7453127 42.51996335, -89.74523122 42.51996356, -89.74514974 42.51996377, -89.74506826 42.51996398, -89.74498678 42.519964189999996, -89.7449053 42.5199644, -89.74482633870967 42.51996399354839, -89.74474737741936 42.519963587096775, -89.74466841612903 42.51996318064516, -89.7445894548387 42.519962774193544, -89.74451049354839 42.51996236774193, -89.74443153225806 42.51996196129032, -89.74435257096773 42.51996155483871, -89.74427360967742 42.5199611483871, -89.7441946483871 42.519960741935485, -89.74411568709678 42.51996033548387, -89.74403672580645 42.51995992903226, -89.74395776451613 42.51995952258064, -89.74387880322581 42.51995911612903, -89.74379984193548 42.51995870967742, -89.74372088064516 42.519958303225806, -89.74364191935484 42.519957896774194, -89.74356295806452 42.51995749032258, -89.74348399677419 42.51995708387097, -89.74340503548387 42.51995667741936, -89.74332607419355 42.51995627096774, -89.74324711290322 42.51995586451613, -89.7431681516129 42.519955458064516, -89.74308919032258 42.519955051612904, -89.74301022903227 42.51995464516129, -89.74293126774194 42.51995423870968, -89.74285230645161 42.51995383225807, -89.7427733451613 42.519953425806456, -89.74269438387097 42.51995301935484, -89.74261542258064 42.519952612903225, -89.74253646129033 42.51995220645161, -89.7424575 42.5199518, -89.74237825263158 42.519951810526315, -89.74229900526316 42.519951821052636, -89.74221975789474 42.51995183157895, -89.74214051052631 42.519951842105264, -89.7420612631579 42.51995185263158, -89.74198201578947 42.5199518631579, -89.74190276842106 42.519951873684214, -89.74182352105264 42.51995188421053, -89.74174427368422 42.51995189473684, -89.74166502631579 42.51995190526316, -89.74158577894737 42.51995191578948, -89.74150653157895 42.51995192631579, -89.74142728421053 42.519951936842105, -89.74134803684211 42.519951947368426, -89.7412687894737 42.51995195789474, -89.74118954210526 42.519951968421054, -89.74111029473684 42.51995197894737, -89.74103104736842 42.51995198947369, -89.7409518 42.519952, -89.74087862 42.519952, -89.74080544 42.519952, -89.74073226 42.519952, -89.74065908 42.519952, -89.7405859 42.519952, -89.74050659318182 42.519952009090915, -89.74042728636364 42.51995201818182, -89.74034797954545 42.51995202727273, -89.74026867272727 42.51995203636364, -89.74018936590909 42.51995204545455, -89.74011005909091 42.519952054545456, -89.74003075227273 42.51995206363637, -89.73995144545455 42.51995207272728, -89.73987213863636 42.51995208181818, -89.73979283181818 42.519952090909094, -89.739713525 42.519952100000005, -89.73963421818182 42.51995210909091, -89.73955491136364 42.51995211818182, -89.73947560454545 42.51995212727273, -89.73939629772727 42.51995213636364, -89.73931699090909 42.519952145454546, -89.73923768409091 42.51995215454546, -89.73915837727273 42.51995216363637, -89.73907907045455 42.51995217272727, -89.73899976363636 42.519952181818184, -89.73892045681818 42.519952190909095, -89.73884115 42.519952200000006, -89.73876184318182 42.51995220909091, -89.73868253636364 42.51995221818182, -89.73860322954545 42.51995222727273, -89.73852392272727 42.519952236363636, -89.73844461590909 42.51995224545455, -89.73836530909091 42.51995225454546, -89.73828600227273 42.51995226363636, -89.73820669545455 42.519952272727274, -89.73812738863636 42.519952281818185, -89.73804808181818 42.519952290909096, -89.737968775 42.5199523, -89.73788946818182 42.51995230909091, -89.73781016136364 42.51995231818182, -89.73773085454545 42.519952327272726, -89.73765154772727 42.51995233636364, -89.73757224090909 42.51995234545455, -89.73749293409091 42.51995235454545, -89.73741362727273 42.519952363636364, -89.73733432045455 42.519952372727275, -89.73725501363636 42.519952381818186, -89.73717570681818 42.51995239090909, -89.7370964 42.5199524, -89.73701749393939 42.5199523969697, -89.73693858787878 42.5199523939394, -89.73685968181817 42.51995239090909, -89.73678077575758 42.51995238787879, -89.73670186969697 42.51995238484849, -89.73662296363636 42.519952381818186, -89.73654405757576 42.51995237878788, -89.73646515151515 42.519952375757576, -89.73638624545454 42.519952372727275, -89.73630733939395 42.51995236969697, -89.73622843333334 42.519952366666665, -89.73614952727273 42.519952363636364, -89.73607062121212 42.51995236060606, -89.73599171515151 42.51995235757576, -89.7359128090909 42.51995235454545, -89.7358339030303 42.51995235151515, -89.7357549969697 42.51995234848485, -89.7356760909091 42.51995234545455, -89.73559718484849 42.51995234242424, -89.73551827878788 42.51995233939394, -89.73543937272727 42.51995233636364, -89.73536046666666 42.519952333333336, -89.73528156060605 42.51995233030303, -89.73520265454546 42.519952327272726, -89.73512374848485 42.519952324242425, -89.73504484242424 42.51995232121212, -89.73496593636364 42.519952318181815, -89.73488703030303 42.519952315151514, -89.73480812424242 42.51995231212121, -89.73472921818183 42.51995230909091, -89.73465031212122 42.5199523060606, -89.73457140606061 42.5199523030303, -89.7344925 42.5199523, -89.73443415 42.5199517, -89.73437580000001 42.5199511)"
)

# Horseshoe-shaped way
assert (
    line_string_linear_interp(
        "LINESTRING (-74.22195450000001 40.3077898, -74.2221681 40.30778, -74.22350510000001 40.3077186, -74.22356600000001 40.30808800000001, -74.2233839 40.3081918, -74.22328950000001 40.3082456, -74.22283520000001 40.3082874, -74.2222979 40.3083369, -74.22222210000001 40.3083403, -74.22202080000001 40.30834950000001)"
    )
    == "LINESTRING (-74.22195450000001 40.3077898, -74.2220257 40.307786533333335, -74.22209690000001 40.30778326666667, -74.2221681 40.30778, -74.22224674705883 40.3077763882353, -74.22232539411765 40.30777277647059, -74.22240404117647 40.30776916470588, -74.2224826882353 40.30776555294118, -74.22256133529413 40.30776194117647, -74.22263998235294 40.30775832941177, -74.22271862941177 40.30775471764706, -74.2227972764706 40.30775110588235, -74.22287592352941 40.30774749411765, -74.22295457058824 40.307743882352945, -74.22303321764707 40.30774027058823, -74.22311186470588 40.30773665882353, -74.22319051176471 40.307733047058825, -74.22326915882354 40.30772943529412, -74.22334780588237 40.30772582352941, -74.22342645294118 40.307722211764705, -74.22350510000001 40.3077186, -74.22351728000001 40.30779248, -74.22352946000001 40.307866360000006, -74.22354164000001 40.30794024000001, -74.22355382 40.30801412000001, -74.223566 40.30808800000001, -74.22347495 40.30813990000001, -74.2233839 40.3081918, -74.2233367 40.3082187, -74.2232895 40.3082456, -74.22321378333334 40.30825256666667, -74.22313806666668 40.308259533333334, -74.22306235 40.3082665, -74.22298663333333 40.30827346666666, -74.22291091666668 40.30828043333333, -74.2228352 40.3082874, -74.22275844285714 40.30829447142857, -74.22268168571429 40.308301542857144, -74.22260492857143 40.308308614285714, -74.22252817142858 40.308315685714284, -74.22245141428571 40.308322757142854, -74.22237465714286 40.30832982857143, -74.2222979 40.3083369, -74.22226 40.3083386, -74.22222210000001 40.3083403, -74.22215500000001 40.30834336666667, -74.2220879 40.30834643333334, -74.22202080000001 40.30834950000001)"
)

# North/South Interpolated Way
# Example of interpolation bug for non-monotonic linestring:
# https://cloud.samsara.com/o/28464/fleet/map_edit?lat=33.282061462185155&lng=-104.45134331518817&zoom=14&wayIds=14439719-360098857-360098859-14439910-358400000747503-358400000175709-358400000299818-358400000198746-358400000219826-50380387&tiles=6875%2C13173-6876%2C13175-6877%2C13188&end_ms=1631336399999
assert (
    line_string_linear_interp(
        "LINESTRING (-104.4693326 33.3057265, -104.4687165 33.3053478, -104.4682943 33.3050297, -104.467806 33.304614, -104.467611 33.304411, -104.4671785 33.3038461, -104.466853 33.303185, -104.4667751 33.3029637, -104.466736 33.30283, -104.4665777 33.3021783, -104.4665262 33.3019449, -104.4664802 33.3016154, -104.4664726 33.3013318, -104.4664521 33.3001568, -104.4664344 33.2967302, -104.4664417 33.2960474, -104.4664344 33.292236, -104.4664178 33.2849878, -104.4663856 33.2808531, -104.466392 33.27871500000001, -104.466362 33.274903, -104.466359 33.273125, -104.466307 33.272269, -104.466204 33.271625, -104.465423 33.266326, -104.465323 33.265649, -104.4649961 33.2639137, -104.4637123 33.2558064, -104.463175 33.252029, -104.461411 33.241202, -104.459735 33.230503, -104.459708 33.230331, -104.459104 33.226559, -104.459086 33.226443, -104.458979 33.225717, -104.458458 33.222192, -104.457992 33.219388, -104.45762 33.217153, -104.456791 33.211925, -104.455008 33.200767, -104.454893 33.200034, -104.454662 33.198571, -104.454515 33.19763500000001, -104.4544866 33.1974543, -104.452961 33.187744, -104.450989 33.175331, -104.449889 33.168365, -104.449773 33.16763, -104.448777 33.161302, -104.448733 33.161015, -104.447951 33.15599, -104.447895 33.155637, -104.4452964 33.1393888, -104.443512 33.1280982, -104.443136 33.125399, -104.44305 33.12485, -104.441902 33.117544, -104.441779 33.116762, -104.441623 33.114213, -104.441668 33.11072, -104.441676 33.11014400000001, -104.441684 33.109959, -104.44178 33.107509, -104.4418684 33.102915, -104.44199 33.0994821)"
    )
    == "LINESTRING (-104.4693326 33.3057265, -104.4692555875 33.3056791625, -104.469178575 33.305631825, -104.4691015625 33.3055844875, -104.46902455 33.30553715, -104.4689475375 33.3054898125, -104.468870525 33.305442475, -104.4687935125 33.3053951375, -104.4687165 33.3053478, -104.46863206 33.30528418, -104.46854762 33.30522056, -104.46846318 33.305156939999996, -104.46837873999999 33.30509332, -104.4682943 33.3050297, -104.46821291666666 33.30496041666667, -104.46813153333333 33.304891133333335, -104.46805015 33.304821849999996, -104.46796876666666 33.304752566666664, -104.46788738333333 33.30468328333333, -104.467806 33.304614, -104.467741 33.304546333333334, -104.467676 33.30447866666667, -104.467611 33.304411, -104.46754921428573 33.304330300000004, -104.46748742857143 33.3042496, -104.46742564285715 33.3041689, -104.46736385714286 33.3040882, -104.46730207142858 33.304007500000004, -104.46724028571428 33.3039268, -104.4671785 33.3038461, -104.4671378125 33.3037634625, -104.46709712500001 33.303680825, -104.4670564375 33.3035981875, -104.46701575 33.30351555, -104.4669750625 33.3034329125, -104.466934375 33.303350275, -104.4668936875 33.3032676375, -104.466853 33.303185, -104.46682703333333 33.30311123333333, -104.46680106666668 33.303037466666666, -104.4667751 33.3029637, -104.46675555 33.302896849999996, -104.466736 33.30283, -104.4667162125 33.3027485375, -104.466696425 33.302667075, -104.4666766375 33.3025856125, -104.46665684999999 33.302504150000004, -104.4666370625 33.3024226875, -104.466617275 33.302341225, -104.4665974875 33.3022597625, -104.4665777 33.3021783, -104.46656053333334 33.3021005, -104.46654336666667 33.3020227, -104.4665262 33.3019449, -104.4665147 33.301862525000004, -104.4665032 33.30178015, -104.4664917 33.301697775, -104.4664802 33.3016154, -104.4664783 33.301544500000006, -104.4664764 33.3014736, -104.4664745 33.3014027, -104.4664726 33.3013318, -104.46647123333334 33.301253466666665, -104.46646986666667 33.30117513333333, -104.4664685 33.3010968, -104.46646713333334 33.30101846666667, -104.46646576666667 33.300940133333334, -104.4664644 33.3008618, -104.46646303333334 33.300783466666665, -104.46646166666666 33.30070513333334, -104.4664603 33.3006268, -104.46645893333333 33.30054846666667, -104.46645756666666 33.300470133333334, -104.4664562 33.3003918, -104.46645483333333 33.30031346666667, -104.46645346666666 33.30023513333334, -104.4664521 33.3001568, -104.46645168837209 33.30007711162791, -104.46645127674418 33.29999742325582, -104.46645086511627 33.29991773488372, -104.46645045348836 33.29983804651163, -104.46645004186047 33.299758358139535, -104.46644963023256 33.299678669767445, -104.46644921860465 33.29959898139535, -104.46644880697674 33.29951929302326, -104.46644839534883 33.29943960465116, -104.46644798372093 33.29935991627907, -104.46644757209302 33.299280227906976, -104.46644716046511 33.29920053953489, -104.46644674883721 33.29912085116279, -104.4664463372093 33.2990411627907, -104.4664459255814 33.298961474418604, -104.46644551395349 33.298881786046515, -104.46644510232558 33.29880209767442, -104.46644469069767 33.29872240930233, -104.46644427906976 33.29864272093023, -104.46644386744185 33.29856303255814, -104.46644345581394 33.298483344186046, -104.46644304418605 33.29840365581396, -104.46644263255814 33.29832396744186, -104.46644222093023 33.29824427906977, -104.46644180930232 33.298164590697674, -104.46644139767442 33.298084902325584, -104.4664409860465 33.29800521395349, -104.4664405744186 33.2979255255814, -104.46644016279069 33.2978458372093, -104.46643975116278 33.29776614883721, -104.46643933953489 33.297686460465115, -104.46643892790698 33.297606772093026, -104.46643851627907 33.29752708372093, -104.46643810465116 33.29744739534884, -104.46643769302325 33.29736770697674, -104.46643728139534 33.297288018604654, -104.46643686976743 33.29720833023256, -104.46643645813953 33.29712864186047, -104.46643604651163 33.29704895348837, -104.46643563488372 33.29696926511628, -104.46643522325581 33.296889576744185, -104.4664348116279 33.296809888372096, -104.4664344 33.2967302, -104.4664352111111 33.29665433333333, -104.46643602222223 33.296578466666666, -104.46643683333333 33.2965026, -104.46643764444444 33.296426733333334, -104.46643845555556 33.296350866666664, -104.46643926666667 33.296275, -104.46644007777778 33.29619913333333, -104.4664408888889 33.29612326666667, -104.4664417 33.2960474, -104.46644154791667 33.29596799583333, -104.46644139583334 33.29588859166667, -104.46644124375 33.2958091875, -104.46644109166667 33.295729783333336, -104.46644093958334 33.295650379166666, -104.4664407875 33.295570975, -104.46644063541667 33.295491570833335, -104.46644048333334 33.295412166666665, -104.46644033125 33.2953327625, -104.46644017916667 33.29525335833333, -104.46644002708334 33.295173954166664, -104.466439875 33.29509455, -104.46643972291668 33.29501514583333, -104.46643957083333 33.29493574166667, -104.46643941875 33.2948563375, -104.46643926666667 33.29477693333333, -104.46643911458334 33.29469752916667, -104.4664389625 33.294618125, -104.46643881041666 33.29453872083334, -104.46643865833333 33.29445931666667, -104.46643850625 33.2943799125, -104.46643835416667 33.294300508333336, -104.46643820208334 33.29422110416667, -104.46643805 33.2941417, -104.46643789791666 33.294062295833335, -104.46643774583333 33.293982891666666, -104.46643759375 33.2939034875, -104.46643744166667 33.293824083333334, -104.46643728958334 33.293744679166664, -104.4664371375 33.293665275, -104.46643698541666 33.29358587083333, -104.46643683333333 33.29350646666667, -104.46643668125 33.2934270625, -104.46643652916667 33.29334765833333, -104.46643637708333 33.29326825416667, -104.466436225 33.29318885, -104.46643607291666 33.29310944583334, -104.46643592083333 33.29303004166667, -104.46643576875 33.2929506375, -104.46643561666667 33.29287123333334, -104.46643546458333 33.29279182916667, -104.4664353125 33.292712425000005, -104.46643516041667 33.292633020833335, -104.46643500833333 33.292553616666666, -104.46643485625 33.292474212500004, -104.46643470416666 33.292394808333334, -104.46643455208333 33.29231540416667, -104.4664344 33.292236, -104.46643421758242 33.29215634945055, -104.46643403516484 33.2920766989011, -104.46643385274724 33.291997048351654, -104.46643367032966 33.2919173978022, -104.46643348791208 33.29183774725275, -104.4664333054945 33.2917580967033, -104.46643312307692 33.291678446153846, -104.46643294065935 33.2915987956044, -104.46643275824175 33.29151914505495, -104.46643257582417 33.2914394945055, -104.46643239340659 33.291359843956045, -104.46643221098901 33.2912801934066, -104.46643202857143 33.29120054285715, -104.46643184615384 33.291120892307696, -104.46643166373626 33.29104124175824, -104.46643148131868 33.29096159120879, -104.4664312989011 33.29088194065935, -104.46643111648352 33.290802290109895, -104.46643093406593 33.29072263956044, -104.46643075164835 33.29064298901099, -104.46643056923077 33.29056333846154, -104.46643038681319 33.290483687912094, -104.4664302043956 33.29040403736264, -104.46643002197803 33.29032438681319, -104.46642983956043 33.29024473626374, -104.46642965714285 33.290165085714285, -104.46642947472527 33.29008543516484, -104.4664292923077 33.29000578461539, -104.46642910989011 33.28992613406594, -104.46642892747252 33.289846483516484, -104.46642874505494 33.28976683296703, -104.46642856263736 33.28968718241759, -104.46642838021978 33.289607531868135, -104.4664281978022 33.28952788131868, -104.46642801538461 33.28944823076923, -104.46642783296703 33.28936858021979, -104.46642765054945 33.289288929670334, -104.46642746813187 33.28920927912088, -104.46642728571429 33.28912962857143, -104.46642710329671 33.28904997802198, -104.46642692087912 33.28897032747253, -104.46642673846154 33.28889067692308, -104.46642655604396 33.28881102637363, -104.46642637362638 33.28873137582418, -104.4664261912088 33.288651725274725, -104.4664260087912 33.28857207472528, -104.46642582637362 33.28849242417583, -104.46642564395604 33.288412773626376, -104.46642546153846 33.288333123076924, -104.46642527912088 33.28825347252747, -104.46642509670329 33.28817382197803, -104.46642491428571 33.288094171428575, -104.46642473186813 33.28801452087912, -104.46642454945055 33.28793487032967, -104.46642436703297 33.28785521978022, -104.46642418461539 33.287775569230774, -104.4664240021978 33.28769591868132, -104.46642381978022 33.28761626813187, -104.46642363736264 33.28753661758242, -104.46642345494506 33.28745696703297, -104.46642327252748 33.28737731648352, -104.46642309010988 33.28729766593407, -104.4664229076923 33.28721801538462, -104.46642272527473 33.287138364835165, -104.46642254285715 33.28705871428572, -104.46642236043957 33.28697906373627, -104.46642217802197 33.286899413186816, -104.46642199560439 33.286819762637364, -104.46642181318681 33.28674011208791, -104.46642163076923 33.28666046153847, -104.46642144835165 33.286580810989015, -104.46642126593407 33.28650116043956, -104.46642108351648 33.28642150989011, -104.4664209010989 33.28634185934066, -104.46642071868132 33.286262208791214, -104.46642053626374 33.28618255824176, -104.46642035384616 33.28610290769231, -104.46642017142857 33.28602325714286, -104.46641998901099 33.285943606593406, -104.46641980659341 33.28586395604396, -104.46641962417583 33.28578430549451, -104.46641944175825 33.28570465494506, -104.46641925934065 33.285625004395605, -104.46641907692307 33.28554535384616, -104.4664188945055 33.28546570329671, -104.46641871208791 33.285386052747256, -104.46641852967034 33.285306402197804, -104.46641834725276 33.28522675164835, -104.46641816483516 33.28514710109891, -104.46641798241758 33.285067450549455, -104.4664178 33.2849878, -104.46641718076923 33.28490828653847, -104.46641656153847 33.284828773076924, -104.46641594230769 33.28474925961539, -104.46641532307693 33.28466974615385, -104.46641470384616 33.28459023269231, -104.46641408461538 33.284510719230774, -104.46641346538462 33.28443120576923, -104.46641284615384 33.284351692307695, -104.46641222692308 33.28427217884616, -104.46641160769231 33.284192665384616, -104.46641098846153 33.28411315192308, -104.46641036923077 33.284033638461544, -104.46640975 33.283954125, -104.46640913076924 33.283874611538465, -104.46640851153846 33.28379509807693, -104.46640789230769 33.283715584615386, -104.46640727307692 33.28363607115385, -104.46640665384615 33.28355655769231, -104.46640603461539 33.28347704423077, -104.46640541538461 33.283397530769236, -104.46640479615384 33.28331801730769, -104.46640417692308 33.28323850384616, -104.4664035576923 33.28315899038462, -104.46640293846154 33.28307947692308, -104.46640231923077 33.28299996346154, -104.4664017 33.282920450000006, -104.46640108076923 33.28284093653846, -104.46640046153846 33.28276142307693, -104.4663998423077 33.282681909615384, -104.46639922307692 33.28260239615385, -104.46639860384616 33.28252288269231, -104.46639798461538 33.28244336923077, -104.46639736538461 33.28236385576923, -104.46639674615385 33.2822843423077, -104.46639612692307 33.282204828846154, -104.46639550769231 33.28212531538462, -104.46639488846154 33.282045801923076, -104.46639426923076 33.28196628846154, -104.46639365 33.281886775000004, -104.46639303076923 33.28180726153846, -104.46639241153846 33.281727748076925, -104.46639179230769 33.28164823461539, -104.46639117307691 33.281568721153846, -104.46639055384615 33.28148920769231, -104.46638993461538 33.281409694230774, -104.46638931538462 33.28133018076923, -104.46638869615384 33.281250667307695, -104.46638807692307 33.28117115384615, -104.4663874576923 33.281091640384616, -104.46638683846153 33.28101212692308, -104.46638621923077 33.28093261346154, -104.4663856 33.2808531, -104.46638583703704 33.28077391111111, -104.46638607407407 33.28069472222222, -104.46638631111111 33.28061553333334, -104.46638654814815 33.28053634444445, -104.46638678518518 33.28045715555556, -104.46638702222222 33.28037796666667, -104.46638725925925 33.28029877777778, -104.46638749629629 33.28021958888889, -104.46638773333333 33.28014040000001, -104.46638797037036 33.28006121111112, -104.4663882074074 33.27998202222223, -104.46638844444445 33.27990283333334, -104.46638868148148 33.27982364444445, -104.46638891851852 33.279744455555566, -104.46638915555555 33.279665266666676, -104.46638939259259 33.279586077777786, -104.46638962962963 33.279506888888896, -104.46638986666666 33.27942770000001, -104.4663901037037 33.279348511111124, -104.46639034074074 33.279269322222234, -104.46639057777777 33.279190133333344, -104.46639081481482 33.279110944444454, -104.46639105185184 33.279031755555565, -104.46639128888889 33.278952566666675, -104.46639152592593 33.27887337777779, -104.46639176296296 33.2787941888889, -104.466392 33.27871500000001, -104.466391375 33.27863558333335, -104.46639075 33.278556166666675, -104.466390125 33.27847675000001, -104.4663895 33.278397333333345, -104.46638887499999 33.27831791666668, -104.46638825 33.278238500000015, -104.466387625 33.27815908333334, -104.466387 33.27807966666668, -104.466386375 33.27800025000001, -104.46638575 33.27792083333334, -104.466385125 33.277841416666675, -104.4663845 33.27776200000001, -104.466383875 33.277682583333345, -104.46638325 33.27760316666668, -104.466382625 33.27752375000001, -104.466382 33.27744433333334, -104.466381375 33.27736491666668, -104.46638075 33.277285500000005, -104.466380125 33.27720608333334, -104.4663795 33.277126666666675, -104.466378875 33.27704725000001, -104.46637825 33.276967833333345, -104.466377625 33.27688841666667, -104.466377 33.27680900000001, -104.466376375 33.27672958333334, -104.46637575 33.27665016666667, -104.466375125 33.276570750000005, -104.4663745 33.27649133333334, -104.466373875 33.276411916666675, -104.46637325 33.27633250000001, -104.466372625 33.27625308333334, -104.466372 33.27617366666667, -104.46637137500001 33.27609425000001, -104.46637075 33.276014833333335, -104.466370125 33.27593541666667, -104.4663695 33.275856000000005, -104.466368875 33.27577658333334, -104.46636825 33.275697166666674, -104.466367625 33.27561775, -104.466367 33.27553833333334, -104.466366375 33.27545891666667, -104.46636575000001 33.2753795, -104.46636512500001 33.275300083333335, -104.4663645 33.27522066666667, -104.466363875 33.275141250000004, -104.46636325 33.27506183333334, -104.466362625 33.27498241666667, -104.466362 33.274903, -104.46636186363637 33.27482218181818, -104.46636172727273 33.274741363636366, -104.46636159090909 33.274660545454545, -104.46636145454546 33.27457972727273, -104.46636131818182 33.27449890909091, -104.46636118181819 33.274418090909094, -104.46636104545455 33.27433727272727, -104.46636090909091 33.27425645454546, -104.46636077272727 33.27417563636364, -104.46636063636363 33.27409481818182, -104.46636050000001 33.274014, -104.46636036363637 33.27393318181818, -104.46636022727273 33.273852363636365, -104.46636009090909 33.273771545454544, -104.46635995454545 33.27369072727273, -104.46635981818181 33.27360990909091, -104.46635968181818 33.27352909090909, -104.46635954545454 33.27344827272727, -104.46635940909091 33.27336745454546, -104.46635927272727 33.273286636363636, -104.46635913636364 33.27320581818182, -104.466359 33.273125, -104.46635427272727 33.273047181818185, -104.46634954545455 33.27296936363636, -104.46634481818181 33.27289154545455, -104.46634009090909 33.27281372727273, -104.46633536363636 33.27273590909091, -104.46633063636364 33.27265809090909, -104.46632590909091 33.272580272727275, -104.46632118181819 33.27250245454545, -104.46631645454545 33.27242463636364, -104.46631172727272 33.272346818181816, -104.466307 33.272269, -104.466294125 33.2721885, -104.46628125000001 33.272108, -104.466268375 33.2720275, -104.4662555 33.271947, -104.466242625 33.2718665, -104.46622975 33.271786, -104.466216875 33.2717055, -104.466204 33.271625, -104.46619216666667 33.27154471212121, -104.46618033333334 33.271464424242424, -104.46616850000001 33.271384136363636, -104.46615666666668 33.27130384848485, -104.46614483333333 33.27122356060606, -104.466133 33.27114327272727, -104.46612116666667 33.271062984848484, -104.46610933333334 33.270982696969696, -104.4660975 33.27090240909091, -104.46608566666667 33.27082212121212, -104.46607383333334 33.27074183333333, -104.46606200000001 33.270661545454544, -104.46605016666668 33.270581257575756, -104.46603833333334 33.27050096969697, -104.4660265 33.27042068181818, -104.46601466666667 33.27034039393939, -104.46600283333333 33.270260106060604, -104.465991 33.270179818181816, -104.46597916666667 33.27009953030303, -104.46596733333334 33.27001924242424, -104.4659555 33.26993895454545, -104.46594366666667 33.269858666666664, -104.46593183333334 33.269778378787876, -104.46592 33.26969809090909, -104.46590816666667 33.2696178030303, -104.46589633333333 33.26953751515151, -104.4658845 33.269457227272724, -104.46587266666667 33.269376939393936, -104.46586083333334 33.26929665151515, -104.465849 33.26921636363636, -104.46583716666667 33.26913607575757, -104.46582533333334 33.269055787878784, -104.4658135 33.268975499999996, -104.46580166666666 33.268895212121215, -104.46578983333333 33.26881492424243, -104.465778 33.26873463636364, -104.46576616666667 33.26865434848485, -104.46575433333334 33.26857406060606, -104.4657425 33.268493772727275, -104.46573066666667 33.26841348484849, -104.46571883333334 33.2683331969697, -104.46570700000001 33.26825290909091, -104.46569516666666 33.26817262121212, -104.46568333333333 33.268092333333335, -104.4656715 33.26801204545455, -104.46565966666667 33.26793175757576, -104.46564783333334 33.26785146969697, -104.465636 33.26777118181818, -104.46562416666667 33.267690893939395, -104.46561233333334 33.26761060606061, -104.46560050000001 33.26753031818182, -104.46558866666666 33.26745003030303, -104.46557683333333 33.26736974242424, -104.465565 33.267289454545455, -104.46555316666667 33.26720916666667, -104.46554133333333 33.26712887878788, -104.4655295 33.26704859090909, -104.46551766666667 33.2669683030303, -104.46550583333334 33.266888015151515, -104.465494 33.26680772727273, -104.46548216666667 33.26672743939394, -104.46547033333333 33.26664715151515, -104.4654585 33.26656686363636, -104.46544666666667 33.266486575757575, -104.46543483333333 33.26640628787879, -104.465423 33.266326, -104.4654105 33.266241375, -104.465398 33.26615675, -104.4653855 33.266072125, -104.465373 33.2659875, -104.4653605 33.265902875, -104.465348 33.26581825, -104.4653355 33.265733625, -104.465323 33.265649, -104.46530814090909 33.265570122727276, -104.46529328181818 33.26549124545455, -104.46527842272727 33.26541236818182, -104.46526356363636 33.26533349090909, -104.46524870454544 33.265254613636365, -104.46523384545455 33.26517573636364, -104.46521898636364 33.26509685909091, -104.46520412727273 33.26501798181818, -104.46518926818182 33.264939104545455, -104.4651744090909 33.26486022727273, -104.46515955 33.26478135000001, -104.46514469090909 33.26470247272728, -104.46512983181817 33.26462359545455, -104.46511497272726 33.264544718181824, -104.46510011363635 33.2644658409091, -104.46508525454544 33.26438696363637, -104.46507039545455 33.26430808636364, -104.46505553636364 33.264229209090914, -104.46504067727273 33.264150331818186, -104.46502581818181 33.26407145454546, -104.4650109590909 33.26399257727273, -104.4649961 33.2639137, -104.46498338910891 33.26383342970297, -104.46497067821781 33.263753159405944, -104.46495796732673 33.26367288910891, -104.46494525643564 33.263592618811884, -104.46493254554454 33.26351234851485, -104.46491983465346 33.263432078217825, -104.46490712376237 33.26335180792079, -104.46489441287127 33.263271537623766, -104.46488170198019 33.26319126732673, -104.4648689910891 33.263110997029706, -104.46485628019802 33.26303072673267, -104.46484356930692 33.26295045643565, -104.46483085841584 33.26287018613861, -104.46481814752475 33.26278991584159, -104.46480543663365 33.262709645544554, -104.46479272574257 33.26262937524753, -104.46478001485148 33.262549104950494, -104.46476730396039 33.26246883465347, -104.4647545930693 33.262388564356435, -104.46474188217822 33.26230829405941, -104.46472917128712 33.262228023762376, -104.46471646039603 33.26214775346535, -104.46470374950495 33.262067483168316, -104.46469103861385 33.26198721287129, -104.46467832772277 33.26190694257426, -104.46466561683168 33.26182667227723, -104.46465290594058 33.2617464019802, -104.4646401950495 33.26166613168317, -104.46462748415841 33.26158586138614, -104.46461477326731 33.26150559108911, -104.46460206237623 33.26142532079208, -104.46458935148515 33.26134505049505, -104.46457664059406 33.26126478019802, -104.46456392970296 33.26118450990099, -104.46455121881188 33.26110423960396, -104.46453850792079 33.26102396930693, -104.4645257970297 33.2609436990099, -104.46451308613861 33.260863428712874, -104.46450037524752 33.26078315841584, -104.46448766435643 33.260702888118814, -104.46447495346534 33.26062261782178, -104.46446224257426 33.260542347524755, -104.46444953168316 33.26046207722772, -104.46443682079207 33.260381806930695, -104.46442410990099 33.26030153663366, -104.46441139900989 33.260221266336636, -104.4643986881188 33.2601409960396, -104.46438597722772 33.260060725742576, -104.46437326633662 33.25998045544554, -104.46436055544554 33.25990018514852, -104.46434784455445 33.259819914851484, -104.46433513366337 33.25973964455446, -104.46432242277227 33.259659374257424, -104.46430971188119 33.2595791039604, -104.4642970009901 33.259498833663365, -104.464284290099 33.25941856336634, -104.46427157920792 33.259338293069305, -104.46425886831683 33.25925802277228, -104.46424615742573 33.259177752475246, -104.46423344653465 33.25909748217822, -104.46422073564356 33.259017211881186, -104.46420802475247 33.25893694158416, -104.46419531386138 33.25885667128713, -104.4641826029703 33.2587764009901, -104.4641698920792 33.25869613069307, -104.46415718118811 33.25861586039604, -104.46414447029703 33.25853559009901, -104.46413175940593 33.25845531980198, -104.46411904851485 33.25837504950495, -104.46410633762376 33.25829477920792, -104.46409362673268 33.25821450891089, -104.46408091584158 33.25813423861386, -104.4640682049505 33.25805396831683, -104.46405549405941 33.2579736980198, -104.46404278316831 33.25789342772277, -104.46403007227723 33.257813157425744, -104.46401736138614 33.25773288712871, -104.46400465049504 33.257652616831685, -104.46399193960396 33.25757234653465, -104.46397922871287 33.257492076237625, -104.46396651782177 33.25741180594059, -104.46395380693069 33.257331535643566, -104.4639410960396 33.25725126534653, -104.4639283851485 33.257170995049506, -104.46391567425742 33.25709072475247, -104.46390296336634 33.25701045445545, -104.46389025247524 33.25693018415841, -104.46387754158415 33.25684991386139, -104.46386483069307 33.256769643564354, -104.46385211980197 33.25668937326733, -104.46383940891089 33.256609102970295, -104.4638266980198 33.25652883267327, -104.46381398712872 33.256448562376235, -104.46380127623762 33.25636829207921, -104.46378856534653 33.256288021782176, -104.46377585445545 33.25620775148515, -104.46376314356435 33.256127481188116, -104.46375043267327 33.25604721089109, -104.46373772178218 33.25596694059406, -104.46372501089108 33.25588667029703, -104.4637123 33.2558064, -104.4637008680851 33.25572602978723, -104.46368943617021 33.25564565957446, -104.46367800425531 33.2555652893617, -104.46366657234043 33.255484919148934, -104.46365514042553 33.25540454893617, -104.46364370851063 33.2553241787234, -104.46363227659575 33.255243808510635, -104.46362084468085 33.25516343829787, -104.46360941276596 33.255083068085106, -104.46359798085106 33.255002697872335, -104.46358654893616 33.25492232765957, -104.46357511702128 33.25484195744681, -104.46356368510638 33.25476158723404, -104.4635522531915 33.25468121702127, -104.4635408212766 33.25460084680851, -104.4635293893617 33.254520476595744, -104.46351795744681 33.25444010638298, -104.46350652553191 33.25435973617021, -104.46349509361703 33.254279365957444, -104.46348366170213 33.25419899574468, -104.46347222978723 33.254118625531916, -104.46346079787234 33.254038255319145, -104.46344936595744 33.25395788510638, -104.46343793404256 33.25387751489362, -104.46342650212766 33.25379714468085, -104.46341507021278 33.25371677446808, -104.46340363829788 33.25363640425532, -104.46339220638298 33.25355603404255, -104.46338077446809 33.25347566382979, -104.4633693425532 33.25339529361702, -104.46335791063831 33.253314923404254, -104.46334647872341 33.25323455319149, -104.46333504680851 33.253154182978726, -104.46332361489362 33.253073812765955, -104.46331218297873 33.25299344255319, -104.46330075106384 33.25291307234043, -104.46328931914894 33.25283270212766, -104.46327788723404 33.25275233191489, -104.46326645531916 33.25267196170213, -104.46325502340426 33.25259159148936, -104.46324359148937 33.2525112212766, -104.46323215957447 33.25243085106383, -104.46322072765958 33.252350480851064, -104.46320929574469 33.2522701106383, -104.46319786382979 33.252189740425536, -104.4631864319149 33.252109370212764, -104.463175 33.252029, -104.46316193333334 33.2519488, -104.46314886666667 33.2518686, -104.4631358 33.2517884, -104.46312273333334 33.2517082, -104.46310966666667 33.251628000000004, -104.4630966 33.2515478, -104.46308353333335 33.2514676, -104.46307046666668 33.2513874, -104.46305740000001 33.2513072, -104.46304433333334 33.251227, -104.46303126666668 33.2511468, -104.46301820000001 33.2510666, -104.46300513333334 33.2509864, -104.46299206666667 33.2509062, -104.462979 33.250826, -104.46296593333334 33.2507458, -104.46295286666667 33.2506656, -104.4629398 33.2505854, -104.46292673333333 33.2505052, -104.46291366666667 33.250425, -104.46290060000001 33.2503448, -104.46288753333334 33.2502646, -104.46287446666668 33.2501844, -104.46286140000001 33.2501042, -104.46284833333334 33.250024, -104.46283526666667 33.2499438, -104.4628222 33.2498636, -104.46280913333334 33.2497834, -104.46279606666667 33.2497032, -104.462783 33.249623, -104.46276993333333 33.2495428, -104.46275686666667 33.2494626, -104.4627438 33.2493824, -104.46273073333334 33.2493022, -104.46271766666668 33.249222, -104.46270460000001 33.249141800000004, -104.46269153333334 33.2490616, -104.46267846666667 33.2489814, -104.4626654 33.2489012, -104.46265233333334 33.248821, -104.46263926666667 33.2487408, -104.4626262 33.2486606, -104.46261313333333 33.2485804, -104.46260006666667 33.2485002, -104.462587 33.24842, -104.46257393333333 33.248339800000004, -104.46256086666666 33.2482596, -104.46254780000001 33.2481794, -104.46253473333334 33.2480992, -104.46252166666667 33.248019, -104.4625086 33.2479388, -104.46249553333334 33.2478586, -104.46248246666667 33.2477784, -104.4624694 33.2476982, -104.46245633333334 33.247618, -104.46244326666667 33.2475378, -104.4624302 33.247457600000004, -104.46241713333333 33.2473774, -104.46240406666666 33.2472972, -104.462391 33.247217, -104.46237793333334 33.2471368, -104.46236486666668 33.2470566, -104.46235180000001 33.2469764, -104.46233873333334 33.2468962, -104.46232566666667 33.246816, -104.4623126 33.2467358, -104.46229953333334 33.246655600000004, -104.46228646666667 33.2465754, -104.4622734 33.2464952, -104.46226033333333 33.246415, -104.46224726666667 33.2463348, -104.4622342 33.2462546, -104.46222113333333 33.2461744, -104.46220806666666 33.2460942, -104.46219500000001 33.246014, -104.46218193333334 33.2459338, -104.46216886666667 33.245853600000004, -104.4621558 33.2457734, -104.46214273333334 33.2456932, -104.46212966666667 33.245613, -104.4621166 33.2455328, -104.46210353333333 33.2454526, -104.46209046666667 33.2453724, -104.4620774 33.2452922, -104.46206433333333 33.245212, -104.46205126666666 33.2451318, -104.4620382 33.245051600000004, -104.46202513333334 33.244971400000004, -104.46201206666667 33.2448912, -104.461999 33.244811, -104.46198593333334 33.2447308, -104.46197286666667 33.2446506, -104.4619598 33.2445704, -104.46194673333333 33.2444902, -104.46193366666667 33.24441, -104.4619206 33.2443298, -104.46190753333333 33.2442496, -104.46189446666666 33.244169400000004, -104.4618814 33.2440892, -104.46186833333333 33.244009, -104.46185526666666 33.2439288, -104.4618422 33.2438486, -104.46182913333334 33.2437684, -104.46181606666667 33.2436882, -104.461803 33.243608, -104.46178993333334 33.2435278, -104.46177686666667 33.2434476, -104.4617638 33.243367400000004, -104.46175073333333 33.243287200000005, -104.46173766666666 33.243207, -104.4617246 33.2431268, -104.46171153333333 33.2430466, -104.46169846666666 33.2429664, -104.4616854 33.2428862, -104.46167233333334 33.242806, -104.46165926666667 33.2427258, -104.4616462 33.2426456, -104.46163313333334 33.242565400000004, -104.46162006666667 33.242485200000004, -104.461607 33.242405, -104.46159393333333 33.2423248, -104.46158086666667 33.2422446, -104.4615678 33.2421644, -104.46155473333333 33.2420842, -104.46154166666666 33.242004, -104.4615286 33.2419238, -104.46151553333333 33.2418436, -104.46150246666666 33.2417634, -104.4614894 33.241683200000004, -104.46147633333334 33.241603, -104.46146326666667 33.2415228, -104.4614502 33.2414426, -104.46143713333333 33.2413624, -104.46142406666667 33.2412822, -104.461411 33.241202, -104.46139849253731 33.24112215671642, -104.46138598507463 33.241042313432835, -104.46137347761194 33.240962470149256, -104.46136097014926 33.24088262686567, -104.46134846268656 33.24080278358209, -104.46133595522387 33.24072294029851, -104.46132344776119 33.240643097014924, -104.4613109402985 33.240563253731345, -104.46129843283582 33.240483410447766, -104.46128592537313 33.24040356716418, -104.46127341791045 33.2403237238806, -104.46126091044776 33.24024388059701, -104.46124840298508 33.240164037313434, -104.46123589552239 33.240084194029855, -104.4612233880597 33.24000435074627, -104.46121088059701 33.23992450746269, -104.46119837313432 33.2398446641791, -104.46118586567164 33.23976482089552, -104.46117335820895 33.239684977611944, -104.46116085074627 33.23960513432836, -104.46114834328358 33.23952529104478, -104.4611358358209 33.23944544776119, -104.46112332835821 33.23936560447761, -104.46111082089551 33.23928576119403, -104.46109831343283 33.239205917910446, -104.46108580597014 33.23912607462687, -104.46107329850746 33.23904623134329, -104.46106079104477 33.2389663880597, -104.46104828358209 33.23888654477612, -104.4610357761194 33.238806701492535, -104.46102326865672 33.238726858208956, -104.46101076119403 33.23864701492538, -104.46099825373135 33.23856717164179, -104.46098574626865 33.23848732835821, -104.46097323880596 33.238407485074625, -104.46096073134328 33.238327641791045, -104.46094822388059 33.238247798507466, -104.46093571641791 33.23816795522388, -104.46092320895522 33.2380881119403, -104.46091070149254 33.23800826865671, -104.46089819402985 33.237928425373134, -104.46088568656717 33.237848582089555, -104.46087317910448 33.23776873880597, -104.46086067164178 33.23768889552239, -104.4608481641791 33.23760905223881, -104.46083565671641 33.23752920895522, -104.46082314925373 33.237449365671644, -104.46081064179104 33.23736952238806, -104.46079813432836 33.23728967910448, -104.46078562686567 33.2372098358209, -104.46077311940299 33.23712999253731, -104.4607606119403 33.23705014925373, -104.4607481044776 33.23697030597015, -104.46073559701492 33.23689046268657, -104.46072308955223 33.23681061940299, -104.46071058208955 33.2367307761194, -104.46069807462686 33.23665093283582, -104.46068556716418 33.236571089552235, -104.46067305970149 33.236491246268656, -104.4606605522388 33.23641140298508, -104.46064804477612 33.23633155970149, -104.46063553731344 33.23625171641791, -104.46062302985074 33.23617187313433, -104.46061052238805 33.236092029850745, -104.46059801492537 33.236012186567166, -104.46058550746268 33.23593234328358, -104.460573 33.2358525, -104.46056049253731 33.23577265671642, -104.46054798507463 33.235692813432834, -104.46053547761194 33.235612970149255, -104.46052297014926 33.23553312686567, -104.46051046268656 33.23545328358209, -104.46049795522387 33.23537344029851, -104.46048544776119 33.23529359701492, -104.4604729402985 33.235213753731344, -104.46046043283582 33.235133910447765, -104.46044792537313 33.23505406716418, -104.46043541791045 33.2349742238806, -104.46042291044776 33.23489438059701, -104.46041040298508 33.23481453731343, -104.46039789552239 33.234734694029854, -104.46038538805969 33.23465485074627, -104.460372880597 33.23457500746269, -104.46036037313432 33.2344951641791, -104.46034786567164 33.23441532089552, -104.46033535820895 33.23433547761194, -104.46032285074627 33.234255634328356, -104.46031034328358 33.23417579104478, -104.4602978358209 33.23409594776119, -104.46028532835821 33.23401610447761, -104.46027282089551 33.23393626119403, -104.46026031343283 33.233856417910445, -104.46024780597014 33.233776574626866, -104.46023529850746 33.23369673134329, -104.46022279104477 33.2336168880597, -104.46021028358209 33.23353704477612, -104.4601977761194 33.233457201492534, -104.46018526865672 33.233377358208955, -104.46017276119403 33.233297514925376, -104.46016025373135 33.23321767164179, -104.46014774626865 33.23313782835821, -104.46013523880596 33.23305798507462, -104.46012273134328 33.232978141791044, -104.46011022388059 33.232898298507465, -104.4600977164179 33.23281845522388, -104.46008520895522 33.2327386119403, -104.46007270149254 33.23265876865671, -104.46006019402985 33.23257892537313, -104.46004768656717 33.232499082089554, -104.46003517910448 33.23241923880597, -104.46002267164178 33.23233939552239, -104.4600101641791 33.23225955223881, -104.45999765671641 33.23217970895522, -104.45998514925373 33.23209986567164, -104.45997264179104 33.232020022388056, -104.45996013432836 33.23194017910448, -104.45994762686567 33.2318603358209, -104.45993511940299 33.23178049253731, -104.4599226119403 33.23170064925373, -104.4599101044776 33.231620805970145, -104.45989759701492 33.231540962686566, -104.45988508955223 33.23146111940299, -104.45987258208955 33.2313812761194, -104.45986007462686 33.23130143283582, -104.45984756716418 33.231221589552234, -104.45983505970149 33.231141746268655, -104.4598225522388 33.231061902985076, -104.45981004477612 33.23098205970149, -104.45979753731343 33.23090221641791, -104.45978502985074 33.23082237313433, -104.45977252238805 33.230742529850744, -104.45976001492537 33.230662686567165, -104.45974750746268 33.23058284328358, -104.459735 33.230503, -104.4597215 33.230417, -104.459708 33.230331, -104.45969514893618 33.23025074468085, -104.45968229787235 33.230170489361704, -104.45966944680852 33.23009023404255, -104.45965659574469 33.2300099787234, -104.45964374468086 33.229929723404254, -104.45963089361703 33.229849468085106, -104.4596180425532 33.22976921276596, -104.45960519148936 33.22968895744681, -104.45959234042553 33.229608702127656, -104.4595794893617 33.22952844680851, -104.45956663829787 33.22944819148936, -104.45955378723404 33.22936793617021, -104.45954093617021 33.229287680851066, -104.45952808510638 33.22920742553192, -104.45951523404256 33.22912717021276, -104.45950238297873 33.229046914893615, -104.4594895319149 33.22896665957447, -104.45947668085107 33.22888640425532, -104.45946382978724 33.22880614893617, -104.45945097872341 33.228725893617025, -104.45943812765958 33.22864563829787, -104.45942527659575 33.22856538297872, -104.45941242553192 33.228485127659575, -104.45939957446808 33.22840487234043, -104.45938672340425 33.22832461702128, -104.45937387234042 33.22824436170213, -104.45936102127659 33.22816410638298, -104.45934817021276 33.22808385106383, -104.45933531914893 33.22800359574468, -104.4593224680851 33.227923340425534, -104.45930961702128 33.227843085106386, -104.45929676595745 33.22776282978724, -104.45928391489362 33.22768257446808, -104.45927106382979 33.227602319148936, -104.45925821276596 33.22752206382979, -104.45924536170213 33.22744180851064, -104.4592325106383 33.22736155319149, -104.45921965957447 33.227281297872345, -104.45920680851064 33.22720104255319, -104.4591939574468 33.22712078723404, -104.45918110638297 33.227040531914895, -104.45916825531914 33.22696027659575, -104.45915540425531 33.2268800212766, -104.45914255319148 33.22679976595745, -104.45912970212765 33.2267195106383, -104.45911685106383 33.22663925531915, -104.459104 33.226559, -104.45909499999999 33.226501, -104.459086 33.226443, -104.45907411111111 33.226362333333334, -104.45906222222222 33.22628166666667, -104.45905033333334 33.226201, -104.45903844444445 33.226120333333334, -104.45902655555555 33.22603966666667, -104.45901466666666 33.225959, -104.45900277777778 33.225878333333334, -104.45899088888889 33.22579766666667, -104.458979 33.225717, -104.4589671590909 33.22563688636364, -104.45895531818182 33.22555677272727, -104.45894347727273 33.22547665909091, -104.45893163636363 33.22539654545455, -104.45891979545455 33.225316431818186, -104.45890795454545 33.22523631818182, -104.45889611363636 33.225156204545456, -104.45888427272727 33.22507609090909, -104.45887243181818 33.22499597727273, -104.45886059090908 33.22491586363637, -104.45884875 33.224835750000004, -104.4588369090909 33.22475563636364, -104.45882506818181 33.224675522727274, -104.45881322727273 33.22459540909091, -104.45880138636363 33.224515295454545, -104.45878954545454 33.22443518181819, -104.45877770454545 33.22435506818182, -104.45876586363636 33.22427495454546, -104.45875402272726 33.22419484090909, -104.45874218181818 33.22411472727273, -104.45873034090909 33.22403461363636, -104.4587185 33.2239545, -104.45870665909091 33.22387438636364, -104.45869481818181 33.223794272727275, -104.45868297727273 33.22371415909091, -104.45867113636363 33.223634045454546, -104.45865929545454 33.22355393181818, -104.45864745454546 33.223473818181816, -104.45863561363636 33.22339370454546, -104.45862377272726 33.22331359090909, -104.45861193181818 33.22323347727273, -104.45860009090909 33.223153363636364, -104.45858824999999 33.22307325, -104.45857640909091 33.222993136363634, -104.45856456818181 33.222913022727276, -104.45855272727272 33.22283290909091, -104.45854088636364 33.22275279545455, -104.45852904545454 33.22267268181818, -104.45851720454544 33.22259256818182, -104.45850536363636 33.22251245454545, -104.45849352272727 33.222432340909094, -104.45848168181817 33.22235222727273, -104.45846984090909 33.222272113636365, -104.458458 33.222192, -104.45844468571428 33.222111885714284, -104.45843137142856 33.22203177142857, -104.45841805714285 33.22195165714286, -104.45840474285714 33.221871542857144, -104.45839142857142 33.22179142857143, -104.45837811428571 33.22171131428571, -104.4583648 33.2216312, -104.45835148571427 33.22155108571429, -104.45833817142857 33.22147097142857, -104.45832485714286 33.22139085714286, -104.45831154285715 33.22131074285714, -104.45829822857142 33.221230628571426, -104.45828491428571 33.22115051428572, -104.4582716 33.2210704, -104.45825828571428 33.22099028571429, -104.45824497142857 33.22091017142857, -104.45823165714286 33.220830057142855, -104.45821834285714 33.22074994285715, -104.45820502857143 33.22066982857143, -104.45819171428572 33.220589714285715, -104.4581784 33.2205096, -104.45816508571428 33.220429485714284, -104.45815177142858 33.220349371428576, -104.45813845714285 33.22026925714286, -104.45812514285714 33.220189142857144, -104.45811182857143 33.22010902857143, -104.45809851428572 33.22002891428571, -104.4580852 33.219948800000004, -104.45807188571429 33.21986868571429, -104.45805857142858 33.21978857142857, -104.45804525714286 33.21970845714286, -104.45803194285715 33.21962834285714, -104.45801862857144 33.21954822857143, -104.45800531428571 33.21946811428572, -104.457992 33.219388, -104.45797871428572 33.21930817857143, -104.45796542857143 33.21922835714286, -104.45795214285715 33.21914853571429, -104.45793885714286 33.21906871428572, -104.45792557142858 33.21898889285715, -104.45791228571429 33.21890907142858, -104.457899 33.21882925, -104.45788571428572 33.21874942857143, -104.45787242857143 33.21866960714286, -104.45785914285715 33.218589785714286, -104.45784585714286 33.218509964285715, -104.45783257142858 33.218430142857144, -104.4578192857143 33.218350321428574, -104.457806 33.2182705, -104.45779271428572 33.21819067857143, -104.45777942857143 33.21811085714286, -104.45776614285715 33.21803103571429, -104.45775285714286 33.21795121428572, -104.45773957142858 33.21787139285715, -104.45772628571429 33.21779157142858, -104.45771300000001 33.21771175000001, -104.45769971428572 33.21763192857143, -104.45768642857144 33.21755210714286, -104.45767314285715 33.21747228571429, -104.45765985714286 33.217392464285716, -104.45764657142858 33.217312642857145, -104.4576332857143 33.217232821428574, -104.45762 33.217153, -104.45760724615386 33.21707256923077, -104.45759449230769 33.21699213846154, -104.45758173846154 33.21691170769231, -104.45756898461539 33.21683127692308, -104.45755623076924 33.21675084615385, -104.45754347692308 33.21667041538462, -104.45753072307693 33.21658998461539, -104.45751796923078 33.21650955384616, -104.45750521538461 33.21642912307693, -104.45749246153846 33.2163486923077, -104.45747970769231 33.21626826153847, -104.45746695384615 33.216187830769236, -104.4574542 33.216107400000006, -104.45744144615385 33.216026969230775, -104.4574286923077 33.215946538461544, -104.45741593846154 33.215866107692314, -104.45740318461539 33.215785676923076, -104.45739043076924 33.215705246153846, -104.45737767692307 33.215624815384615, -104.45736492307692 33.215544384615384, -104.45735216923077 33.215463953846154, -104.45733941538462 33.21538352307692, -104.45732666153846 33.21530309230769, -104.45731390769231 33.21522266153846, -104.45730115384616 33.21514223076923, -104.4572884 33.2150618, -104.45727564615385 33.21498136923077, -104.4572628923077 33.21490093846154, -104.45725013846155 33.21482050769231, -104.45723738461538 33.21474007692308, -104.45722463076923 33.21465964615385, -104.45721187692308 33.21457921538462, -104.45719912307692 33.21449878461539, -104.45718636923077 33.214418353846156, -104.45717361538462 33.214337923076926, -104.45716086153845 33.214257492307695, -104.4571481076923 33.214177061538464, -104.45713535384616 33.214096630769234, -104.4571226 33.2140162, -104.45710984615384 33.21393576923077, -104.45709709230769 33.21385533846154, -104.45708433846154 33.21377490769231, -104.45707158461538 33.21369447692308, -104.45705883076923 33.21361404615385, -104.45704607692308 33.21353361538462, -104.45703332307693 33.21345318461539, -104.45702056923076 33.21337275384616, -104.45700781538461 33.21329232307693, -104.45699506153846 33.21321189230769, -104.4569823076923 33.21313146153846, -104.45696955384615 33.21305103076923, -104.4569568 33.2129706, -104.45694404615385 33.21289016923077, -104.45693129230769 33.21280973846154, -104.45691853846154 33.21272930769231, -104.45690578461539 33.212648876923076, -104.45689303076922 33.212568446153846, -104.45688027692307 33.212488015384615, -104.45686752307692 33.212407584615384, -104.45685476923076 33.212327153846154, -104.45684201538461 33.21224672307692, -104.45682926153846 33.21216629230769, -104.45681650769231 33.21208586153846, -104.45680375384615 33.21200543076923, -104.456791 33.211925, -104.45677817266187 33.21184472661871, -104.45676534532373 33.211764453237414, -104.4567525179856 33.211684179856114, -104.45673969064748 33.21160390647482, -104.45672686330934 33.21152363309353, -104.45671403597122 33.211443359712234, -104.45670120863309 33.211363086330934, -104.45668838129497 33.21128281294964, -104.45667555395683 33.21120253956835, -104.4566627266187 33.211122266187054, -104.45664989928058 33.211041992805754, -104.45663707194244 33.21096171942446, -104.45662424460431 33.21088144604317, -104.45661141726619 33.210801172661874, -104.45659858992805 33.210720899280574, -104.45658576258992 33.21064062589928, -104.4565729352518 33.21056035251799, -104.45656010791366 33.210480079136694, -104.45654728057553 33.210399805755394, -104.45653445323741 33.2103195323741, -104.45652162589928 33.21023925899281, -104.45650879856115 33.210158985611514, -104.45649597122302 33.210078712230214, -104.4564831438849 33.20999843884892, -104.45647031654676 33.20991816546763, -104.45645748920863 33.209837892086334, -104.4564446618705 33.209757618705034, -104.45643183453237 33.20967734532374, -104.45641900719424 33.20959707194245, -104.45640617985612 33.209516798561154, -104.45639335251798 33.209436525179854, -104.45638052517985 33.20935625179856, -104.45636769784173 33.20927597841727, -104.45635487050359 33.209195705035974, -104.45634204316546 33.20911543165467, -104.45632921582734 33.20903515827338, -104.45631638848921 33.20895488489209, -104.45630356115107 33.208874611510794, -104.45629073381295 33.20879433812949, -104.45627790647482 33.2087140647482, -104.45626507913668 33.20863379136691, -104.45625225179856 33.208553517985614, -104.45623942446043 33.20847324460431, -104.4562265971223 33.20839297122302, -104.45621376978417 33.20831269784173, -104.45620094244605 33.208232424460434, -104.4561881151079 33.20815215107914, -104.45617528776978 33.20807187769784, -104.45616246043166 33.20799160431655, -104.45614963309353 33.207911330935254, -104.45613680575539 33.20783105755396, -104.45612397841727 33.20775078417266, -104.45611115107914 33.20767051079137, -104.456098323741 33.20759023741007, -104.45608549640288 33.20750996402878, -104.45607266906475 33.20742969064748, -104.45605984172661 33.20734941726619, -104.45604701438849 33.20726914388489, -104.45603418705036 33.2071888705036, -104.45602135971222 33.2071085971223, -104.4560085323741 33.20702832374101, -104.45599570503597 33.20694805035971, -104.45598287769785 33.20686777697842, -104.45597005035971 33.20678750359712, -104.45595722302158 33.20670723021583, -104.45594439568346 33.20662695683453, -104.45593156834532 33.20654668345324, -104.4559187410072 33.20646641007194, -104.45590591366907 33.20638613669065, -104.45589308633093 33.20630586330935, -104.4558802589928 33.20622558992806, -104.45586743165468 33.20614531654676, -104.45585460431654 33.20606504316547, -104.45584177697842 33.20598476978417, -104.45582894964029 33.20590449640288, -104.45581612230215 33.20582422302158, -104.45580329496403 33.205743949640286, -104.4557904676259 33.20566367625899, -104.45577764028778 33.2055834028777, -104.45576481294964 33.2055031294964, -104.45575198561151 33.205422856115106, -104.45573915827339 33.20534258273381, -104.45572633093525 33.20526230935252, -104.45571350359712 33.20518203597122, -104.455700676259 33.205101762589926, -104.45568784892086 33.20502148920863, -104.45567502158273 33.20494121582734, -104.45566219424461 33.20486094244604, -104.45564936690647 33.204780669064746, -104.45563653956835 33.20470039568345, -104.45562371223022 33.20462012230216, -104.4556108848921 33.20453984892086, -104.45559805755396 33.204459575539566, -104.45558523021583 33.20437930215827, -104.4555724028777 33.20429902877698, -104.45555957553957 33.20421875539569, -104.45554674820144 33.204138482014386, -104.45553392086332 33.20405820863309, -104.45552109352518 33.2039779352518, -104.45550826618705 33.203897661870506, -104.45549543884893 33.203817388489206, -104.45548261151079 33.20373711510791, -104.45546978417266 33.20365684172662, -104.45545695683454 33.203576568345326, -104.45544412949641 33.203496294964026, -104.45543130215827 33.20341602158273, -104.45541847482015 33.20333574820144, -104.45540564748202 33.203255474820146, -104.45539282014389 33.203175201438846, -104.45537999280576 33.20309492805755, -104.45536716546764 33.20301465467626, -104.4553543381295 33.202934381294966, -104.45534151079137 33.202854107913666, -104.45532868345325 33.20277383453237, -104.4553158561151 33.20269356115108, -104.45530302877698 33.202613287769786, -104.45529020143886 33.202533014388486, -104.45527737410072 33.20245274100719, -104.45526454676259 33.2023724676259, -104.45525171942447 33.202292194244606, -104.45523889208634 33.202211920863306, -104.4552260647482 33.20213164748201, -104.45521323741008 33.20205137410072, -104.45520041007195 33.201971100719426, -104.45518758273381 33.201890827338126, -104.45517475539569 33.20181055395683, -104.45516192805756 33.20173028057554, -104.45514910071942 33.201650007194246, -104.4551362733813 33.201569733812946, -104.45512344604317 33.20148946043165, -104.45511061870504 33.20140918705036, -104.45509779136691 33.201328913669066, -104.45508496402879 33.201248640287766, -104.45507213669066 33.20116836690647, -104.45505930935252 33.20108809352518, -104.4550464820144 33.201007820143886, -104.45503365467627 33.200927546762586, -104.45502082733813 33.20084727338129, -104.455008 33.200767, -104.45499522222222 33.20068555555555, -104.45498244444445 33.20060411111111, -104.45496966666667 33.200522666666664, -104.45495688888889 33.200441222222224, -104.45494411111112 33.20035977777778, -104.45493133333333 33.20027833333334, -104.45491855555555 33.20019688888889, -104.45490577777778 33.20011544444445, -104.454893 33.200034, -104.45488016666667 33.19995272222222, -104.45486733333333 33.19987144444445, -104.4548545 33.199790166666666, -104.45484166666667 33.19970888888889, -104.45482883333334 33.19962761111111, -104.454816 33.19954633333334, -104.45480316666666 33.19946505555556, -104.45479033333334 33.19938377777778, -104.4547775 33.1993025, -104.45476466666666 33.19922122222222, -104.45475183333333 33.19913994444445, -104.454739 33.199058666666666, -104.45472616666666 33.19897738888889, -104.45471333333333 33.19889611111111, -104.4547005 33.19881483333334, -104.45468766666667 33.198733555555556, -104.45467483333333 33.19865227777778, -104.454662 33.198571, -104.45464975 33.198493, -104.4546375 33.198415000000004, -104.45462524999999 33.198337, -104.454613 33.19825900000001, -104.45460075 33.198181000000005, -104.4545885 33.198103, -104.45457625 33.19802500000001, -104.454564 33.197947000000006, -104.45455175000001 33.19786900000001, -104.4545395 33.19779100000001, -104.45452725 33.197713000000014, -104.454515 33.19763500000001, -104.4545008 33.197544650000005, -104.4544866 33.1974543, -104.45447399173553 33.19737404958678, -104.45446138347107 33.19729379917355, -104.4544487752066 33.19721354876033, -104.45443616694214 33.197133298347104, -104.45442355867768 33.197053047933885, -104.45441095041322 33.19697279752066, -104.45439834214875 33.19689254710744, -104.4543857338843 33.19681229669421, -104.45437312561982 33.19673204628099, -104.45436051735537 33.196651795867766, -104.4543479090909 33.196571545454546, -104.45433530082644 33.19649129504132, -104.45432269256197 33.1964110446281, -104.45431008429752 33.19633079421487, -104.45429747603305 33.19625054380165, -104.45428486776859 33.19617029338843, -104.45427225950412 33.19609004297521, -104.45425965123967 33.19600979256198, -104.4542470429752 33.19592954214876, -104.45423443471074 33.195849291735534, -104.45422182644627 33.195769041322315, -104.45420921818182 33.19568879090909, -104.45419660991735 33.19560854049587, -104.45418400165289 33.19552829008264, -104.45417139338842 33.19544803966942, -104.45415878512397 33.195367789256196, -104.4541461768595 33.195287538842976, -104.45413356859504 33.19520728842975, -104.45412096033057 33.19512703801653, -104.45410835206611 33.1950467876033, -104.45409574380164 33.19496653719008, -104.45408313553719 33.19488628677686, -104.45407052727272 33.19480603636364, -104.45405791900826 33.19472578595041, -104.4540453107438 33.19464553553719, -104.45403270247934 33.194565285123964, -104.45402009421487 33.194485034710745, -104.45400748595041 33.19440478429752, -104.45399487768594 33.1943245338843, -104.45398226942149 33.19424428347107, -104.45396966115702 33.19416403305785, -104.45395705289256 33.194083782644626, -104.45394444462809 33.194003532231406, -104.45393183636364 33.19392328181818, -104.45391922809917 33.19384303140496, -104.45390661983471 33.19376278099173, -104.45389401157024 33.19368253057851, -104.45388140330579 33.19360228016529, -104.45386879504132 33.19352202975207, -104.45385618677686 33.19344177933884, -104.45384357851239 33.19336152892562, -104.45383097024794 33.193281278512394, -104.45381836198347 33.193201028099175, -104.45380575371901 33.19312077768595, -104.45379314545454 33.19304052727273, -104.45378053719008 33.1929602768595, -104.45376792892561 33.19288002644628, -104.45375532066116 33.192799776033056, -104.45374271239669 33.192719525619836, -104.45373010413223 33.19263927520661, -104.45371749586776 33.19255902479339, -104.45370488760331 33.19247877438016, -104.45369227933884 33.19239852396694, -104.45367967107438 33.19231827355372, -104.45366706280991 33.1922380231405, -104.45365445454546 33.19215777272727, -104.45364184628099 33.19207752231405, -104.45362923801653 33.191997271900824, -104.45361662975206 33.191917021487605, -104.4536040214876 33.19183677107438, -104.45359141322314 33.19175652066116, -104.45357880495868 33.19167627024793, -104.45356619669421 33.19159601983471, -104.45355358842976 33.191515769421486, -104.45354098016529 33.191435519008266, -104.45352837190083 33.19135526859504, -104.45351576363636 33.19127501818182, -104.4535031553719 33.19119476776859, -104.45349054710744 33.19111451735537, -104.45347793884298 33.19103426694215, -104.45346533057851 33.19095401652893, -104.45345272231405 33.1908737661157, -104.45344011404958 33.19079351570248, -104.45342750578513 33.190713265289254, -104.45341489752066 33.190633014876035, -104.4534022892562 33.19055276446281, -104.45338968099173 33.19047251404959, -104.45337707272728 33.19039226363636, -104.45336446446281 33.19031201322314, -104.45335185619835 33.190231762809915, -104.45333924793388 33.190151512396696, -104.45332663966943 33.19007126198347, -104.45331403140496 33.18999101157025, -104.4533014231405 33.18991076115702, -104.45328881487603 33.1898305107438, -104.45327620661158 33.18975026033058, -104.4532635983471 33.18967000991736, -104.45325099008265 33.18958975950413, -104.45323838181818 33.18950950909091, -104.45322577355373 33.189429258677684, -104.45321316528926 33.189349008264465, -104.4532005570248 33.18926875785124, -104.45318794876033 33.18918850743802, -104.45317534049587 33.18910825702479, -104.4531627322314 33.18902800661157, -104.45315012396695 33.188947756198345, -104.45313751570248 33.188867505785126, -104.45312490743802 33.1887872553719, -104.45311229917355 33.18870700495868, -104.4530996909091 33.18862675454545, -104.45308708264463 33.18854650413223, -104.45307447438017 33.18846625371901, -104.4530618661157 33.18838600330579, -104.45304925785125 33.18830575289256, -104.45303664958678 33.18822550247934, -104.45302404132232 33.188145252066114, -104.45301143305785 33.188065001652895, -104.4529988247934 33.18798475123967, -104.45298621652893 33.18790450082645, -104.45297360826447 33.18782425041322, -104.452961 33.187744, -104.45294827741935 33.18766391612903, -104.45293555483872 33.18758383225806, -104.45292283225807 33.1875037483871, -104.45291010967742 33.18742366451613, -104.45289738709678 33.18734358064516, -104.45288466451613 33.18726349677419, -104.45287194193548 33.18718341290323, -104.45285921935483 33.18710332903226, -104.4528464967742 33.18702324516129, -104.45283377419355 33.18694316129032, -104.4528210516129 33.18686307741935, -104.45280832903227 33.18678299354839, -104.45279560645162 33.18670290967742, -104.45278288387097 33.18662282580645, -104.45277016129033 33.18654274193548, -104.45275743870968 33.18646265806452, -104.45274471612903 33.18638257419355, -104.45273199354838 33.18630249032258, -104.45271927096775 33.18622240645161, -104.4527065483871 33.18614232258065, -104.45269382580645 33.18606223870968, -104.45268110322581 33.18598215483871, -104.45266838064516 33.18590207096774, -104.45265565806451 33.18582198709677, -104.45264293548388 33.18574190322581, -104.45263021290323 33.18566181935484, -104.45261749032258 33.18558173548387, -104.45260476774193 33.1855016516129, -104.4525920451613 33.18542156774194, -104.45257932258065 33.18534148387097, -104.4525666 33.1852614, -104.45255387741936 33.18518131612903, -104.45254115483871 33.18510123225806, -104.45252843225806 33.1850211483871, -104.45251570967743 33.18494106451613, -104.45250298709678 33.18486098064516, -104.45249026451613 33.18478089677419, -104.4524775419355 33.18470081290323, -104.45246481935484 33.18462072903226, -104.4524520967742 33.18454064516129, -104.45243937419355 33.18446056129032, -104.45242665161291 33.18438047741935, -104.45241392903226 33.18430039354839, -104.45240120645161 33.18422030967742, -104.45238848387098 33.18414022580645, -104.45237576129033 33.18406014193548, -104.45236303870968 33.18398005806452, -104.45235031612904 33.18389997419355, -104.45233759354839 33.18381989032258, -104.45232487096774 33.18373980645161, -104.4523121483871 33.18365972258065, -104.45229942580646 33.18357963870968, -104.45228670322581 33.18349955483871, -104.45227398064516 33.18341947096774, -104.45226125806452 33.18333938709677, -104.45224853548388 33.18325930322581, -104.45223581290323 33.18317921935484, -104.45222309032259 33.18309913548387, -104.45221036774194 33.1830190516129, -104.45219764516129 33.18293896774194, -104.45218492258064 33.18285888387097, -104.4521722 33.1827788, -104.45215947741936 33.18269871612903, -104.45214675483871 33.18261863225806, -104.45213403225807 33.1825385483871, -104.45212130967742 33.18245846451613, -104.45210858709677 33.18237838064516, -104.45209586451614 33.18229829677419, -104.45208314193549 33.18221821290323, -104.45207041935484 33.18213812903226, -104.4520576967742 33.18205804516129, -104.45204497419356 33.18197796129032, -104.4520322516129 33.18189787741935, -104.45201952903226 33.18181779354839, -104.45200680645162 33.18173770967742, -104.45199408387097 33.18165762580645, -104.45198136129032 33.18157754193548, -104.45196863870969 33.18149745806452, -104.45195591612904 33.18141737419355, -104.45194319354839 33.18133729032258, -104.45193047096775 33.18125720645161, -104.4519177483871 33.18117712258065, -104.45190502580645 33.18109703870968, -104.4518923032258 33.18101695483871, -104.45187958064517 33.18093687096774, -104.45186685806452 33.18085678709677, -104.45185413548387 33.18077670322581, -104.45184141290324 33.18069661935484, -104.45182869032259 33.18061653548387, -104.45181596774194 33.1805364516129, -104.4518032451613 33.18045636774194, -104.45179052258065 33.18037628387097, -104.4517778 33.1802962, -104.45176507741937 33.18021611612903, -104.45175235483872 33.18013603225806, -104.45173963225807 33.1800559483871, -104.45172690967742 33.17997586451613, -104.45171418709678 33.17989578064516, -104.45170146451613 33.17981569677419, -104.45168874193548 33.17973561290323, -104.45167601935485 33.17965552903226, -104.4516632967742 33.17957544516129, -104.45165057419355 33.17949536129032, -104.45163785161292 33.17941527741935, -104.45162512903227 33.17933519354839, -104.45161240645162 33.17925510967742, -104.45159968387097 33.17917502580645, -104.45158696129033 33.17909494193548, -104.45157423870968 33.17901485806452, -104.45156151612903 33.17893477419355, -104.4515487935484 33.17885469032258, -104.45153607096775 33.17877460645161, -104.4515233483871 33.17869452258065, -104.45151062580646 33.17861443870968, -104.45149790322581 33.17853435483871, -104.45148518064516 33.17845427096774, -104.45147245806452 33.17837418709677, -104.45145973548388 33.17829410322581, -104.45144701290323 33.17821401935484, -104.45143429032258 33.17813393548387, -104.45142156774195 33.1780538516129, -104.4514088451613 33.17797376774194, -104.45139612258065 33.17789368387097, -104.45138340000001 33.1778136, -104.45137067741936 33.17773351612903, -104.45135795483871 33.17765343225806, -104.45134523225808 33.1775733483871, -104.45133250967743 33.17749326451613, -104.45131978709678 33.17741318064516, -104.45130706451613 33.17733309677419, -104.4512943419355 33.17725301290323, -104.45128161935484 33.17717292903226, -104.4512688967742 33.17709284516129, -104.45125617419356 33.17701276129032, -104.45124345161291 33.17693267741935, -104.45123072903226 33.17685259354839, -104.45121800645163 33.17677250967742, -104.45120528387098 33.17669242580645, -104.45119256129033 33.17661234193548, -104.45117983870968 33.17653225806452, -104.45116711612904 33.17645217419355, -104.45115439354839 33.17637209032258, -104.45114167096774 33.17629200645161, -104.45112894838711 33.17621192258065, -104.45111622580646 33.17613183870968, -104.45110350322581 33.17605175483871, -104.45109078064517 33.17597167096774, -104.45107805806452 33.17589158709677, -104.45106533548388 33.17581150322581, -104.45105261290323 33.17573141935484, -104.45103989032259 33.17565133548387, -104.45102716774194 33.1755712516129, -104.45101444516129 33.17549116774194, -104.45100172258066 33.17541108387097, -104.450989 33.175331, -104.45097635632185 33.17525093103448, -104.45096371264368 33.17517086206897, -104.45095106896552 33.17509079310345, -104.45093842528736 33.175010724137934, -104.4509257816092 33.17493065517241, -104.45091313793104 33.174850586206894, -104.45090049425288 33.17477051724138, -104.45088785057472 33.17469044827586, -104.45087520689655 33.174610379310344, -104.4508625632184 33.17453031034483, -104.45084991954023 33.17445024137931, -104.45083727586207 33.174370172413795, -104.45082463218391 33.17429010344828, -104.45081198850575 33.17421003448276, -104.45079934482759 33.17412996551724, -104.45078670114943 33.17404989655172, -104.45077405747126 33.173969827586205, -104.4507614137931 33.17388975862069, -104.45074877011494 33.17380968965517, -104.45073612643678 33.173729620689656, -104.45072348275862 33.17364955172414, -104.45071083908047 33.17356948275862, -104.45069819540231 33.17348941379311, -104.45068555172415 33.17340934482759, -104.45067290804599 33.173329275862066, -104.45066026436783 33.17324920689655, -104.45064762068967 33.17316913793103, -104.4506349770115 33.17308906896552, -104.45062233333334 33.173009, -104.45060968965518 33.172928931034484, -104.45059704597702 33.17284886206897, -104.45058440229886 33.17276879310345, -104.4505717586207 33.172688724137934, -104.45055911494254 33.17260865517241, -104.45054647126437 33.172528586206894, -104.45053382758621 33.17244851724138, -104.45052118390805 33.17236844827586, -104.45050854022989 33.172288379310345, -104.45049589655173 33.17220831034483, -104.45048325287357 33.17212824137931, -104.4504706091954 33.172048172413795, -104.45045796551724 33.17196810344828, -104.45044532183908 33.17188803448276, -104.45043267816092 33.17180796551724, -104.45042003448276 33.17172789655172, -104.4504073908046 33.171647827586206, -104.45039474712644 33.17156775862069, -104.45038210344828 33.17148768965517, -104.45036945977012 33.171407620689656, -104.45035681609195 33.17132755172414, -104.45034417241379 33.17124748275862, -104.45033152873563 33.17116741379311, -104.45031888505747 33.17108734482759, -104.45030624137931 33.17100727586207, -104.45029359770115 33.17092720689655, -104.45028095402299 33.170847137931034, -104.45026831034482 33.17076706896552, -104.45025566666666 33.170687, -104.4502430229885 33.170606931034484, -104.45023037931034 33.17052686206897, -104.45021773563218 33.17044679310345, -104.45020509195402 33.170366724137935, -104.45019244827586 33.17028665517241, -104.4501798045977 33.170206586206895, -104.45016716091953 33.17012651724138, -104.45015451724139 33.17004644827586, -104.45014187356323 33.169966379310345, -104.45012922988506 33.16988631034483, -104.4501165862069 33.16980624137931, -104.45010394252874 33.169726172413796, -104.45009129885058 33.16964610344828, -104.45007865517242 33.16956603448276, -104.45006601149426 33.16948596551724, -104.4500533678161 33.16940589655172, -104.45004072413793 33.169325827586206, -104.45002808045977 33.16924575862069, -104.45001543678161 33.16916568965517, -104.45000279310345 33.16908562068966, -104.44999014942529 33.16900555172414, -104.44997750574713 33.168925482758624, -104.44996486206897 33.16884541379311, -104.4499522183908 33.16876534482759, -104.44993957471264 33.16868527586207, -104.44992693103448 33.16860520689655, -104.44991428735632 33.168525137931034, -104.44990164367816 33.16844506896552, -104.449889 33.168365, -104.44987611111111 33.168283333333335, -104.44986322222222 33.16820166666667, -104.44985033333333 33.16812, -104.44983744444444 33.168038333333335, -104.44982455555555 33.16795666666667, -104.44981166666666 33.167875, -104.44979877777777 33.167793333333336, -104.44978588888888 33.16771166666667, -104.449773 33.16763, -104.44976039240505 33.16754989873418, -104.44974778481011 33.16746979746836, -104.44973517721519 33.167389696202534, -104.44972256962025 33.16730959493671, -104.44970996202531 33.16722949367089, -104.44969735443037 33.167149392405065, -104.44968474683544 33.16706929113924, -104.4496721392405 33.16698918987342, -104.44965953164557 33.166909088607596, -104.44964692405063 33.16682898734177, -104.44963431645569 33.16674888607595, -104.44962170886076 33.16666878481013, -104.44960910126582 33.166588683544305, -104.44959649367088 33.16650858227848, -104.44958388607594 33.16642848101266, -104.449571278481 33.166348379746836, -104.44955867088608 33.16626827848101, -104.44954606329114 33.16618817721519, -104.4495334556962 33.16610807594937, -104.44952084810126 33.166027974683544, -104.44950824050633 33.16594787341772, -104.4494956329114 33.1658677721519, -104.44948302531645 33.165787670886075, -104.44947041772151 33.16570756962025, -104.44945781012657 33.16562746835443, -104.44944520253165 33.16554736708861, -104.44943259493671 33.165467265822784, -104.44941998734177 33.16538716455696, -104.44940737974683 33.16530706329114, -104.44939477215189 33.165226962025315, -104.44938216455697 33.16514686075949, -104.44936955696203 33.16506675949367, -104.44935694936709 33.164986658227846, -104.44934434177215 33.16490655696202, -104.44933173417722 33.1648264556962, -104.44931912658228 33.16474635443038, -104.44930651898734 33.164666253164555, -104.4492939113924 33.16458615189873, -104.44928130379746 33.16450605063291, -104.44926869620254 33.16442594936709, -104.4492560886076 33.16434584810127, -104.44924348101266 33.16426574683545, -104.44923087341772 33.164185645569624, -104.44921826582278 33.1641055443038, -104.44920565822785 33.16402544303798, -104.44919305063291 33.163945341772155, -104.44918044303797 33.16386524050633, -104.44916783544303 33.16378513924051, -104.44915522784811 33.16370503797469, -104.44914262025317 33.163624936708864, -104.44913001265823 33.16354483544304, -104.44911740506329 33.16346473417722, -104.44910479746835 33.163384632911395, -104.44909218987343 33.16330453164557, -104.44907958227849 33.16322443037975, -104.44906697468355 33.163144329113926, -104.4490543670886 33.1630642278481, -104.44904175949367 33.16298412658228, -104.44902915189874 33.16290402531646, -104.4490165443038 33.162823924050635, -104.44900393670886 33.16274382278481, -104.44899132911392 33.16266372151899, -104.448978721519 33.162583620253166, -104.44896611392406 33.16250351898734, -104.44895350632912 33.16242341772152, -104.44894089873418 33.1623433164557, -104.44892829113924 33.162263215189874, -104.44891568354431 33.16218311392405, -104.44890307594937 33.16210301265823, -104.44889046835443 33.162022911392405, -104.4488778607595 33.16194281012658, -104.44886525316456 33.16186270886076, -104.44885264556963 33.16178260759494, -104.44884003797469 33.161702506329114, -104.44882743037975 33.16162240506329, -104.44881482278481 33.16154230379747, -104.44880221518989 33.161462202531645, -104.44878960759495 33.16138210126582, -104.448777 33.161302, -104.448766 33.16123025, -104.448755 33.1611585, -104.448744 33.161086749999996, -104.448733 33.161015, -104.4487205873016 33.160935238095234, -104.44870817460318 33.16085547619048, -104.44869576190477 33.16077571428571, -104.44868334920635 33.160695952380955, -104.44867093650794 33.16061619047619, -104.44865852380953 33.160536428571426, -104.44864611111112 33.16045666666667, -104.4486336984127 33.160376904761904, -104.4486212857143 33.16029714285714, -104.44860887301587 33.16021738095238, -104.44859646031746 33.16013761904762, -104.44858404761905 33.16005785714286, -104.44857163492064 33.159978095238095, -104.44855922222223 33.15989833333333, -104.44854680952382 33.15981857142857, -104.4485343968254 33.15973880952381, -104.44852198412698 33.159659047619044, -104.44850957142857 33.15957928571429, -104.44849715873016 33.15949952380952, -104.44848474603175 33.159419761904765, -104.44847233333334 33.15934, -104.44845992063493 33.159260238095236, -104.4484475079365 33.15918047619048, -104.4484350952381 33.159100714285714, -104.44842268253969 33.159020952380956, -104.44841026984128 33.15894119047619, -104.44839785714287 33.15886142857143, -104.44838544444445 33.15878166666667, -104.44837303174603 33.158701904761905, -104.44836061904762 33.15862214285714, -104.44834820634921 33.15854238095238, -104.4483357936508 33.15846261904762, -104.44832338095239 33.15838285714286, -104.44831096825398 33.1583030952381, -104.44829855555555 33.15822333333333, -104.44828614285714 33.158143571428575, -104.44827373015873 33.15806380952381, -104.44826131746032 33.157984047619045, -104.44824890476191 33.15790428571429, -104.4482364920635 33.15782452380952, -104.44822407936508 33.157744761904766, -104.44821166666667 33.157665, -104.44819925396826 33.15758523809524, -104.44818684126984 33.15750547619048, -104.44817442857143 33.157425714285715, -104.44816201587302 33.15734595238096, -104.44814960317461 33.15726619047619, -104.44813719047619 33.15718642857143, -104.44812477777778 33.15710666666667, -104.44811236507937 33.157026904761906, -104.44809995238096 33.15694714285714, -104.44808753968255 33.156867380952384, -104.44807512698414 33.15678761904762, -104.44806271428571 33.15670785714286, -104.4480503015873 33.1566280952381, -104.44803788888889 33.15654833333333, -104.44802547619048 33.156468571428576, -104.44801306349207 33.15638880952381, -104.44800065079366 33.15630904761905, -104.44798823809523 33.15622928571429, -104.44797582539682 33.156149523809525, -104.44796341269841 33.15606976190477, -104.447951 33.15599, -104.447937 33.15590175, -104.447923 33.1558135, -104.44790900000001 33.15572525, -104.447895 33.155637, -104.44788219901478 33.15555695960591, -104.44786939802955 33.15547691921182, -104.44785659704434 33.15539687881773, -104.44784379605912 33.155316838423644, -104.4478309950739 33.155236798029556, -104.44781819408867 33.15515675763547, -104.44780539310345 33.15507671724138, -104.44779259211823 33.15499667684729, -104.447779791133 33.1549166364532, -104.44776699014778 33.15483659605911, -104.44775418916257 33.154756555665024, -104.44774138817735 33.154676515270936, -104.44772858719212 33.15459647487685, -104.4477157862069 33.15451643448276, -104.44770298522168 33.15443639408867, -104.44769018423645 33.15435635369458, -104.44767738325123 33.15427631330049, -104.44766458226601 33.154196272906404, -104.4476517812808 33.154116232512315, -104.44763898029557 33.15403619211823, -104.44762617931035 33.15395615172414, -104.44761337832513 33.15387611133005, -104.4476005773399 33.15379607093596, -104.44758777635468 33.15371603054187, -104.44757497536946 33.153635990147784, -104.44756217438425 33.153555949753695, -104.44754937339901 33.15347590935961, -104.4475365724138 33.15339586896552, -104.44752377142858 33.15331582857143, -104.44751097044335 33.15323578817734, -104.44749816945813 33.15315574778325, -104.44748536847291 33.15307570738916, -104.4474725674877 33.152995666995075, -104.44745976650246 33.152915626600986, -104.44744696551724 33.1528355862069, -104.44743416453203 33.15275554581281, -104.4474213635468 33.15267550541872, -104.44740856256158 33.15259546502463, -104.44739576157636 33.15251542463054, -104.44738296059114 33.152435384236455, -104.44737015960591 33.152355343842366, -104.44735735862069 33.15227530344828, -104.44734455763547 33.15219526305419, -104.44733175665024 33.1521152226601, -104.44731895566503 33.15203518226601, -104.44730615467981 33.15195514187192, -104.44729335369459 33.151875101477835, -104.44728055270936 33.151795061083746, -104.44726775172414 33.15171502068966, -104.44725495073892 33.15163498029557, -104.44724214975369 33.15155493990147, -104.44722934876847 33.151474899507384, -104.44721654778326 33.151394859113296, -104.44720374679804 33.15131481871921, -104.4471909458128 33.15123477832512, -104.44717814482759 33.15115473793103, -104.44716534384237 33.15107469753694, -104.44715254285714 33.15099465714285, -104.44713974187192 33.150914616748764, -104.4471269408867 33.150834576354676, -104.44711413990149 33.15075453596059, -104.44710133891626 33.1506744955665, -104.44708853793104 33.15059445517241, -104.44707573694582 33.15051441477832, -104.44706293596059 33.15043437438423, -104.44705013497537 33.150354333990144, -104.44703733399015 33.150274293596055, -104.44702453300494 33.15019425320197, -104.4470117320197 33.15011421280788, -104.44699893103449 33.15003417241379, -104.44698613004927 33.1499541320197, -104.44697332906404 33.14987409162561, -104.44696052807882 33.149794051231524, -104.4469477270936 33.149714010837435, -104.44693492610838 33.14963397044335, -104.44692212512315 33.14955393004926, -104.44690932413793 33.14947388965517, -104.44689652315272 33.14939384926108, -104.44688372216748 33.14931380886699, -104.44687092118227 33.149233768472904, -104.44685812019705 33.149153728078815, -104.44684531921183 33.14907368768473, -104.4468325182266 33.14899364729064, -104.44681971724138 33.14891360689655, -104.44680691625616 33.14883356650246, -104.44679411527093 33.14875352610837, -104.44678131428572 33.14867348571428, -104.4467685133005 33.148593445320195, -104.44675571231528 33.148513404926106, -104.44674291133005 33.14843336453202, -104.44673011034483 33.14835332413793, -104.44671730935961 33.14827328374384, -104.44670450837438 33.14819324334975, -104.44669170738916 33.14811320295566, -104.44667890640395 33.148033162561575, -104.44666610541873 33.147953122167486, -104.4466533044335 33.1478730817734, -104.44664050344828 33.14779304137931, -104.44662770246306 33.14771300098522, -104.44661490147783 33.14763296059113, -104.44660210049261 33.14755292019704, -104.4465892995074 33.147472879802955, -104.44657649852218 33.147392839408866, -104.44656369753694 33.14731279901478, -104.44655089655173 33.14723275862069, -104.44653809556651 33.1471527182266, -104.44652529458128 33.14707267783251, -104.44651249359606 33.14699263743842, -104.44649969261084 33.146912597044334, -104.44648689162563 33.146832556650246, -104.4464740906404 33.14675251625616, -104.44646128965518 33.14667247586207, -104.44644848866996 33.14659243546798, -104.44643568768473 33.14651239507389, -104.44642288669951 33.1464323546798, -104.44641008571429 33.146352314285714, -104.44639728472907 33.146272273891626, -104.44638448374384 33.14619223349754, -104.44637168275862 33.14611219310345, -104.4463588817734 33.14603215270936, -104.44634608078817 33.14595211231527, -104.44633327980296 33.14587207192118, -104.44632047881774 33.145792031527094, -104.44630767783252 33.145711991133005, -104.44629487684729 33.14563195073892, -104.44628207586207 33.14555191034483, -104.44626927487685 33.14547186995074, -104.44625647389162 33.14539182955665, -104.4462436729064 33.14531178916256, -104.44623087192119 33.145231748768474, -104.44621807093597 33.145151708374385, -104.44620526995074 33.1450716679803, -104.44619246896552 33.14499162758621, -104.4461796679803 33.14491158719212, -104.44616686699507 33.14483154679803, -104.44615406600985 33.14475150640394, -104.44614126502464 33.144671466009854, -104.44612846403942 33.144591425615765, -104.44611566305419 33.144511385221676, -104.44610286206897 33.14443134482759, -104.44609006108375 33.1443513044335, -104.44607726009852 33.14427126403941, -104.4460644591133 33.14419122364532, -104.44605165812808 33.14411118325123, -104.44603885714287 33.144031142857145, -104.44602605615763 33.143951102463056, -104.44601325517242 33.14387106206897, -104.4460004541872 33.14379102167488, -104.44598765320197 33.14371098128079, -104.44597485221675 33.1436309408867, -104.44596205123153 33.14355090049261, -104.44594925024631 33.143470860098525, -104.44593644926108 33.14339081970443, -104.44592364827587 33.14331077931034, -104.44591084729065 33.14323073891625, -104.44589804630542 33.14315069852216, -104.4458852453202 33.143070658128075, -104.44587244433498 33.142990617733986, -104.44585964334976 33.1429105773399, -104.44584684236453 33.14283053694581, -104.44583404137931 33.14275049655172, -104.4458212403941 33.14267045615763, -104.44580843940886 33.14259041576354, -104.44579563842365 33.142510375369454, -104.44578283743843 33.142430334975366, -104.44577003645321 33.14235029458128, -104.44575723546798 33.14227025418719, -104.44574443448276 33.1421902137931, -104.44573163349754 33.14211017339901, -104.44571883251231 33.14203013300492, -104.4457060315271 33.141950092610834, -104.44569323054188 33.141870052216746, -104.44568042955666 33.14179001182266, -104.44566762857143 33.14170997142857, -104.44565482758621 33.14162993103448, -104.44564202660099 33.14154989064039, -104.44562922561576 33.1414698502463, -104.44561642463054 33.141389809852214, -104.44560362364533 33.141309769458125, -104.44559082266011 33.14122972906404, -104.44557802167488 33.14114968866995, -104.44556522068966 33.14106964827586, -104.44555241970444 33.14098960788177, -104.44553961871921 33.14090956748768, -104.44552681773399 33.140829527093594, -104.44551401674877 33.140749486699505, -104.44550121576356 33.14066944630542, -104.44548841477832 33.14058940591133, -104.4454756137931 33.14050936551724, -104.44546281280789 33.14042932512315, -104.44545001182266 33.14034928472906, -104.44543721083744 33.140269244334974, -104.44542440985222 33.140189203940885, -104.445411608867 33.140109163546796, -104.44539880788177 33.14002912315271, -104.44538600689656 33.13994908275862, -104.44537320591134 33.13986904236453, -104.4453604049261 33.13978900197044, -104.44534760394089 33.13970896157635, -104.44533480295567 33.139628921182265, -104.44532200197045 33.139548880788176, -104.44530920098522 33.13946884039409, -104.4452964 33.1393888, -104.44528374468085 33.13930872482269, -104.44527108936171 33.13922864964539, -104.44525843404256 33.13914857446808, -104.4452457787234 33.13906849929078, -104.44523312340426 33.13898842411347, -104.44522046808511 33.13890834893617, -104.44520781276596 33.13882827375886, -104.44519515744682 33.13874819858156, -104.44518250212766 33.13866812340425, -104.44516984680851 33.13858804822695, -104.44515719148937 33.13850797304964, -104.44514453617022 33.13842789787234, -104.44513188085106 33.13834782269503, -104.44511922553191 33.13826774751773, -104.44510657021277 33.13818767234042, -104.44509391489362 33.13810759716312, -104.44508125957447 33.13802752198581, -104.44506860425533 33.13794744680851, -104.44505594893617 33.1378673716312, -104.44504329361702 33.1377872964539, -104.44503063829788 33.13770722127659, -104.44501798297873 33.13762714609929, -104.44500532765957 33.13754707092198, -104.44499267234043 33.13746699574468, -104.44498001702128 33.13738692056737, -104.44496736170213 33.13730684539007, -104.44495470638299 33.13722677021276, -104.44494205106383 33.13714669503546, -104.44492939574468 33.13706661985815, -104.44491674042554 33.13698654468085, -104.44490408510639 33.13690646950354, -104.44489142978723 33.13682639432624, -104.4448787744681 33.13674631914893, -104.44486611914894 33.13666624397163, -104.44485346382979 33.136586168794324, -104.44484080851063 33.13650609361702, -104.4448281531915 33.136426018439714, -104.44481549787234 33.13634594326241, -104.44480284255319 33.136265868085104, -104.44479018723405 33.1361857929078, -104.4447775319149 33.136105717730494, -104.44476487659574 33.13602564255319, -104.4447522212766 33.135945567375884, -104.44473956595745 33.13586549219858, -104.4447269106383 33.135785417021275, -104.44471425531916 33.13570534184397, -104.4447016 33.135625266666665, -104.44468894468085 33.135545191489356, -104.44467628936171 33.135465116312055, -104.44466363404256 33.13538504113475, -104.4446509787234 33.135304965957445, -104.44463832340426 33.13522489078014, -104.44462566808511 33.135144815602835, -104.44461301276596 33.13506474042553, -104.44460035744682 33.134984665248226, -104.44458770212766 33.13490459007092, -104.44457504680851 33.134824514893616, -104.44456239148937 33.13474443971631, -104.44454973617022 33.134664364539006, -104.44453708085106 33.1345842893617, -104.44452442553191 33.134504214184396, -104.44451177021277 33.13442413900709, -104.44449911489362 33.134344063829786, -104.44448645957446 33.13426398865248, -104.44447380425532 33.13418391347518, -104.44446114893617 33.13410383829787, -104.44444849361702 33.13402376312057, -104.44443583829788 33.13394368794326, -104.44442318297872 33.13386361276596, -104.44441052765957 33.13378353758865, -104.44439787234043 33.13370346241135, -104.44438521702128 33.13362338723404, -104.44437256170212 33.13354331205674, -104.44435990638299 33.13346323687943, -104.44434725106383 33.13338316170213, -104.44433459574468 33.13330308652482, -104.44432194042554 33.13322301134752, -104.44430928510639 33.13314293617021, -104.44429662978723 33.13306286099291, -104.44428397446809 33.1329827858156, -104.44427131914894 33.1329027106383, -104.44425866382979 33.13282263546099, -104.44424600851063 33.13274256028369, -104.44423335319149 33.13266248510638, -104.44422069787234 33.13258240992908, -104.44420804255319 33.13250233475177, -104.44419538723405 33.13242225957447, -104.44418273191489 33.13234218439716, -104.44417007659574 33.13226210921986, -104.4441574212766 33.13218203404255, -104.44414476595745 33.13210195886525, -104.4441321106383 33.13202188368794, -104.44411945531915 33.13194180851064, -104.4441068 33.13186173333333, -104.44409414468085 33.13178165815602, -104.44408148936171 33.13170158297872, -104.44406883404255 33.13162150780141, -104.4440561787234 33.13154143262411, -104.44404352340426 33.1314613574468, -104.44403086808511 33.1313812822695, -104.44401821276595 33.13130120709219, -104.44400555744681 33.13122113191489, -104.44399290212766 33.13114105673758, -104.44398024680851 33.13106098156028, -104.44396759148937 33.13098090638297, -104.44395493617021 33.13090083120567, -104.44394228085106 33.13082075602836, -104.44392962553191 33.13074068085106, -104.44391697021277 33.130660605673754, -104.44390431489362 33.13058053049645, -104.44389165957446 33.130500455319144, -104.44387900425532 33.13042038014184, -104.44386634893617 33.130340304964534, -104.44385369361702 33.13026022978723, -104.44384103829788 33.130180154609924, -104.44382838297872 33.13010007943262, -104.44381572765957 33.130020004255314, -104.44380307234043 33.12993992907801, -104.44379041702128 33.129859853900705, -104.44377776170212 33.1297797787234, -104.44376510638298 33.129699703546095, -104.44375245106383 33.12961962836879, -104.44373979574468 33.129539553191485, -104.44372714042554 33.129459478014184, -104.44371448510638 33.129379402836875, -104.44370182978723 33.129299327659574, -104.44368917446809 33.129219252482265, -104.44367651914894 33.129139177304964, -104.44366386382978 33.129059102127655, -104.44365120851063 33.128979026950354, -104.44363855319149 33.128898951773046, -104.44362589787234 33.128818876595744, -104.44361324255318 33.128738801418436, -104.44360058723404 33.128658726241135, -104.44358793191489 33.128578651063826, -104.44357527659574 33.128498575886525, -104.4435626212766 33.128418500709216, -104.44354996595744 33.128338425531915, -104.44353731063829 33.128258350354606, -104.44352465531915 33.128178275177305, -104.443512 33.1280982, -104.44350094117647 33.128018811764704, -104.44348988235294 33.12793942352941, -104.4434788235294 33.12786003529411, -104.44346776470589 33.12778064705882, -104.44345670588235 33.12770125882353, -104.44344564705882 33.127621870588236, -104.44343458823529 33.127542482352936, -104.44342352941176 33.127463094117644, -104.44341247058823 33.12738370588235, -104.4434014117647 33.12730431764706, -104.44339035294118 33.12722492941176, -104.44337929411765 33.12714554117647, -104.44336823529412 33.127066152941175, -104.44335717647058 33.12698676470588, -104.44334611764705 33.126907376470584, -104.44333505882352 33.12682798823529, -104.44332399999999 33.1267486, -104.44331294117647 33.12666921176471, -104.44330188235294 33.126589823529415, -104.44329082352941 33.126510435294115, -104.44327976470588 33.12643104705882, -104.44326870588235 33.12635165882353, -104.44325764705881 33.12627227058824, -104.4432465882353 33.12619288235294, -104.44323552941177 33.12611349411765, -104.44322447058823 33.126034105882354, -104.4432134117647 33.12595471764706, -104.44320235294117 33.12587532941176, -104.44319129411764 33.12579594117647, -104.44318023529411 33.12571655294118, -104.44316917647059 33.125637164705886, -104.44315811764706 33.125557776470586, -104.44314705882353 33.125478388235294, -104.443136 33.125399, -104.4431237142857 33.125320571428574, -104.44311142857143 33.12524214285715, -104.44309914285714 33.12516371428572, -104.44308685714286 33.125085285714285, -104.44307457142857 33.12500685714286, -104.44306228571429 33.12492842857143, -104.44305 33.12485, -104.44303738461538 33.12476971428572, -104.44302476923077 33.12468942857143, -104.44301215384615 33.124609142857146, -104.44299953846154 33.124528857142856, -104.44298692307692 33.12444857142857, -104.44297430769231 33.12436828571429, -104.44296169230769 33.124288, -104.44294907692307 33.12420771428572, -104.44293646153847 33.124127428571434, -104.44292384615385 33.124047142857144, -104.44291123076923 33.12396685714286, -104.44289861538462 33.12388657142857, -104.442886 33.12380628571429, -104.44287338461538 33.123726000000005, -104.44286076923076 33.123645714285715, -104.44284815384616 33.12356542857143, -104.44283553846154 33.12348514285714, -104.44282292307692 33.12340485714286, -104.44281030769231 33.123324571428576, -104.44279769230769 33.123244285714286, -104.44278507692307 33.123164, -104.44277246153847 33.12308371428572, -104.44275984615385 33.12300342857143, -104.44274723076923 33.12292314285715, -104.44273461538461 33.12284285714286, -104.442722 33.122762571428574, -104.44270938461538 33.12268228571429, -104.44269676923076 33.122602, -104.44268415384616 33.12252171428572, -104.44267153846154 33.12244142857143, -104.44265892307692 33.122361142857145, -104.4426463076923 33.12228085714286, -104.4426336923077 33.12220057142857, -104.44262107692307 33.12212028571429, -104.44260846153846 33.122040000000005, -104.44259584615385 33.121959714285715, -104.44258323076923 33.12187942857143, -104.44257061538461 33.12179914285714, -104.442558 33.12171885714286, -104.44254538461539 33.121638571428576, -104.44253276923077 33.121558285714286, -104.44252015384615 33.121478, -104.44250753846154 33.12139771428571, -104.44249492307692 33.12131742857143, -104.4424823076923 33.12123714285715, -104.4424696923077 33.12115685714286, -104.44245707692308 33.121076571428574, -104.44244446153846 33.12099628571429, -104.44243184615385 33.120916, -104.44241923076923 33.12083571428572, -104.44240661538461 33.12075542857143, -104.442394 33.120675142857145, -104.44238138461539 33.12059485714286, -104.44236876923077 33.12051457142857, -104.44235615384615 33.12043428571429, -104.44234353846154 33.120354, -104.44233092307692 33.120273714285716, -104.4423183076923 33.12019342857143, -104.4423056923077 33.12011314285714, -104.44229307692308 33.12003285714286, -104.44228046153846 33.11995257142858, -104.44226784615384 33.11987228571429, -104.44225523076923 33.119792000000004, -104.44224261538461 33.119711714285714, -104.44223 33.11963142857143, -104.44221738461539 33.11955114285715, -104.44220476923077 33.11947085714286, -104.44219215384615 33.119390571428575, -104.44217953846153 33.119310285714285, -104.44216692307693 33.11923, -104.4421543076923 33.11914971428572, -104.44214169230769 33.11906942857143, -104.44212907692308 33.118989142857146, -104.44211646153846 33.11890885714286, -104.44210384615384 33.11882857142857, -104.44209123076924 33.11874828571429, -104.44207861538462 33.118668, -104.442066 33.11858771428572, -104.44205338461538 33.118507428571434, -104.44204076923077 33.11842714285714, -104.44202815384615 33.11834685714286, -104.44201553846153 33.11826657142857, -104.44200292307693 33.11818628571429, -104.44199030769231 33.118106000000004, -104.44197769230769 33.118025714285714, -104.44196507692308 33.11794542857143, -104.44195246153846 33.11786514285715, -104.44193984615384 33.11778485714286, -104.44192723076922 33.117704571428575, -104.44191461538462 33.117624285714285, -104.441902 33.117544, -104.4418897 33.117465800000005, -104.4418774 33.1173876, -104.4418651 33.1173094, -104.44185279999999 33.1172312, -104.4418405 33.117153, -104.4418282 33.117074800000005, -104.4418159 33.1169966, -104.4418036 33.1169184, -104.44179129999999 33.1168402, -104.441779 33.116762, -104.441774125 33.11668234375, -104.44176925 33.1166026875, -104.44176437499999 33.116523031250004, -104.4417595 33.116443375, -104.441754625 33.11636371875, -104.44174975 33.1162840625, -104.441744875 33.11620440625, -104.44174 33.11612475, -104.441735125 33.11604509375, -104.44173025 33.1159654375, -104.441725375 33.11588578125, -104.4417205 33.115806125, -104.441715625 33.11572646875, -104.44171075 33.1156468125, -104.441705875 33.11556715625, -104.441701 33.1154875, -104.441696125 33.11540784375, -104.44169125 33.1153281875, -104.441686375 33.11524853125, -104.4416815 33.115168875, -104.441676625 33.11508921875, -104.44167175 33.1150095625, -104.44166687500001 33.11492990625, -104.44166200000001 33.11485025, -104.441657125 33.11477059375, -104.44165225 33.1146909375, -104.441647375 33.11461128125, -104.4416425 33.114531625, -104.44163762500001 33.11445196875, -104.44163275000001 33.1143723125, -104.44162787500001 33.11429265625, -104.441623 33.114213, -104.44162402272728 33.11413361363636, -104.44162504545456 33.114054227272725, -104.44162606818182 33.11397484090909, -104.4416270909091 33.11389545454546, -104.44162811363637 33.11381606818182, -104.44162913636364 33.11373668181818, -104.44163015909092 33.113657295454544, -104.4416311818182 33.11357790909091, -104.44163220454546 33.11349852272727, -104.44163322727273 33.11341913636364, -104.44163425 33.11333975, -104.44163527272728 33.113260363636364, -104.44163629545456 33.11318097727273, -104.44163731818182 33.11310159090909, -104.4416383409091 33.11302220454545, -104.44163936363637 33.11294281818182, -104.44164038636364 33.112863431818184, -104.44164140909092 33.112784045454546, -104.4416424318182 33.11270465909091, -104.44164345454546 33.11262527272727, -104.44164447727273 33.112545886363634, -104.4416455 33.1124665, -104.44164652272728 33.112387113636366, -104.44164754545456 33.11230772727273, -104.44164856818182 33.11222834090909, -104.4416495909091 33.112148954545454, -104.44165061363637 33.112069568181816, -104.44165163636364 33.11199018181818, -104.44165265909092 33.11191079545455, -104.4416536818182 33.11183140909091, -104.44165470454546 33.11175202272727, -104.44165572727273 33.111672636363636, -104.44165675 33.11159325, -104.44165777272728 33.11151386363636, -104.44165879545456 33.11143447727273, -104.44165981818182 33.11135509090909, -104.4416608409091 33.111275704545456, -104.44166186363637 33.11119631818182, -104.44166288636364 33.11111693181818, -104.44166390909092 33.11103754545454, -104.4416649318182 33.11095815909091, -104.44166595454546 33.110878772727276, -104.44166697727273 33.11079938636364, -104.441668 33.11072, -104.44166914285715 33.110637714285716, -104.4416702857143 33.11055542857143, -104.44167142857144 33.110473142857145, -104.44167257142857 33.11039085714287, -104.44167371428571 33.11030857142858, -104.44167485714286 33.1102262857143, -104.441676 33.11014400000001, -104.44167999999999 33.11005150000001, -104.441684 33.109959, -104.44168709677419 33.10987996774194, -104.44169019354838 33.109800935483875, -104.44169329032258 33.10972190322581, -104.44169638709677 33.10964287096775, -104.44169948387096 33.10956383870968, -104.44170258064516 33.10948480645162, -104.44170567741935 33.109405774193554, -104.44170877419354 33.10932674193548, -104.44171187096774 33.10924770967742, -104.44171496774193 33.109168677419355, -104.44171806451612 33.10908964516129, -104.44172116129032 33.109010612903226, -104.44172425806451 33.10893158064516, -104.4417273548387 33.1088525483871, -104.4417304516129 33.108773516129034, -104.44173354838709 33.10869448387097, -104.44173664516128 33.108615451612906, -104.44173974193548 33.10853641935484, -104.44174283870967 33.10845738709678, -104.44174593548387 33.10837835483871, -104.44174903225806 33.10829932258065, -104.44175212903225 33.108220290322585, -104.44175522580645 33.10814125806452, -104.44175832258064 33.10806222580645, -104.44176141935483 33.107983193548385, -104.44176451612903 33.10790416129032, -104.44176761290322 33.10782512903226, -104.44177070967741 33.10774609677419, -104.44177380645161 33.10766706451613, -104.4417769032258 33.107588032258064, -104.44178 33.107509, -104.44178155087718 33.10742840350877, -104.44178310175438 33.10734780701755, -104.44178465263157 33.10726721052632, -104.44178620350877 33.107186614035086, -104.44178775438596 33.10710601754386, -104.44178930526316 33.10702542105263, -104.44179085614034 33.1069448245614, -104.44179240701754 33.10686422807018, -104.44179395789473 33.10678363157895, -104.44179550877193 33.10670303508772, -104.44179705964912 33.10662243859649, -104.4417986105263 33.106541842105266, -104.4418001614035 33.106461245614035, -104.4418017122807 33.106380649122805, -104.4418032631579 33.10630005263158, -104.44180481403508 33.10621945614035, -104.44180636491228 33.10613885964912, -104.44180791578947 33.1060582631579, -104.44180946666667 33.10597766666667, -104.44181101754386 33.10589707017544, -104.44181256842106 33.105816473684214, -104.44181411929824 33.105735877192984, -104.44181567017543 33.105655280701754, -104.44181722105263 33.10557468421053, -104.44181877192982 33.1054940877193, -104.44182032280702 33.10541349122807, -104.4418218736842 33.10533289473685, -104.4418234245614 33.10525229824562, -104.44182497543859 33.10517170175439, -104.4418265263158 33.105091105263156, -104.44182807719298 33.10501050877193, -104.44182962807018 33.1049299122807, -104.44183117894737 33.10484931578947, -104.44183272982457 33.10476871929825, -104.44183428070176 33.10468812280702, -104.44183583157894 33.10460752631579, -104.44183738245614 33.104526929824566, -104.44183893333333 33.104446333333335, -104.44184048421053 33.104365736842105, -104.44184203508772 33.10428514035088, -104.44184358596492 33.10420454385965, -104.4418451368421 33.10412394736842, -104.4418466877193 33.1040433508772, -104.44184823859649 33.10396275438597, -104.4418497894737 33.10388215789474, -104.44185134035088 33.103801561403515, -104.44185289122807 33.103720964912284, -104.44185444210527 33.103640368421054, -104.44185599298245 33.103559771929824, -104.44185754385965 33.1034791754386, -104.44185909473684 33.10339857894737, -104.44186064561404 33.10331798245614, -104.44186219649123 33.10323738596492, -104.44186374736843 33.10315678947369, -104.44186529824562 33.103076192982456, -104.44186684912282 33.10299559649123, -104.4418684 33.102915, -104.44187122790699 33.10283516511628, -104.44187405581395 33.10275533023256, -104.44187688372094 33.10267549534884, -104.4418797116279 33.10259566046512, -104.44188253953489 33.1025158255814, -104.44188536744187 33.10243599069768, -104.44188819534884 33.10235615581396, -104.44189102325582 33.10227632093024, -104.44189385116279 33.102196486046516, -104.44189667906977 33.102116651162795, -104.44189950697675 33.102036816279075, -104.44190233488372 33.101956981395354, -104.4419051627907 33.10187714651163, -104.44190799069767 33.10179731162791, -104.44191081860465 33.10171747674419, -104.44191364651164 33.10163764186047, -104.4419164744186 33.10155780697675, -104.44191930232559 33.10147797209303, -104.44192213023256 33.10139813720931, -104.44192495813954 33.10131830232559, -104.44192778604652 33.10123846744187, -104.44193061395349 33.10115863255814, -104.44193344186047 33.10107879767442, -104.44193626976745 33.1009989627907, -104.44193909767442 33.10091912790698, -104.4419419255814 33.100839293023256, -104.44194475348837 33.100759458139535, -104.44194758139535 33.100679623255814, -104.44195040930234 33.100599788372094, -104.4419532372093 33.10051995348837, -104.44195606511629 33.10044011860465, -104.44195889302325 33.10036028372093, -104.44196172093024 33.10028044883721, -104.44196454883722 33.10020061395349, -104.44196737674419 33.10012077906977, -104.44197020465117 33.10004094418605, -104.44197303255814 33.09996110930233, -104.44197586046512 33.09988127441861, -104.4419786883721 33.099801439534886, -104.44198151627907 33.099721604651165, -104.44198434418605 33.099641769767445, -104.44198717209302 33.099561934883724, -104.44199 33.0994821)"
)


# COMMAND ----------


def build_vehicle_type_speed_map(speed_restrictions, logistics_restrictions):
    # speed_restrictions includes data for the passenger speed limits and buses
    # We'll grab the bus data from speed_restrictions and add into the speed map
    # Logistics_restrictions includes data for commercial speed limits
    # VT Classes: 50 -> All trucks; 51 -> medium trucks; 52 -> heavy trucks
    final_mapping = {}
    speed_restrictions = filter(lambda r: r.vehicle_type == 17, speed_restrictions)
    speed_restrictions = list(filter(lambda r: r.timedom == None, speed_restrictions))

    for vehicle_mapping in speed_restrictions:
        curr_vt = vehicle_mapping.vehicle_type
        curr_limit = vehicle_mapping.maxspeed

        if curr_limit is not None:
            curr_limit = int(curr_limit)
            if curr_vt in final_mapping:
                if final_mapping[curr_vt] < curr_limit:
                    final_mapping[curr_vt] = curr_limit
            else:
                final_mapping[curr_vt] = curr_limit

    logistics_restrictions = filter(
        lambda r: r.VT == 50 or r.VT == 51 or r.VT == 52, logistics_restrictions
    )
    # ignore time-based restrictions
    logistics_restrictions = list(
        filter(lambda r: r.time_domains == None, logistics_restrictions)
    )
    # build a map of VT => speed limit make sure to select highest value by VT
    # TODO: Do I need to look at the highest SEQNR?
    for vehicle_mapping in logistics_restrictions:
        curr_vt = vehicle_mapping.VT
        curr_limit = vehicle_mapping.LIMIT

        if curr_limit is not None:
            curr_limit = int(curr_limit)
            if curr_vt in final_mapping:
                if final_mapping[curr_vt] < curr_limit:
                    final_mapping[curr_vt] = curr_limit
            else:
                final_mapping[curr_vt] = curr_limit

    return final_mapping if len(final_mapping) > 0 else None


vehicle_type_speed_map_udf = udf(
    build_vehicle_type_speed_map, MapType(IntegerType(), IntegerType())
)

# COMMAND ----------

# DBTITLE 1,Map Match Helper Functions


def process_tomtom_speed_limits(tomtom_table_name: str):
    """fetches the most relevant speed limit. In the event there are multiple, fetches the maxspeed associated with the highest seqnum"""
    tomtom_sdf = spark.table(tomtom_table_name)
    tomtom_sdf = tomtom_sdf.filter(col("speed_restrictions").isNotNull()).withColumn(
        "maxspeed", max_passenger_speed_udf(col("speed_restrictions"))
    )

    tomtom_logistics = tomtom_sdf.filter(
        col("logistics_restrictions").isNotNull()
    ).withColumn(
        "vehicle_type_speed_map",
        vehicle_type_speed_map_udf(
            col("speed_restrictions"), col("logistics_restrictions")
        ),
    )

    final_tomtom = tomtom_sdf.alias("tomtom_sdf").join(
        tomtom_logistics.alias("tomtom_logistics"),
        col("tomtom_logistics.id") == col("tomtom_sdf.id"),
        how="left",
    )
    return final_tomtom.select(
        col("tomtom_sdf.id").alias("way_id"),
        col("tomtom_sdf.name").alias("name"),
        col("tomtom_sdf.maxspeed").alias("maxspeed"),
        col("tomtom_logistics.vehicle_type_speed_map").alias("vehicle_type_speed_map"),
        col("tomtom_sdf.maxspeed_unit").alias("maxspeed_unit"),
        col("tomtom_sdf.country_code").alias("country_code"),
        col("tomtom_sdf.state_code").alias("state_code"),
    )


def process_osm(osm_table_name: str):
    # Pre-processing: Only include ways that are vehicle roads. (Note this excludes link roads since they're a source of false positives)
    # See https://wiki.openstreetmap.org/wiki/Key:highway for more details
    SPEED_LIMIT_HIGHWAY_TAGS = [
        "motorway",
        "trunk",
        "primary",
        "secondary",
        "tertiary",
        "unclassified",
        "residential",
        "service",
        "living_street",
    ]
    return spark.table(osm_table_name).filter(
        col("highway").isin(SPEED_LIMIT_HIGHWAY_TAGS)
    )


def tomtom_map_match(tomtom_version_id: str, osm_version_id: str, region: str):
    """
    takes a tomtom extracted table, osm extracted table, and the name of the match table.
    Writes match data (osm_way_id, tomtom_way_id, osm_match_count, tomtom_match_count) to a table given by match_table_name.
    The match_table can potentially contain duplicate tomtom_way_ids for each osm_way_id. Further processing should be done
    on match_table by calling extract_best_match.
    """
    tomtom_ways = DBX_TABLE.tomtom_full_ways(tomtom_version_id, region)
    osm_ways = DBX_TABLE.osm_full_ways(osm_version_id, region)
    match_table_name = DBX_TABLE.osm_tomtom_matched_ways(
        osm_version_id, region, tomtom_version_id
    )

    tomtom_ways = spark.table(tomtom_ways).select(col("id").alias("way_id"), "wkt")

    # Pre-processing: Interpolate points and generate h3 res-13 strings for TomTom ways.
    tomtom_ways_interpolated = tomtom_ways.withColumn(
        "interpolated_wkt", line_string_linear_interp_udf(col("wkt"))
    )
    tomtom_ways_interpolated_h3 = tomtom_ways_interpolated.withColumn(
        "interpolated_h3", line_string_to_h3_str_udf(col("interpolated_wkt"), lit(13))
    ).withColumn("interpolated_h3_size", size("interpolated_h3"))
    tomtom_ways_interpolated_h3 = tomtom_ways_interpolated_h3.select(
        col("way_id").alias("tomtom_way_id"), "interpolated_h3", "interpolated_h3_size"
    )

    osm_way_nodes = process_osm(osm_ways)
    # Pre-processing: Interpolate nodes and generate h3 res-13 strings for OSM ways.
    osm_way_nodes = (
        osm_way_nodes.filter(size("nodes_lat_lng") > 1)
        .withColumn("geometry", get_line_string(col("nodes_lat_lng")))
        .select("way_id", "geometry")
    )

    osm_way_nodes_interpolated = osm_way_nodes.withColumn(
        "interpolated_wkt", line_string_linear_interp_udf(col("geometry"))
    )
    osm_way_nodes_interpolated_h3 = osm_way_nodes_interpolated.withColumn(
        "interpolated_h3", line_string_to_h3_str_udf(col("interpolated_wkt"), lit(13))
    ).withColumn("interpolated_h3_size", size("interpolated_h3"))
    osm_way_nodes_interpolated_h3 = osm_way_nodes_interpolated_h3.select(
        col("way_id").alias("osm_way_id"), "interpolated_h3", "interpolated_h3_size"
    )

    # Explode h3 columns
    osm_way_nodes_exploded = osm_way_nodes_interpolated_h3.withColumn(
        "osm_h3", explode("interpolated_h3")
    ).select("osm_way_id", "osm_h3")
    tomtom_ways_exploded = tomtom_ways_interpolated_h3.withColumn(
        "tomtom_h3", explode("interpolated_h3")
    ).select("tomtom_way_id", "tomtom_h3")

    # Perform a full join on the exploded h3 columns
    matching_ways = osm_way_nodes_exploded.join(
        tomtom_ways_exploded,
        (osm_way_nodes_exploded.osm_h3 == tomtom_ways_exploded.tomtom_h3),
        how="full_outer",
    )
    matching_ways = matching_ways.groupBy(["osm_way_id", "tomtom_way_id"]).agg(
        # tomtom_h3 and osm_h3 have the same cells since the group by aggregates cells
        # that are shared by tomtom and h3.
        collect_list(col("tomtom_h3")).alias("matched_h3")
    )
    matching_ways = (
        matching_ways.alias("matching_orig")
        .join(
            osm_way_nodes_interpolated_h3.alias("osm"),
            col("osm.osm_way_id") == col("matching_orig.osm_way_id"),
            how="left",
        )
        .join(
            tomtom_ways_interpolated_h3.alias("tomtom"),
            col("tomtom.tomtom_way_id") == col("matching_orig.tomtom_way_id"),
            how="left",
        )
        .select(
            "matching_orig.*",
            col("osm.interpolated_h3_size").alias("osm_interp_h3_size"),
            col("tomtom.interpolated_h3_size").alias("tomtom_interp_h3_size"),
        )
    )

    matching_ways.write.mode("overwrite").option("overwriteSchema", "True").saveAsTable(
        match_table_name
    )
    return True


def extract_best_match(matching_ways_table_name: str, processed_tomtom_sdf):
    """
    The general strategy for fetching the best match is as follows:
    We want to trade off reducing false positives for increasing false negatives.
    This is a strictly binary tradeoff since multiple TomTom ways can map to a single OSM way.
    1. Average the tomtom h3 size grouped by osm way id.
    2. Take the highest speed limit out of all matches >= the average.
    This ensures that we select the highest limit out of most probable matches.
    """
    matching_ways_sdf = spark.table(matching_ways_table_name)
    # Exclude unmatched ways
    reduced_sdf = matching_ways_sdf.filter(
        "osm_way_id is not null and tomtom_way_id is not null"
    )
    # count the size of the match array
    match_size_sdf = reduced_sdf.withColumn(
        "matched_h3_size", size(col("matched_h3"))
    ).drop("matched_h3")
    # Join with tomtom to get the speed limit
    match_size_sdf = (
        match_size_sdf.alias("match")
        .join(
            processed_tomtom_sdf.alias("tomtom"),
            (col("match.tomtom_way_id") == col("tomtom.way_id")),
        )
        .select("match.*", "tomtom.maxspeed")
    )
    # For each osm_way_id, fetch the average size of matches.
    df_50p = (
        (
            match_size_sdf.alias("a")
            .groupBy("osm_way_id")
            .agg(avg(col("matched_h3_size")).alias("avg_matched_h3_size"))
        )
        .join(match_size_sdf.alias("b"), col("a.osm_way_id") == col("b.osm_way_id"))
        .select("b.*", "avg_matched_h3_size")
    )
    # Select the greatest speed limit corresponding to ways that have a match size
    # greater than the average of matches for that way.
    df_top_50p = (
        df_50p.filter("matched_h3_size >= avg_matched_h3_size")
        .groupBy("osm_way_id")
        .agg(max(col("maxspeed")).alias("maxspeed"))
        .select("osm_way_id", "maxspeed")
    )
    # Get all ways that have the highest speed limit
    max_match_sdf = (
        match_size_sdf.alias("match")
        .join(
            df_top_50p.alias("top"),
            (col("match.osm_way_id") == col("top.osm_way_id"))
            & (col("match.maxspeed") == col("top.maxspeed")),
        )
        .join(
            df_50p.alias("matches_with_avg"),
            (col("matches_with_avg.osm_way_id") == col("match.osm_way_id"))
            & (col("matches_with_avg.tomtom_way_id") == col("match.tomtom_way_id")),
        )
        .select(
            "match.osm_way_id",
            "match.tomtom_way_id",
            "match.matched_h3_size",
            "match.osm_interp_h3_size",
            "match.tomtom_interp_h3_size",
            "matches_with_avg.avg_matched_h3_size",
        )
    )

    # Filter for ways that meet the minimum match size and which meet the minimum way overlap.

    # Require all matches for the speed limit to meet a minimum overlap percent
    # with the osm way.
    MIN_WAY_CUMULATIVE_COVERAGE_THRESHOLD_PCT = 0.5

    sum_matched_ways = (
        max_match_sdf.filter("osm_way_id IS NOT NULL AND tomtom_way_id IS NOT NULL")
        .groupBy("osm_way_id", "osm_interp_h3_size")
        .agg(sum("matched_h3_size").alias("sum_matched_h3_size"))
        .select("osm_way_id", "osm_interp_h3_size", "sum_matched_h3_size")
    )
    cumulative_pct_sum_way = sum_matched_ways.select(
        "osm_way_id",
        least(
            col("sum_matched_h3_size") / col("osm_interp_h3_size") * lit(100), lit(100)
        ).alias("way_cumulative_coverage_pct"),
    )
    max_match_sdf = (
        max_match_sdf.alias("match")
        .join(
            cumulative_pct_sum_way.alias("sum_matched"),
            col("match.osm_way_id") == col("sum_matched.osm_way_id"),
            "left",
        )
        .filter(
            f"way_cumulative_coverage_pct >= {MIN_WAY_CUMULATIVE_COVERAGE_THRESHOLD_PCT}"
        )
        .filter("match.matched_h3_size >= match.avg_matched_h3_size")
        .select("match.*", "sum_matched.way_cumulative_coverage_pct")
    )

    # Out of all matches, get the longest match size.
    df_longest_match = (
        max_match_sdf.groupBy("osm_way_id")
        .agg(max(col("matched_h3_size")).alias("length"))
        .select("osm_way_id", "length")
    )
    # Select the match with the longest match size.
    max_match_sdf = (
        max_match_sdf.alias("match")
        .join(
            df_longest_match.alias("longest"),
            (col("match.osm_way_id") == col("longest.osm_way_id"))
            & (col("match.matched_h3_size") == col("longest.length")),
        )
        .select(
            "match.osm_way_id",
            "match.tomtom_way_id",
            "match.matched_h3_size",
            "match.osm_interp_h3_size",
            "match.tomtom_interp_h3_size",
            "match.way_cumulative_coverage_pct",
        )
    )
    # If two tomtom ways tie for the same max length, select one at random.
    max_match_sdf = max_match_sdf.groupBy("osm_way_id").agg(
        first(col("tomtom_way_id")).alias("tomtom_way_id"),
        first(col("matched_h3_size")).alias("matched_h3_size"),
        first(col("osm_interp_h3_size")).alias("osm_interp_h3_size"),
        first(col("tomtom_interp_h3_size")).alias("tomtom_interp_h3_size"),
        first(col("way_cumulative_coverage_pct")).alias("way_cumulative_coverage_pct"),
    )
    return max_match_sdf


def join_matched_ways(tomtom_version_id: str, osm_version_id: str, region: str):
    """join_matched_ways takes the osm_table, tomtom_table, and match_table, and joins them."""
    tomtom_table_name = DBX_TABLE.tomtom_full_ways(tomtom_version_id, region)
    osm_table_name = DBX_TABLE.osm_full_ways(osm_version_id, region)
    matching_ways_table_name = DBX_TABLE.osm_tomtom_matched_ways(
        osm_version_id, region, tomtom_version_id
    )

    processed_tomtom = process_tomtom_speed_limits(tomtom_table_name)
    osm = process_osm(osm_table_name)
    best_matches = extract_best_match(matching_ways_table_name, processed_tomtom)

    map_match_and_tomtom = best_matches.alias("match").join(
        processed_tomtom.alias("tomtom"),
        col("tomtom.way_id") == col("match.tomtom_way_id"),
    )  # this is an inner join
    # Add OSM
    joined_result = map_match_and_tomtom.join(
        osm.alias("osm"), col("osm.way_id") == col("match.osm_way_id"), how="right"
    )
    # Grab only columns we care about
    selected = joined_result.select(
        col("osm.way_id").alias("osm_way_id"),
        col("tomtom.way_id").alias("tomtom_way_id"),
        osm_passenger_limit_unit_fixer_udf(lit(region), col("osm.maxspeed")).alias(
            "osm_maxspeed"
        ),
        col("osm.maxspeed").alias("osm_raw_maxspeed"),
        col("tomtom.maxspeed").alias("tomtom_maxspeed"),
        col("osm.highway").alias("osm_highway"),
        col("tomtom.vehicle_type_speed_map").alias(
            "tomtom_commercial_vehicle_speed_map"
        ),
        col("tomtom.maxspeed_unit").alias("tomtom_maxspeed_unit"),
        col("tomtom.country_code").alias("tomtom_country_code"),
        col("tomtom.state_code").alias("tomtom_state_code"),
        col("match.matched_h3_size").alias("matched_h3_size"),
        col("match.osm_interp_h3_size").alias("osm_interp_h3_size"),
        col("match.tomtom_interp_h3_size").alias("tomtom_interp_h3_size"),
        col("match.way_cumulative_coverage_pct").alias("way_cumulative_coverage_pct"),
    )

    map_match_table_name = DBX_TABLE.osm_tomtom_map_match(
        osm_version_id, region, tomtom_version_id
    )
    selected.write.mode("overwrite").option("overwriteSchema", "True").saveAsTable(
        map_match_table_name
    )


# COMMAND ----------


def run_map_match(tomtom_version_id, osm_version_id, region):
    print("map matching ways")
    match_table_name = DBX_TABLE.osm_tomtom_matched_ways(
        osm_version_id, region, tomtom_version_id
    )
    if not DBX_TABLE.is_table_exists(match_table_name):
        tomtom_map_match(tomtom_version_id, osm_version_id, region)

    print("joining map-matched tables")
    map_match_table_name = DBX_TABLE.osm_tomtom_map_match(
        osm_version_id, region, tomtom_version_id
    )
    if not DBX_TABLE.is_table_exists(map_match_table_name):
        join_matched_ways(tomtom_version_id, osm_version_id, region)


# COMMAND ----------

if tomtom_version == "":
    exit_notebook("tomtom_version must be specified")
if osm_regions_to_version == {}:
    exit_notebook("osm_regions_to_version must be specified")

for region in desired_regions:
    if region not in osm_regions_to_version:
        exit_notebook(f"region {region} is not specified in osm_regions_to_version")
    osm_version = osm_regions_to_version[region]
    print(f"map-matching {region}")
    run_map_match(tomtom_version, osm_version, region)


# COMMAND ----------

exit_notebook()


# COMMAND ----------

{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Scheduled notebook schema",
  "type": "object",
  "properties": {
    "owner": {
      "type": "string",
      "description": "Owner team"
    },
    "python_libraries": {
      "type": "array",
      "description": "Libraries to install for this notebook job",
      "items": {
        "type": "string"
      }
    },
    "default_libraries_to_skip": {
      "type": "array",
      "description": "Default libraries to skip for this notebooks' job",
      "items": {
        "type": "string"
      }
    },
    "email_notifications": {
      "type": "array",
      "description": "Emails to notify on job failure",
      "items": {
        "type": "string"
      }
    },
    "jobs": {
      "type": "array",
      "description": "Databricks jobs",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1
          },
          "cron": {
            "type": "string",
            "description": "Cron expression for run schedule. See https://www.freeformatter.com/cron-expression-generator-quartz.html."
          },
          "regions": {
            "type": "array",
            "description": "Deploy to select AWS regions. At least one region must be populated.",
            "items": {
              "type": "string",
              "enum": ["us-west-2", "eu-west-1", "ca-central-1"],
              "minItems": 1
            }
          },
          "driver_node_type_id": {
            "type": "string",
            "description": "The instance type id of the cluster's driver node (e.g., 'i3.4xlarge')"
          },
          "node_type_id": {
            "type": "string",
            "description": "The instance type id of the cluster's worker nodes (e.g., 'i3.4xlarge')"
          },
          "timeout_seconds": {
            "type": "integer",
            "description": "Job timeout in seconds. Default is 1 hour."
          },
          "max_workers": {
            "type": "integer",
            "description": "Max workers allowed for job. Default is 4."
          },
          "spark_version": {
            "type": "string",
            "description": "Databricks Runtime version (e.g. '11.3.x-scala2.12')"
          },
          "unity_catalog_setting": {
            "type": "object",
            "description": "Settings overrides related to Unity Catalog for the job.",
            "properties": {
              "data_security_mode": {
                "type": "string",
                "description": "Specifies the data security mode to use for the job. Valid values: 'SINGLE_USER' (Dedicated, formerly Single user), 'USER_ISOLATION' (Standard, formerly Shared).",
                "enum": ["SINGLE_USER", "USER_ISOLATION"]
              }
            },
            "additionalProperties": false
          },
          "slo_config": {
            "type": "object",
            "description": "SLO settings for the job to power time_since_last_success monitoring.",
            "properties": {
              "low_urgency_threshold_hours": {
                "type": "integer",
                "description": "Low urgency threshold in hours."
              },
              "business_hours_threshold_hours": {
                "type": "integer",
                "description": "Business hours high urgency threshold in hours."
              },
              "high_urgency_threshold_hours": {
                "type": "integer",
                "description": "High urgency threshold in hours."
              }
            },
            "additionalProperties": false
          },
          "loki_settings_enabled": {
            "type": "boolean",
            "description": "Whether to enable Loki cache settings for this job."
          },
          "spark_conf_overrides": {
            "type": "object",
            "description": "Key-value pairs of spark configurations that will override existing defaults.",
            "additionalProperties": {
              "type": "string"
            }
          },
          "parameters": {
            "type": "object",
            "description": "Notebook parameters that you can set. See https://paper.dropbox.com/doc/How-to-Deploying-a-notebook--BJtbomMOGPfN7QfPFbjiPQcFAg-2DTZLXaEwbxIyGtofppJR#:uid=722773390131196863584166&h2=How-to-set-Notebook-parameters",
            "additionalProperties": {
              "type": "string"
            }
          },
          "max_retries": {
            "type": "integer",
            "description": "Max retries. -1 means retry indefinitely. 0 means never retry."
          },
          "min_retry_interval_seconds": {
            "type": "integer",
            "description": "Wait this many seconds between retries. This has no effect if max_retries is not set."
          },
          "init_scripts": {
            "type": "array",
            "description": "Init scripts to install on the cluster. See https://samsara.atlassian-us-gov-mod.net/wiki/spaces/DATA/pages/17756812/Scheduling+a+Databricks+single-task+job+via+the+backend+repo#How-to-specify-init-scripts-to-install-on-the-cluster",
            "items": {
              "type": "string"
            }
          }
        },
        "required": ["name"],
        "additionalProperties": false
      }
    },
    "output": {
      "type": "object",
      "properties": {
        "dbname": {
          "description": "The name of the output table",
          "type": "string"
        },
        "tablename": {
          "description": "The name of the output table",
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["table"]
        },
        "schema": {
          "description": "The output schema",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "type": {
                "type": ["string", "object"],
                "anyOf": [
                  { "pattern": "^decimal\\([0-9]+,[0-9]+\\)$" },
                  {
                    "enum": [
                      "array",
                      "binary",
                      "boolean",
                      "byte",
                      "date",
                      "double",
                      "float",
                      "integer",
                      "long",
                      "map",
                      "short",
                      "string",
                      "struct",
                      "timestamp"
                    ]
                  }
                ]
              },
              "fields": {
                "type": "array"
              },
              "nullable": {
                "type": "boolean"
              }
            },
            "if": {
              "properties": { "type": { "const": "struct" } }
            },
            "then": {
              "required": ["name", "type", "fields"]
            },
            "else": {
              "required": ["name", "type"]
            }
          }
        }
      },
      "required": ["dbname", "tablename", "type", "schema"],
      "additionalProperties": false
    }
  },
  "required": ["owner"],
  "additionalProperties": false
}

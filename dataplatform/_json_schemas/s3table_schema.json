{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "S3 table definition schema",
  "type": "object",
  "column": {
    "type": "object",
    "properties": {
      "name": {
        "type": "string"
      },
      "type": {
        "type": ["string", "object"],
        "anyOf": [
          { "pattern": "^decimal\\([0-9]+,[0-9]+\\)$" },
          {
            "enum": [
              "string",
              "binary",
              "boolean",
              "date",
              "timestamp",
              "double",
              "float",
              "byte",
              "integer",
              "long",
              "bigint",
              "short",
              "array",
              "map",
              "struct"
            ]
          }
        ]
      },
      "fields": {
        "type": "array"
      },
      "nullable": {
        "type": "boolean"
      },
      "description": {
        "type": "string"
      }
    },
    "if": {
      "properties": { "type": { "const": "struct" } }
    },
    "then": {
      "required": ["name", "type", "fields"]
    },
    "else": {
      "required": ["name", "type"]
    }
  },
  "properties": {
    "table": {
      "type": "string",
      "description": "Name of table"
    },
    "owner": {
      "type": "string",
      "description": "Team that is going to own the table"
    },
    "description": {
      "type": "string",
      "description": "Description of table"
    },
    "database": {
      "type": "string",
      "description": "Name of database table will be under"
    },
    "region_to_location": {
      "type": "object",
      "description": "map of region to S3 location of data that table is based on"
    },
    "datatype": {
      "type": "string",
      "description": "File type of data, currently only csv supported",
      "enum": ["csv", "json"]
    },
    "schema": {
      "description": "The output schema",
      "type": "array",
      "items": { "$ref": "#/column" }
    },
    "csv": {
      "type": "object",
      "description": "CSV format specifications",
      "additionalProperties": false,
      "properties": {
        "separator": {
          "type": "string",
          "description": "A separator (one or more characters) for each field and value (default: ,)"
        },
        "quote": {
          "type": "string",
          "description": "A single character used for escaping quoted values where the separator can be part of the value (default: \")"
        },
        "escape": {
          "type": "string",
          "description": "A single character used for escaping quotes inside an already quoted value (default: \\)"
        },
        "header": {
          "type": "boolean",
          "description": "First line contains names of columns (default: false)"
        },
        "multiline": {
          "type": "boolean",
          "description": "Parse multiline records (default: false)"
        }
      }
    },
    "json": {
      "type": "object",
      "description": "JSON format specifications",
      "additionalProperties": false,
      "properties": {
        "inferSchema": {
          "type": "boolean",
          "description": "Infer schema (default: false)"
        }
      }
    },
    "partitions": {
      "type": "array",
      "description": "List of columns to partition on",
      "items": { "$ref": "#/column" }
    }
  },
  "required": ["table", "owner", "description", "database", "datatype", "schema"],
  "additionalProperties": false
}

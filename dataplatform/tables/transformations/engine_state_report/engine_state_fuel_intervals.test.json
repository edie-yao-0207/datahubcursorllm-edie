{
  "test_cases": [
    {
      "label": "When there is an engine state interval that matches exactly with a fuel interval, then produce a row with the engine state and fuel data.",
      "parameters": {
        "start_date": "'2024-03-08'",
        "end_date": "'2024-03-11'"
      },
      "input_data": {
        "engine_state_report.fuel_intervals": [
          {
            "date": "2024-03-08",
            "org_id": 1,
            "object_id": 1,
            "end_ms": 3500,
            "start_ms": 1000,
            "fuel_consumed_ml": 57,
            "original_interval_duration_ms": 2500
          }
        ],
        "engine_state.intervals": [
          {
            "date": "2024-03-08",
            "org_id": 1,
            "object_id": 1,
            "start_ms": 1000,
            "end_ms": 3500,
            "state": "IDLE",
            "original_interval_duration_ms": 2500
          }
        ]
      },
      "expected_data": [
        {
          "date": "2024-03-08",
          "end_ms": 3500,
          "engine_state": "IDLE",
          "fuel_consumed_ml": 57.0,
          "object_id": 1,
          "org_id": 1,
          "original_engine_state_interval_duration_ms": 2500,
          "original_fuel_interval_duration_ms": 2500,
          "start_ms": 1000
        }
      ]
    },
    {
      "label": "When there is an engine state interval that is 50% the duration of a fuel interval but it is the only intemediary interval, then produce a row with the engine state and all the fuel used.",
      "parameters": {
        "start_date": "'2024-03-08'",
        "end_date": "'2024-03-11'"
      },
      "input_data": {
        "engine_state_report.fuel_intervals": [
          {
            "date": "2024-03-08",
            "org_id": 1,
            "object_id": 1,
            "end_ms": 3000,
            "start_ms": 1000,
            "fuel_consumed_ml": 100,
            "original_interval_duration_ms": 2000
          }
        ],
        "engine_state.intervals": [
          {
            "date": "2024-03-08",
            "org_id": 1,
            "object_id": 1,
            "start_ms": 1500,
            "end_ms": 2500,
            "state": "IDLE",
            "original_interval_duration_ms": 1000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2024-03-08",
          "end_ms": 2500,
          "engine_state": "IDLE",
          "fuel_consumed_ml": 100.0,
          "object_id": 1,
          "org_id": 1,
          "original_engine_state_interval_duration_ms": 1000,
          "original_fuel_interval_duration_ms": 2000,
          "start_ms": 1500
        }
      ]
    },
    {
      "label": "When there are two engine state intervals that each occupy 50% the duration of a fuel interval, then produce two row with the engine state and half the fuel used distributed over both.",
      "parameters": {
        "start_date": "'2024-03-08'",
        "end_date": "'2024-03-11'"
      },
      "input_data": {
        "engine_state_report.fuel_intervals": [
          {
            "date": "2024-03-08",
            "org_id": 1,
            "object_id": 1,
            "end_ms": 3000,
            "start_ms": 1000,
            "fuel_consumed_ml": 100,
            "original_interval_duration_ms": 2000
          }
        ],
        "engine_state.intervals": [
          {
            "date": "2024-03-08",
            "org_id": 1,
            "object_id": 1,
            "start_ms": 1000,
            "end_ms": 2000,
            "state": "IDLE",
            "original_interval_duration_ms": 1000
          },
          {
            "date": "2024-03-08",
            "org_id": 1,
            "object_id": 1,
            "start_ms": 2000,
            "end_ms": 3000,
            "state": "IDLE",
            "original_interval_duration_ms": 1000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2024-03-08",
          "end_ms": 2000,
          "engine_state": "IDLE",
          "fuel_consumed_ml": 50.0,
          "object_id": 1,
          "org_id": 1,
          "original_engine_state_interval_duration_ms": 1000,
          "original_fuel_interval_duration_ms": 2000,
          "start_ms": 1000
        },
        {
          "date": "2024-03-08",
          "end_ms": 3000,
          "engine_state": "IDLE",
          "fuel_consumed_ml": 50.0,
          "object_id": 1,
          "org_id": 1,
          "original_engine_state_interval_duration_ms": 1000,
          "original_fuel_interval_duration_ms": 2000,
          "start_ms": 2000
        }
      ]
    },
    {
      "label": "When there are multiple fuel intervals within an engine state interval, then only produce one engine state interval with the summed fuel from all fuel intervals.",
      "parameters": {
        "start_date": "'2024-03-08'",
        "end_date": "'2024-03-11'"
      },
      "input_data": {
        "engine_state_report.fuel_intervals": [
          {
            "date": "2024-03-08",
            "org_id": 1,
            "object_id": 1,
            "end_ms": 2000,
            "start_ms": 1000,
            "fuel_consumed_ml": 50,
            "original_interval_duration_ms": 1000
          },
          {
            "date": "2024-03-08",
            "org_id": 1,
            "object_id": 1,
            "end_ms": 3000,
            "start_ms": 2000,
            "fuel_consumed_ml": 50,
            "original_interval_duration_ms": 1000
          }
        ],
        "engine_state.intervals": [
          {
            "date": "2024-03-08",
            "org_id": 1,
            "object_id": 1,
            "start_ms": 1000,
            "end_ms": 3000,
            "state": "IDLE",
            "original_interval_duration_ms": 2000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2024-03-08",
          "end_ms": 3000,
          "engine_state": "IDLE",
          "fuel_consumed_ml": 100.0,
          "object_id": 1,
          "org_id": 1,
          "original_engine_state_interval_duration_ms": 2000,
          "original_fuel_interval_duration_ms": 1000,
          "start_ms": 1000
        }
      ]
    }
  ]
}

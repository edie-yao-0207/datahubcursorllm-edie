{
  "test_cases": [
    {
      "label": "idling twice within one hour",
      "parameters": {
        "start_date": "'2024-01-01'",
        "end_date": "'2024-01-03'"
      },
      "input_data": {
        "engine_state_report.engine_state_pto_air_temp_fuel_intervals": [
          {
            "date": "2024-01-01",
            "org_id": 1,
            "object_id": 1,
            "engine_state": "IDLE",
            "start_ms": 1704067200000,
            "end_ms": 1704069000000,
            "fuel_consumed_ml": 1000,
            "gaseous_fuel_consumed_grams": 1000,
            "original_engine_state_interval_duration_ms": 1800000
          },
          {
            "date": "2024-01-01",
            "org_id": 1,
            "object_id": 1,
            "engine_state": "IDLE",
            "start_ms": 1704069900000,
            "end_ms": 1704070080000,
            "fuel_consumed_ml": 100,
            "gaseous_fuel_consumed_grams": 100,
            "original_engine_state_interval_duration_ms": 180000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2024-01-01",
          "org_id": 1,
          "device_id": 1,
          "start_ms": 1704067200000,
          "duration_ms": 1980000,
          "fuel_consumption_ml": 1100,
          "gaseous_fuel_consumed_grams": 1100,
          "original_engine_state_interval_duration_ms": 1980000
        }
      ]
    },
    {
      "label": "idling within one hour",
      "parameters": {
        "start_date": "'2024-01-01'",
        "end_date": "'2024-01-03'"
      },
      "input_data": {
        "engine_state_report.engine_state_pto_air_temp_fuel_intervals": [
          {
            "date": "2024-01-01",
            "org_id": 1,
            "object_id": 1,
            "engine_state": "IDLE",
            "start_ms": 1704067200000,
            "end_ms": 1704069000000,
            "fuel_consumed_ml": 1000,
            "gaseous_fuel_consumed_grams": 1000,
            "original_engine_state_interval_duration_ms": 1800000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2024-01-01",
          "org_id": 1,
          "device_id": 1,
          "start_ms": 1704067200000,
          "duration_ms": 1800000,
          "fuel_consumption_ml": 1000,
          "gaseous_fuel_consumed_grams": 1000,
          "original_engine_state_interval_duration_ms": 1800000
        }
      ]
    },
    {
      "label": "idling over two hours",
      "parameters": {
        "start_date": "'2024-01-01'",
        "end_date": "'2024-01-03'"
      },
      "input_data": {
        "engine_state_report.engine_state_pto_air_temp_fuel_intervals": [
          {
            "date": "2024-01-01",
            "org_id": 1,
            "object_id": 1,
            "engine_state": "IDLE",
            "start_ms": 1704067200000,
            "end_ms": 1704072600000,
            "fuel_consumed_ml": 3000,
            "gaseous_fuel_consumed_grams": 3000,
            "original_engine_state_interval_duration_ms": 5400000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2024-01-01",
          "org_id": 1,
          "device_id": 1,
          "start_ms": 1704067200000,
          "duration_ms": 3600000,
          "fuel_consumption_ml": 2000,
          "gaseous_fuel_consumed_grams": 2000,
          "original_engine_state_interval_duration_ms": 3600000
        },
        {
          "date": "2024-01-01",
          "org_id": 1,
          "device_id": 1,
          "start_ms": 1704070800000,
          "duration_ms": 1800000,
          "fuel_consumption_ml": 1000,
          "gaseous_fuel_consumed_grams": 1000,
          "original_engine_state_interval_duration_ms": 1800000
        }
      ]
    },
    {
      "label": "idling over two days",
      "parameters": {
        "start_date": "'2024-01-01'",
        "end_date": "'2024-01-03'"
      },
      "input_data": {
        "engine_state_report.engine_state_pto_air_temp_fuel_intervals": [
          {
            "date": "2024-01-01",
            "org_id": 1,
            "object_id": 1,
            "engine_state": "IDLE",
            "start_ms": 1704150000000,
            "end_ms": 1704322800000,
            "fuel_consumed_ml": 3000,
            "gaseous_fuel_consumed_grams": 1000,
            "original_engine_state_interval_duration_ms": 172800000
          }
        ]
      },
      "expected_data": []
    },
    {
      "label": "idling ending on the hour",
      "parameters": {
        "start_date": "'2024-01-01'",
        "end_date": "'2024-01-03'"
      },
      "input_data": {
        "engine_state_report.engine_state_pto_air_temp_fuel_intervals": [
          {
            "date": "2024-01-01",
            "org_id": 1,
            "object_id": 1,
            "engine_state": "IDLE",
            "start_ms": 1704067200000,
            "end_ms": 1704070800000,
            "fuel_consumed_ml": 2000,
            "gaseous_fuel_consumed_grams": 2000,
            "original_engine_state_interval_duration_ms": 3600000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2024-01-01",
          "org_id": 1,
          "device_id": 1,
          "start_ms": 1704067200000,
          "duration_ms": 3600000,
          "fuel_consumption_ml": 2000,
          "gaseous_fuel_consumed_grams": 2000,
          "original_engine_state_interval_duration_ms": 3600000
        }
      ]
    },
    {
      "label": "non-idling",
      "parameters": {
        "start_date": "'2024-01-01'",
        "end_date": "'2024-01-03'"
      },
      "input_data": {
        "engine_state_report.engine_state_pto_air_temp_fuel_intervals": [
          {
            "date": "2024-01-01",
            "org_id": 1,
            "object_id": 1,
            "engine_state": "ON",
            "start_ms": 1704067200000,
            "end_ms": 1704070800000,
            "fuel_consumed_ml": 2000,
            "gaseous_fuel_consumed_grams": 2000,
            "original_engine_state_interval_duration_ms": 3600000
          }
        ]
      },
      "expected_data": []
    },
    {
      "label": "two devices",
      "parameters": {
        "start_date": "'2024-01-01'",
        "end_date": "'2024-01-03'"
      },
      "input_data": {
        "engine_state_report.engine_state_pto_air_temp_fuel_intervals": [
          {
            "date": "2024-01-01",
            "org_id": 1,
            "object_id": 1,
            "engine_state": "IDLE",
            "start_ms": 1704067200000,
            "end_ms": 1704069000000,
            "fuel_consumed_ml": 1000,
            "gaseous_fuel_consumed_grams": 1000,
            "original_engine_state_interval_duration_ms": 1800000
          },
          {
            "date": "2024-01-01",
            "org_id": 2,
            "object_id": 2,
            "engine_state": "IDLE",
            "start_ms": 1704067200000,
            "end_ms": 1704069000000,
            "fuel_consumed_ml": 1000,
            "gaseous_fuel_consumed_grams": 1000,
            "original_engine_state_interval_duration_ms": 1800000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2024-01-01",
          "org_id": 1,
          "device_id": 1,
          "start_ms": 1704067200000,
          "duration_ms": 1800000,
          "fuel_consumption_ml": 1000,
          "gaseous_fuel_consumed_grams": 1000
        },
        {
          "date": "2024-01-01",
          "org_id": 2,
          "device_id": 2,
          "start_ms": 1704067200000,
          "duration_ms": 1800000,
          "fuel_consumption_ml": 1000,
          "gaseous_fuel_consumed_grams": 1000
        }
      ]
    },
    {
      "label": "null column",
      "parameters": {
        "start_date": "'2024-01-01'",
        "end_date": "'2024-01-03'"
      },
      "input_data": {
        "engine_state_report.engine_state_pto_air_temp_fuel_intervals": [
          {
            "date": "2024-01-01",
            "org_id": 1,
            "object_id": 1,
            "engine_state": "IDLE",
            "start_ms": 1704067200000,
            "fuel_consumed_ml": 1000,
            "gaseous_fuel_consumed_grams": 1000
          }
        ]
      },
      "expected_data": []
    },
    {
      "label": "When idling is derived from an engine state interval that is >24 hours long, then this event should not count towards the aggregate.",
      "parameters": {
        "start_date": "'2024-01-01'",
        "end_date": "'2024-01-03'"
      },
      "input_data": {
        "engine_state_report.engine_state_fuel_intervals": [
          {
            "date": "2024-01-01",
            "org_id": 1,
            "object_id": 1,
            "engine_state": "IDLE",
            "start_ms": 1704067200000,
            "end_ms": 1704163600000,
            "fuel_consumed_ml": 1000,
            "gaseous_fuel_consumed_grams": 1000,
            "original_engine_state_interval_duration_ms": 96400000
          }
        ]
      },
      "expected_data": []
    }
  ]
}

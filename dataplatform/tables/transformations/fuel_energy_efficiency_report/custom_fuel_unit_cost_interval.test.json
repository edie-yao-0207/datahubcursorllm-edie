{
  "test_cases": [
    {
      "label": "no custom fuel cost should not generate any intervals",
      "parameters": {
        "start_date": "'2022-07-16'",
        "end_date": "'2022-07-17'"
      },
      "input_data": {
        "fueldb_shards.custom_fuel_costs": []
      },
      "expected_data": []
    },
    {
      "label": "custom fuel cost defined immediately before the time range should create hourly intervals for the entire time range",
      "parameters": {
        "start_date": "'2022-07-16'",
        "end_date": "'2022-07-17'"
      },
      "input_data": {
        "fueldb_shards.custom_fuel_costs": [
          {
            "fuel_cost": 1,
            "org_id": 1,
            "updated_at": 1657928950105,
            "updated_by": 1
          }
        ]
      },
      "expected_data": [
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 00:00:00",
          "interval_end": "2022-07-16 01:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 01:00:00",
          "interval_end": "2022-07-16 02:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 02:00:00",
          "interval_end": "2022-07-16 03:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 03:00:00",
          "interval_end": "2022-07-16 04:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 04:00:00",
          "interval_end": "2022-07-16 05:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 05:00:00",
          "interval_end": "2022-07-16 06:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 06:00:00",
          "interval_end": "2022-07-16 07:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 07:00:00",
          "interval_end": "2022-07-16 08:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 08:00:00",
          "interval_end": "2022-07-16 09:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 09:00:00",
          "interval_end": "2022-07-16 10:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 10:00:00",
          "interval_end": "2022-07-16 11:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 11:00:00",
          "interval_end": "2022-07-16 12:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 12:00:00",
          "interval_end": "2022-07-16 13:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 13:00:00",
          "interval_end": "2022-07-16 14:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 14:00:00",
          "interval_end": "2022-07-16 15:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 15:00:00",
          "interval_end": "2022-07-16 16:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 16:00:00",
          "interval_end": "2022-07-16 17:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 17:00:00",
          "interval_end": "2022-07-16 18:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 18:00:00",
          "interval_end": "2022-07-16 19:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 19:00:00",
          "interval_end": "2022-07-16 20:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 20:00:00",
          "interval_end": "2022-07-16 21:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 21:00:00",
          "interval_end": "2022-07-16 22:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 22:00:00",
          "interval_end": "2022-07-16 23:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 23:00:00",
          "interval_end": "2022-07-17 00:00:00",
          "custom_fuel_cost": 1
        }
      ]
    },
    {
      "label": "only use the most recent fuel cost prior to the time range to calculate intervals",
      "parameters": {
        "start_date": "'2022-07-16'",
        "end_date": "'2022-07-17'"
      },
      "input_data": {
        "fueldb_shards.custom_fuel_costs": [
          {
            "fuel_cost": 2,
            "org_id": 1,
            "updated_at": 1656658800000,
            "updated_by": 1
          },
          {
            "fuel_cost": 1,
            "org_id": 1,
            "updated_at": 1657928950105,
            "updated_by": 1
          }
        ]
      },
      "expected_data": [
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 00:00:00",
          "interval_end": "2022-07-16 01:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 01:00:00",
          "interval_end": "2022-07-16 02:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 02:00:00",
          "interval_end": "2022-07-16 03:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 03:00:00",
          "interval_end": "2022-07-16 04:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 04:00:00",
          "interval_end": "2022-07-16 05:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 05:00:00",
          "interval_end": "2022-07-16 06:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 06:00:00",
          "interval_end": "2022-07-16 07:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 07:00:00",
          "interval_end": "2022-07-16 08:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 08:00:00",
          "interval_end": "2022-07-16 09:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 09:00:00",
          "interval_end": "2022-07-16 10:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 10:00:00",
          "interval_end": "2022-07-16 11:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 11:00:00",
          "interval_end": "2022-07-16 12:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 12:00:00",
          "interval_end": "2022-07-16 13:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 13:00:00",
          "interval_end": "2022-07-16 14:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 14:00:00",
          "interval_end": "2022-07-16 15:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 15:00:00",
          "interval_end": "2022-07-16 16:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 16:00:00",
          "interval_end": "2022-07-16 17:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 17:00:00",
          "interval_end": "2022-07-16 18:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 18:00:00",
          "interval_end": "2022-07-16 19:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 19:00:00",
          "interval_end": "2022-07-16 20:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 20:00:00",
          "interval_end": "2022-07-16 21:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 21:00:00",
          "interval_end": "2022-07-16 22:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 22:00:00",
          "interval_end": "2022-07-16 23:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 23:00:00",
          "interval_end": "2022-07-17 00:00:00",
          "custom_fuel_cost": 1
        }
      ]
    },
    {
      "label": "use the most recent fuel cost avaiable at each hourly interval, and average the fuel costs if there are two custom fuel costs in one hourly interval",
      "parameters": {
        "start_date": "'2022-07-16'",
        "end_date": "'2022-07-17'"
      },
      "input_data": {
        "fueldb_shards.custom_fuel_costs": [
          {
            "fuel_cost": 1,
            "org_id": 1,
            "updated_at": 1657963800000,
            "updated_by": 1
          },
          {
            "fuel_cost": 2,
            "org_id": 1,
            "updated_at": 1657985400000,
            "updated_by": 1
          }
        ]
      },
      "expected_data": [
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 09:00:00",
          "interval_end": "2022-07-16 10:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 10:00:00",
          "interval_end": "2022-07-16 11:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 11:00:00",
          "interval_end": "2022-07-16 12:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 12:00:00",
          "interval_end": "2022-07-16 13:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 13:00:00",
          "interval_end": "2022-07-16 14:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 14:00:00",
          "interval_end": "2022-07-16 15:00:00",
          "custom_fuel_cost": 1
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 15:00:00",
          "interval_end": "2022-07-16 16:00:00",
          "custom_fuel_cost": 1.5
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 16:00:00",
          "interval_end": "2022-07-16 17:00:00",
          "custom_fuel_cost": 2
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 17:00:00",
          "interval_end": "2022-07-16 18:00:00",
          "custom_fuel_cost": 2
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 18:00:00",
          "interval_end": "2022-07-16 19:00:00",
          "custom_fuel_cost": 2
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 19:00:00",
          "interval_end": "2022-07-16 20:00:00",
          "custom_fuel_cost": 2
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 20:00:00",
          "interval_end": "2022-07-16 21:00:00",
          "custom_fuel_cost": 2
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 21:00:00",
          "interval_end": "2022-07-16 22:00:00",
          "custom_fuel_cost": 2
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 22:00:00",
          "interval_end": "2022-07-16 23:00:00",
          "custom_fuel_cost": 2
        },
        {
          "org_id": 1,
          "date": "2022-07-16",
          "interval_start": "2022-07-16 23:00:00",
          "interval_end": "2022-07-17 00:00:00",
          "custom_fuel_cost": 2
        }
      ]
    }
  ]
}

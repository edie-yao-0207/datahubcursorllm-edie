{
  "name": "fuel_energy_efficiency_report.aggregated_vehicle_driver_rows_v4",
  "owner": "Sustainability",
  "description": "Fuel and energy data by hour aggregated into either device or driver rows. This node combines historical data computed by the V3 piepline with new data computed by the V4 combined node from around the start of 2024, the new columns are filled in for the V3 data using a snapshot of canonical fuel types for the historical data. Distance traveled and fuel/energy used is filtered out for the hour if the mpge is too high. The original values are preserved in columns suffixed with _original. Efficiency values are considered too high if a fuel vehicle has > 65 mpg or a hybrid/electric vehicle has > 200 mpge. This is for FEER v4, which updates where fuel costs are taken from and moves emissions computation into the pipeline.",
  "tags": ["telematics", "fuel", "ev"],
  "dependencies": [
    {
      "dbname": "fuel_energy_efficiency_report",
      "tablename": "combined_new_rows_v4",
      "type": "table"
    },
    {
      "dbname": "fuel_maintenance",
      "tablename": "historical_fuel_energy_report_delta_v3",
      "type": "table",
      "external": true,
      "schema_path": "fuel/convert_historical_feer_data_v3.metadata.json"
    },
    {
      "dbname": "fueldb_shards",
      "tablename": "fuel_types",
      "type": "table",
      "external": true
    }
  ],
  "expectation": {
    "batch_mode": "KEEP_ALL"
  },
  "sqlite_report_config": {
    "report_name": "fuel_energy_efficiency_report_v4",
    "staleness_monitors": [
      {
        "hours": 13,
        "urgency": "LOW"
      },
      {
        "hours": 19,
        "urgency": "HIGH"
      }
    ],
    "team_runbook_url": "https://samsaradev.atlassian.net/wiki/x/XaMZmQ"
  },
  "parameters": ["start_date", "end_date"],
  "backfill_start_date": "2024-07-10",
  "output": {
    "dbname": "fuel_energy_efficiency_report",
    "tablename": "aggregated_vehicle_driver_rows_v4",
    "type": "table",
    "partition": ["date"],
    "primary_key": ["date", "org_id", "object_id", "object_type", "interval_start"],
    "schema": [
      {
        "name": "date",
        "type": "date",
        "metadata": {
          "comment": "The date of this hour of aggregated data."
        }
      },
      {
        "name": "org_id",
        "type": "long",
        "metadata": {
          "comment": "$org_id_default_description"
        }
      },
      {
        "name": "object_id",
        "type": "long",
        "metadata": {
          "comment": "The driver or vehicle id of this hour of aggregated data."
        }
      },
      {
        "name": "object_type",
        "type": "integer",
        "metadata": {
          "comment": "The type of object this data is aggregated for (1 if vehicle, 5 if driver)."
        }
      },
      {
        "name": "interval_start",
        "type": "timestamp",
        "metadata": {
          "comment": "The starting timestamp of this hourly interval."
        }
      },
      {
        "name": "engine_type",
        "type": "integer",
        "metadata": {
          "comment": "The engine type (ICE, Hybrid, PHEV, BEV) of the vehicle for this hourly interval."
        }
      },
      {
        "name": "configurable_fuel_id",
        "type": "integer",
        "nullable": true,
        "metadata": {
          "comment": "The configurable fuel type (Gasoline, Diesel, Biodiesel, Ethanol or Electricity) of the vehicle for this hourly interval."
        }
      },
      {
        "name": "fuel_consumed_ml",
        "type": "long",
        "metadata": {
          "comment": "The amount of fuel consumed in milliliters for this hour of aggregated data after filtering out impossibly high fuel efficiency."
        }
      },
      {
        "name": "fuel_consumed_ml_original",
        "type": "long",
        "metadata": {
          "comment": "The amount of fuel consumed in milliliters for this hour of aggregated data before filtering out impossibly high fuel efficiency."
        }
      },
      {
        "name": "fuel_consumed_ml_as_gaseous_type",
        "type": "long",
        "nullable": true,
        "metadata": {
          "comment": "The amount of fuel consumed in milliliters for this hour of aggregated data where the vehicle was of gaseous fuel type after filtering out impossibly high fuel efficiency."
        }
      },
      {
        "name": "fuel_consumed_ml_as_gaseous_type_original",
        "type": "long",
        "nullable": true,
        "metadata": {
          "comment": "The amount of fuel consumed in milliliters for this hour of aggregated data where the vehicle was of gaseous fuel type before filtering out impossibly high fuel efficiency."
        }
      },
      {
        "name": "energy_consumed_kwh",
        "type": "decimal(38,9)",
        "metadata": {
          "comment": "The amount of energy consumed in kilowatt-hours for this hour of aggregated data after filtering out impossible high energy efficiency."
        }
      },
      {
        "name": "energy_consumed_kwh_original",
        "type": "decimal(38,9)",
        "metadata": {
          "comment": "The amount of energy consumed in kilowatt-hours for this hour of aggregated data before filtering out impossible high energy efficiency."
        }
      },
      {
        "name": "gaseous_fuel_consumed_grams",
        "type": "long",
        "metadata": {
          "comment": "The amount of gaseous fuel consumed in grams for this hour of aggregated data after filtering out impossible high fuel efficiency."
        }
      },
      {
        "name": "gaseous_fuel_consumed_grams_original",
        "type": "long",
        "metadata": {
          "comment": "The amount of gaseous fuel consumed in grams for this hour of aggregated data before filtering out impossible high fuel efficiency."
        }
      },
      {
        "name": "distance_traveled_m",
        "type": "double",
        "metadata": {
          "comment": "The distance traveled in meters for this hour of aggregated data after filtering out impossibly high fuel/energy efficiency."
        }
      },
      {
        "name": "distance_traveled_m_original",
        "type": "double",
        "metadata": {
          "comment": "The distance traveled in meters for this hour of aggregated data before filtering out impossibly high fuel/energy efficiency."
        }
      },
      {
        "name": "distance_traveled_m_gps",
        "type": "double",
        "metadata": {
          "comment": "The GPS distance traveled in meters for this hour of aggregated data after filtering out impossibly high fuel/energy efficiency. This is only reported for historical values from the old monolithic report."
        }
      },
      {
        "name": "distance_traveled_m_gps_original",
        "type": "double",
        "metadata": {
          "comment": "The GPS distance traveled in meters for this hour of aggregated data before filtering out impossibly high fuel/energy efficiency. This is only reported for historical values from the old monolithic report."
        }
      },
      {
        "name": "distance_traveled_m_odo",
        "type": "long",
        "metadata": {
          "comment": "The odometer distance traveled in meters for this hour of aggregated data after filtering out impossibly high fuel/energy efficiency. This is only reported for historical values from the old monolithic report."
        }
      },
      {
        "name": "distance_traveled_m_odo_original",
        "type": "long",
        "metadata": {
          "comment": "The odometer distance traveled in meters for this hour of aggregated data before filtering out impossibly high fuel/energy efficiency. This is only reported for historical values from the old monolithic report."
        }
      },
      {
        "name": "fuel_cost",
        "type": "double",
        "nullable": false,
        "metadata": {
          "comment": "The cost in US dollars of the fuel consumed in this hour of aggregated data. This cost is derived from an org's custom entered fuel costs in the custom_fuel_cost_emissions table and defaults to constant cost per kilowatt-hour from helpers.unit_conversion when there are no custom overrides. This is the value after filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "fuel_ml_cost_as_gaseous_type",
        "type": "double",
        "nullable": true,
        "metadata": {
          "comment": "The cost in US dollars of the fuel consumed ml in this hour of aggregated data where the vehicle was of gaseous fuel type. This cost is derived from an org's custom entered fuel costs in the custom_fuel_cost_emissions table and defaults to the gasoline factor if there is no more specific override. This is the value after filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "energy_cost",
        "type": "double",
        "nullable": false,
        "metadata": {
          "comment": "The cost in US dollars of the energy consumed in this hour of aggregated data. This cost is derived from an org's custom entered fuel costs in the custom_fuel_cost_emissions table and defaults to dynamically fetched values in locale_fuel_costs when there are no custom overrides. This is the value after filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "gaseous_fuel_cost",
        "type": "double",
        "nullable": true,
        "metadata": {
          "comment": "The cost in US dollars of the gaseous fuel consumed in this hour of aggregated data. This cost is derived from an org's custom entered fuel costs in the custom_fuel_cost_emissions table and defaults to dynamically fetched values in locale_fuel_costs when there are no custom overrides. This is the value after filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "fuel_emissions",
        "type": "double",
        "nullable": true,
        "metadata": {
          "comment": "The emissions in grams of CO2 due to the amount of fuel consumed in this hour of aggregated data. This cost is derived from an org's custom entered fuel/energy emissions factors in the custom_fuel_cost_emissions table and the default emissions factors defined globally. This is the value after filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "fuel_ml_emissions_as_gaseous_type",
        "type": "double",
        "nullable": true,
        "metadata": {
          "comment": "The emissions in grams of CO2 due to the amount of fuel consumed in this hour of aggregated data where the vehicle was of gaseous fuel type. This cost is derived from an org's custom entered fuel/energy emissions factors in the custom_fuel_cost_emissions table and the default emissions factors defined globally. This is the value after filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "energy_emissions",
        "type": "double",
        "nullable": false,
        "metadata": {
          "comment": "The emissions in grams of CO2 due to the amount energy consumed in this hour of aggregated data. This cost is derived from an org's custom entered fuel/energy emissions factors in the custom_fuel_cost_emissions table, defaulting to 0 if no custom override is set. This is the value after filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "gaseous_fuel_emissions",
        "type": "double",
        "nullable": true,
        "metadata": {
          "comment": "The emissions in grams of CO2 due to the amount gaseous fuel consumed in this hour of aggregated data. This cost is derived from an org's custom entered fuel/energy emissions factors in the custom_fuel_cost_emissions table, defaulting to 0 if no custom override is set. This is the value after filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "fuel_cost_original",
        "type": "double",
        "nullable": false,
        "metadata": {
          "comment": "The cost in US dollars of the fuel consumed in this hour of aggregated data. This cost is derived from an org's custom entered fuel costs in the custom_fuel_cost_emissions table and defaults to constant cost per kilowatt-hour from helpers.unit_conversion when there are no custom overrides. This is the value before filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "fuel_ml_cost_as_gaseous_type_original",
        "type": "double",
        "nullable": true,
        "metadata": {
          "comment": "The cost in US dollars of the fuel consumed ml in this hour of aggregated data where the vehicle was of gaseous fuel type. This cost is derived from an org's custom entered fuel costs in the custom_fuel_cost_emissions table and defaults to the gasoline factor if there is no more specific override. This is the value before filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "energy_cost_original",
        "type": "double",
        "nullable": false,
        "metadata": {
          "comment": "The cost in US dollars of the energy consumed in this hour of aggregated data. This cost is derived from an org's custom entered fuel costs in the custom_fuel_cost_emissions table and defaults to dynamically fetched values in locale_fuel_costs when there are no custom overrides. This is the value before filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "gaseous_fuel_cost_original",
        "type": "double",
        "nullable": true,
        "metadata": {
          "comment": "The cost in US dollars of the gaseous fuel consumed in this hour of aggregated data. This cost is derived from an org's custom entered fuel costs in the custom_fuel_cost_emissions table and defaults to dynamically fetched values in locale_fuel_costs when there are no custom overrides. This is the value before filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "fuel_emissions_original",
        "type": "double",
        "nullable": true,
        "metadata": {
          "comment": "The emissions in grams of CO2 due to the amount of fuel consumed in this hour of aggregated data. This cost is derived from an org's custom entered fuel/energy emissions factors in the custom_fuel_cost_emissions table and the default emissions factors defined globally. This is the value before filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "fuel_ml_emissions_as_gaseous_type_original",
        "type": "double",
        "nullable": true,
        "metadata": {
          "comment": "The emissions in grams of CO2 due to the amount of fuel consumed in this hour of aggregated data where the vehicle was of gaseous fuel type. This cost is derived from an org's custom entered fuel/energy emissions factors in the custom_fuel_cost_emissions table and the default emissions factors defined globally. This is the value before filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "energy_emissions_original",
        "type": "double",
        "nullable": false,
        "metadata": {
          "comment": "The emissions in grams of CO2 due to the amount energy consumed in this hour of aggregated data. This cost is derived from an org's custom entered fuel/energy emissions factors in the custom_fuel_cost_emissions table, defaulting to 0 if no custom override is set. This is the value before filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "gaseous_fuel_emissions_original",
        "type": "double",
        "nullable": true,
        "metadata": {
          "comment": "The emissions in grams of CO2 due to the amount gaseous fuel consumed in this hour of aggregated data. This cost is derived from an org's custom entered fuel/energy emissions factors in the custom_fuel_cost_emissions table, defaulting to 0 if no custom override is set. This is the value before filtering out due to impossibly high fuel efficiency."
        }
      },
      {
        "name": "on_duration_ms",
        "type": "long",
        "metadata": {
          "comment": "The duration in milliseconds that the engine was on during this hour."
        }
      },
      {
        "name": "idle_duration_ms",
        "type": "long",
        "metadata": {
          "comment": "The duration in milliseconds that the engine was idle during this hour."
        }
      },
      {
        "name": "aux_during_idle_ms",
        "type": "long",
        "metadata": {
          "comment": "The duration in milliseconds that auxillary power was being used during idle time in this hour. This is often referred to as productive idle time or PTO (power take-off)."
        }
      },
      {
        "name": "electric_distance_traveled_m",
        "type": "double",
        "metadata": {
          "comment": "The distance in meters that was traveled via electricity in this hour after filtering out impossibley high energy efficiency."
        }
      },
      {
        "name": "electric_distance_traveled_m_original",
        "type": "double",
        "metadata": {
          "comment": "The distance in meters that was traveled via electricity in this hour before filtering out impossibly high energy efficiency."
        }
      },
      {
        "name": "energy_regen_kwh",
        "type": "decimal(38,9)",
        "metadata": {
          "comment": "The amount of energy regenerated in kilowatt-hours during this hour after filtering out impossibly high energy efficiency. This usually happens via regenerative braking."
        }
      },
      {
        "name": "energy_regen_kwh_original",
        "type": "decimal(38,9)",
        "metadata": {
          "comment": "The amount of energy regenerated in kilowatt-hours during this hour before filtering out impossibly high energy efficiency. This usually happens via regenerative braking."
        }
      }
    ],
    "write_mode": "overwrite"
  }
}

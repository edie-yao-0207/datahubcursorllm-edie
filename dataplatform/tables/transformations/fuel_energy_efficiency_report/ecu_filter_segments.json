{
  "name": "fuel_energy_efficiency_report.ecu_filter_segments",
  "owner": "Sustainability",
  "description": "Table contains 'spotty ECU' segments that can be used to filter out fuel and distance data. This should mitigate cases where distance is reported without fuel, thus increasing vehicle MPGs. Spotty ECU segments are defined as 10 minute ranges (beginning on the hour) where > 75% of the location points report a GPS speed of > 15mph but have no ECU Speed. We also require that ECU Speed be reported at some point during the day containing a spotty ECU segment.",
  "tags": ["telematics", "fuel", "ev"],
  "dependencies": [
    {
      "dbname": "kinesisstats",
      "tablename": "location",
      "type": "table",
      "external": true
    }
  ],
  "expectation": {
    "batch_mode": "FAIL_ALL"
  },
  "parameters": ["start_date", "end_date"],
  "backfill_start_date": "2024-08-01",
  "output": {
    "dbname": "fuel_energy_efficiency_report",
    "tablename": "ecu_filter_segments",
    "type": "table",
    "partition": ["date"],
    "write_mode": "overwrite",
    "primary_key": ["date", "org_id", "device_id", "segment_start"],
    "schema": [
      {
        "name": "date",
        "type": "date",
        "metadata": {
          "comment": "The date this segment occurred on."
        }
      },
      {
        "name": "org_id",
        "type": "long",
        "metadata": {
          "comment": "$org_id_default_description"
        }
      },
      {
        "name": "device_id",
        "type": "long",
        "metadata": {
          "comment": "The device this segment relates to."
        }
      },
      {
        "name": "segment_start",
        "type": "long",
        "metadata": {
          "comment": "The start time in milliseconds of this 10 minute segment."
        }
      },
      {
        "name": "segment_end",
        "type": "long",
        "metadata": {
          "comment": "The end time in milliseconds of this 10 minute segment."
        }
      },
      {
        "name": "pct_bad_ecu",
        "type": "double",
        "metadata": {
          "comment": "The percent of location points that are considered 'spotty ECU' in this segment."
        }
      }
    ]
  }
}

{
  "test_cases": [
    {
      "label": "for CM3's, takes the intersection between attached and powered intervals",
      "parameters": {
        "start_date": " '2020-12-29' ",
        "end_date": " '2020-12-31' "
      },
      "input_data": {
        "cm_health_report.cm_power_intervals": [
          {
            "org_id": 10,
            "device_id": 100,
            "linked_cm_id": 200,
            "start_ms": 150,
            "end_ms": 250,
            "has_power": true,
            "date": "2020-12-29"
          },
          {
            "org_id": 10,
            "device_id": 100,
            "linked_cm_id": 200,
            "start_ms": 250,
            "end_ms": 300,
            "has_power": false,
            "date": "2020-12-29"
          }
        ],
        "cm_health_report.cm_attached_intervals": [
          {
            "org_id": 10,
            "device_id": 100,
            "linked_cm_id": 200,
            "start_ms": 75,
            "end_ms": 200,
            "attached_to_cm": true,
            "date": "2020-12-29"
          },
          {
            "org_id": 10,
            "device_id": 100,
            "linked_cm_id": 200,
            "start_ms": 200,
            "end_ms": 400,
            "attached_to_cm": false,
            "date": "2020-12-29"
          }
        ]
      },
      "expected_data": [
        {
          "org_id": 10,
          "device_id": 100,
          "linked_cm_id": 200,
          "start_ms": 250,
          "end_ms": 300,
          "date": "2020-12-29"
        }
      ]
    },
    {
      "label": "for CM3's, takes the intersection between attached and powered intervals - exclude intersection at interval endpoints to avoid producing 0 duration intervals",
      "parameters": {
        "start_date": " '2020-12-29' ",
        "end_date": " '2020-12-31' "
      },
      "input_data": {
        "cm_health_report.cm_power_intervals": [
          {
            "org_id": 10,
            "device_id": 100,
            "linked_cm_id": 200,
            "start_ms": 150,
            "end_ms": 250,
            "has_power": false,
            "date": "2020-12-29"
          },
          {
            "org_id": 10,
            "device_id": 100,
            "linked_cm_id": 200,
            "start_ms": 250,
            "end_ms": 450,
            "has_power": true,
            "date": "2020-12-29"
          },
          {
            "org_id": 10,
            "device_id": 100,
            "linked_cm_id": 200,
            "start_ms": 450,
            "end_ms": 550,
            "has_power": false,
            "date": "2020-12-29"
          }
        ],
        "cm_health_report.cm_attached_intervals": [
          {
            "org_id": 10,
            "device_id": 100,
            "linked_cm_id": 200,
            "start_ms": 250,
            "end_ms": 300,
            "attached_to_cm": false,
            "date": "2020-12-29"
          },
          {
            "org_id": 10,
            "device_id": 100,
            "linked_cm_id": 200,
            "start_ms": 300,
            "end_ms": 400,
            "attached_to_cm": true,
            "date": "2020-12-29"
          },
          {
            "org_id": 10,
            "device_id": 100,
            "linked_cm_id": 200,
            "start_ms": 400,
            "end_ms": 450,
            "attached_to_cm": false,
            "date": "2020-12-29"
          }
        ]
      },
      "expected_data": []
    },
    {
      "label": "for CM2's, only considers attached intervals",
      "parameters": {
        "start_date": " '2020-12-29' ",
        "end_date": " '2020-12-31' "
      },
      "input_data": {
        "cm_health_report.cm_power_intervals": [],
        "cm_health_report.cm_attached_intervals": [
          {
            "org_id": 10,
            "device_id": 100,
            "linked_cm_id": null,
            "start_ms": 75,
            "end_ms": 200,
            "attached_to_cm": true,
            "date": "2020-12-29"
          },
          {
            "org_id": 10,
            "device_id": 100,
            "linked_cm_id": null,
            "start_ms": 200,
            "end_ms": 400,
            "attached_to_cm": false,
            "date": "2020-12-29"
          }
        ]
      },
      "expected_data": [
        {
          "org_id": 10,
          "device_id": 100,
          "linked_cm_id": null,
          "start_ms": 200,
          "end_ms": 400,
          "date": "2020-12-29"
        }
      ]
    }
  ]
}

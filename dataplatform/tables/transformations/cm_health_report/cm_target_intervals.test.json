{
  "test_cases": [
    {
      "label": "recording_expected when cm connected before intervals.",
      "parameters": {
        "start_date": " '1970-01-01' ",
        "end_date": " '1970-01-03' ",
        "pipeline_execution_time": " '1970-01-10 12:00:00' "
      },
      "input_data": {
        "cm_health_report.cm_2x_3x_linked_vgs": [
          {
            "org_id": 10,
            "vg_device_id": 100,
            "product_id": 24,
            "linked_cm_id": 101,
            "cm_product_id": 44,
            "upper_camera_serial": "CXXX-XXX-XXX",
            "camera_first_connected_at_ms": 0
          }
        ],
        "kinesisstats.osddashcamtargetstate": [
          {
            "org_id": 10,
            "object_id": 101,
            "time": 20,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": [],
                  "camera_target_state": 1
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          },
          {
            "org_id": 10,
            "object_id": 101,
            "time": 150,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": [6],
                  "camera_target_state": 2
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          },
          {
            "org_id": 10,
            "object_id": 101,
            "time": 200,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": [],
                  "camera_target_state": 1
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          }
        ]
      },
      "expected_data": [
        {
          "org_id": 10,
          "vg_device_id": 100,
          "vg_product_id": 24,
          "cm_device_id": 101,
          "cm_product_id": 44,
          "start_ms": 20,
          "end_ms": 150,
          "duration_ms": 130,
          "date": "1970-01-01",
          "recording_expected": false,
          "recording_reason": []
        },
        {
          "org_id": 10,
          "vg_device_id": 100,
          "vg_product_id": 24,
          "cm_device_id": 101,
          "cm_product_id": 44,
          "start_ms": 150,
          "end_ms": 200,
          "duration_ms": 50,
          "date": "1970-01-01",
          "recording_expected": true,
          "recording_reason": [6]
        }
      ]
    },
    {
      "label": "recording_expected only after vg first connected are included.",
      "parameters": {
        "start_date": " '1970-01-01' ",
        "end_date": " '1970-01-03' ",
        "pipeline_execution_time": " '1970-01-10 12:00:00' "
      },
      "input_data": {
        "cm_health_report.cm_2x_3x_linked_vgs": [
          {
            "org_id": 10,
            "vg_device_id": 100,
            "product_id": 24,
            "linked_cm_id": 101,
            "cm_product_id": 44,
            "upper_camera_serial": "CXXX-XXX-XXX",
            "camera_first_connected_at_ms": 1000
          }
        ],
        "kinesisstats.osddashcamtargetstate": [
          {
            "org_id": 10,
            "object_id": 101,
            "time": 20,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": [],
                  "camera_target_state": 1
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          },
          {
            "org_id": 10,
            "object_id": 101,
            "time": 150,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": [6],
                  "camera_target_state": 2
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          },
          {
            "org_id": 10,
            "object_id": 101,
            "time": 200,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": [],
                  "camera_target_state": 1
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          }
        ]
      },
      "expected_data": []
    },
    {
      "label": "databreak exists",
      "parameters": {
        "start_date": " '1970-01-01' ",
        "end_date": " '1970-01-03' ",
        "pipeline_execution_time": " '1970-01-10 12:00:00' "
      },
      "input_data": {
        "cm_health_report.cm_2x_3x_linked_vgs": [
          {
            "org_id": 10,
            "vg_device_id": 100,
            "product_id": 24,
            "linked_cm_id": 101,
            "cm_product_id": 44,
            "upper_camera_serial": "CXXX-XXX-XXX",
            "camera_first_connected_at_ms": 0
          }
        ],
        "kinesisstats.osddashcamtargetstate": [
          {
            "org_id": 10,
            "object_id": 101,
            "time": 10,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": [6, 8],
                  "camera_target_state": 2
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          },
          {
            "org_id": 10,
            "object_id": 101,
            "time": 20,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": [6, 8],
                  "camera_target_state": 2
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          },
          {
            "org_id": 10,
            "object_id": 101,
            "time": 150,
            "value": {
              "is_databreak": true,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": null,
                  "camera_target_state": null
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          },
          {
            "org_id": 10,
            "object_id": 101,
            "time": 200,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": [8],
                  "camera_target_state": 2
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          },
          {
            "org_id": 10,
            "object_id": 101,
            "time": 250,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": [8],
                  "camera_target_state": 2
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          }
        ]
      },
      "expected_data": [
        {
          "org_id": 10,
          "vg_device_id": 100,
          "vg_product_id": 24,
          "cm_device_id": 101,
          "cm_product_id": 44,
          "start_ms": 10,
          "end_ms": 20,
          "duration_ms": 10,
          "date": "1970-01-01",
          "recording_expected": true,
          "recording_reason": [6, 8]
        },
        {
          "org_id": 10,
          "vg_device_id": 100,
          "vg_product_id": 24,
          "cm_device_id": 101,
          "cm_product_id": 44,
          "start_ms": 200,
          "end_ms": 250,
          "duration_ms": 50,
          "date": "1970-01-01",
          "recording_expected": true,
          "recording_reason": [8]
        }
      ]
    },
    {
      "label": "a camera currently recording due to no stopped object stat",
      "parameters": {
        "start_date": " '1970-01-01' ",
        "end_date": " '1970-01-03' ",
        "pipeline_execution_time": " '1970-01-10 12:00:00' "
      },
      "input_data": {
        "cm_health_report.cm_2x_3x_linked_vgs": [
          {
            "org_id": 10,
            "vg_device_id": 100,
            "product_id": 24,
            "linked_cm_id": 101,
            "cm_product_id": 44,
            "upper_camera_serial": "CXXX-XXX-XXX",
            "camera_first_connected_at_ms": 0
          }
        ],
        "kinesisstats.osddashcamtargetstate": [
          {
            "org_id": 10,
            "object_id": 101,
            "time": 10,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": [6, 8],
                  "camera_target_state": 2
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          },
          {
            "org_id": 10,
            "object_id": 101,
            "time": 20,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "proto_value": {
                "dashcam_target_state": {
                  "recording_reason": [6, 8],
                  "camera_target_state": 2
                }
              }
            },
            "date": "1970-01-01",
            "version": 101
          }
        ]
      },
      "expected_data": [
        {
          "org_id": 10,
          "vg_device_id": 100,
          "vg_product_id": 24,
          "cm_device_id": 101,
          "cm_product_id": 44,
          "start_ms": 10,
          "end_ms": 20,
          "duration_ms": 10,
          "date": "1970-01-01",
          "recording_expected": true,
          "recording_reason": [6, 8]
        }
      ]
    }
  ]
}

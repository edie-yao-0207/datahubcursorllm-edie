{
  "name": "apptelematics.trip_data_quality_metrics",
  "owner": "AppTelematics",
  "description": "Generate quality metrics data about from app telematics trips",
  "nonproduction": true,
  "disabled_regions": ["us-west-2", "eu-west-1", "ca-central-1"],
  "dependencies": [
    {
      "dbname": "trips2db_shards",
      "tablename": "trips",
      "type": "table",
      "external": true
    },
    {
      "dbname": "kinesisstats",
      "tablename": "location",
      "type": "table",
      "external": true
    },
    {
      "dbname": "clouddb",
      "tablename": "organizations",
      "type": "table",
      "external": true
    },
    {
      "dbname": "apptelematics",
      "tablename": "trip_platform_assignment",
      "type": "table"
    },
    {
      "dbname": "apptelematics",
      "tablename": "device_ids",
      "type": "table",
      "external": true
    }
  ],
  "parameters": ["start_date", "end_date"],
  "output": {
    "dbname": "apptelematics",
    "tablename": "trip_data_quality_metrics",
    "type": "table",
    "partition": ["date"],
    "primary_key": ["date", "org_name", "device_id", "trip_start_pacific"],
    "write_mode": "overwrite",
    "schema": [
      {
        "name": "date",
        "type": "date",
        "metadata": {
          "comment": "$date_default_description"
        }
      },
      {
        "name": "org_name",
        "type": "string",
        "metadata": {
          "comment": "Name of the org who logged the trip"
        }
      },
      {
        "name": "device_id",
        "type": "long",
        "metadata": {
          "comment": "$device_id_default_description"
        }
      },
      {
        "name": "mobile_platform",
        "type": "string",
        "metadata": {
          "comment": "The mobile platform of the device that logged the trip"
        }
      },
      {
        "name": "mobile_os_version",
        "type": "string",
        "metadata": {
          "comment": "The os version of the device that logged the trip"
        }
      },
      {
        "name": "mobile_bundle_version",
        "type": "string",
        "metadata": {
          "comment": "The app bundle version of the device that logged the trip"
        }
      },
      {
        "name": "trip_start_pacific",
        "type": "timestamp",
        "metadata": {
          "comment": "The PST timestamp of the trip start"
        }
      },
      {
        "name": "duration_mins",
        "type": "double",
        "metadata": {
          "comment": "Duration of the trip in minutes"
        }
      },
      {
        "name": "points_per_min",
        "type": "double",
        "metadata": {
          "comment": "The average number of location points per minute logged in the trip"
        }
      },
      {
        "name": "avg_speed_mph",
        "type": "double",
        "metadata": {
          "comment": "The average speed of the trip"
        }
      },
      {
        "name": "avg_accuracy_m",
        "type": "double",
        "metadata": {
          "comment": "The average accuracy of the trip"
        }
      },
      {
        "name": "url",
        "type": "string",
        "nullable": false,
        "metadata": {
          "comment": "The cloud dashboard url of the trip. Use this to see the trip in the Samsara UI."
        }
      }
    ]
  }
}

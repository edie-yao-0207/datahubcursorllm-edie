{
  "test_cases": [
    {
      "label": "simple test including routes by scheduled start and recently updated routes",
      "parameters": {
        "start_date": " '2020-08-02' ",
        "end_date": " '2020-08-04' "
      },
      "input_data": {
        "dispatchdb_shards.shardable_dispatch_routes": [
          {
            "org_id": 1,
            "id": 5678,
            "driver_id": 5,
            "vehicle_id": null,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596447410000,
            "scheduled_end_ms": 1596490610000,
            "complete_last_stop_on_departure": 1
          },
          {
            "org_id": 1,
            "id": 6789,
            "driver_id": 5,
            "vehicle_id": null,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596447410000,
            "scheduled_end_ms": 1596490610000,
            "complete_last_stop_on_departure": 1
          },
          {
            "org_id": 1,
            "id": 6800,
            "driver_id": null,
            "vehicle_id": 10,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "scheduled_meters": 0,
            "scheduled_start_ms": 1597042800000,
            "scheduled_end_ms": 1597086000000,
            "complete_last_stop_on_departure": 1
          },
          {
            "org_id": 1,
            "id": 7000,
            "driver_id": null,
            "vehicle_id": 20,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "scheduled_meters": 0,
            "scheduled_start_ms": 1597042800000,
            "scheduled_end_ms": 1597086000000,
            "complete_last_stop_on_departure": 1,
            "updated_at": "2020-08-03 14:00:00"
          }
        ],
        "dispatchdb_shards.shardable_dispatch_jobs": [
          {
            "org_id": 1,
            "dispatch_route_id": 5678,
            "id": 100,
            "driver_id": 5,
            "vehicle_id": null,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 10:11:12",
            "arrived_at": "2020-08-03 10:11:12",
            "completed_at": "2020-08-03 10:11:12",
            "skipped_at": "1970-01-01 10:11:12",
            "scheduled_arrival_time": "2020-08-04 10:11:12",
            "job_state": 3
          },
          {
            "org_id": 1,
            "dispatch_route_id": 5678,
            "id": 101,
            "driver_id": 5,
            "vehicle_id": null,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 10:11:12",
            "arrived_at": "2020-08-03 10:11:12",
            "completed_at": "2020-08-03 10:11:12",
            "skipped_at": "1970-01-01 10:11:12",
            "scheduled_arrival_time": "2020-08-04 10:11:12",
            "job_state": 4
          },
          {
            "org_id": 1,
            "dispatch_route_id": 6789,
            "id": 102,
            "driver_id": 5,
            "vehicle_id": null,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 10:11:12",
            "arrived_at": "2020-08-03 10:11:12",
            "completed_at": "2020-08-03 10:11:12",
            "skipped_at": "1970-01-01 10:11:12",
            "scheduled_arrival_time": "2020-08-04 10:11:12",
            "job_state": 4
          },
          {
            "org_id": 1,
            "dispatch_route_id": 6800,
            "id": 103,
            "driver_id": null,
            "vehicle_id": 10,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 10:11:12",
            "arrived_at": "2020-08-03 10:11:12",
            "completed_at": "2020-08-03 10:11:12",
            "skipped_at": "1970-01-01 10:11:12",
            "scheduled_arrival_time": "2020-08-04 10:11:12",
            "job_state": 3,
            "updated_at": "2020-08-03 12:00:00"
          },
          {
            "org_id": 1,
            "dispatch_route_id": 7000,
            "id": 104,
            "driver_id": null,
            "vehicle_id": 20,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 10:11:12",
            "arrived_at": "2020-08-03 10:11:12",
            "completed_at": "2020-08-03 10:11:12",
            "skipped_at": "1970-01-01 10:11:12",
            "scheduled_arrival_time": "2020-08-04 10:11:12",
            "job_state": 3
          }
        ]
      },
      "expected_data": [
        {
          "job_id": 100,
          "route_id": 5678,
          "org_id": 1,
          "object_type": 0,
          "object_id": 5,
          "start_location_lat": -74.5,
          "start_location_lng": 13.2,
          "destination_lat": 10.5,
          "destination_lng": 11.2,
          "en_route_at": "2020-08-03 10:11:12",
          "arrived_at": "2020-08-03 10:11:12",
          "completed_at": "2020-08-03 10:11:12",
          "skipped_at": "1970-01-01 10:11:12",
          "scheduled_meters": 0,
          "scheduled_start_ms": 1596447410000,
          "route_scheduled_or_updated_date": "2020-08-03",
          "scheduled_end_ms": 1596490610000,
          "scheduled_arrival_time": "2020-08-04 10:11:12",
          "complete_last_stop_on_departure": 1,
          "job_state": 3
        },
        {
          "job_id": 101,
          "route_id": 5678,
          "org_id": 1,
          "object_type": 0,
          "object_id": 5,
          "start_location_lat": -74.5,
          "start_location_lng": 13.2,
          "destination_lat": 10.5,
          "destination_lng": 11.2,
          "en_route_at": "2020-08-03 10:11:12",
          "arrived_at": "2020-08-03 10:11:12",
          "completed_at": "2020-08-03 10:11:12",
          "skipped_at": "1970-01-01 10:11:12",
          "scheduled_meters": 0,
          "scheduled_start_ms": 1596447410000,
          "route_scheduled_or_updated_date": "2020-08-03",
          "scheduled_end_ms": 1596490610000,
          "scheduled_arrival_time": "2020-08-04 10:11:12",
          "complete_last_stop_on_departure": 1,
          "job_state": 4
        },
        {
          "job_id": 103,
          "route_id": 6800,
          "org_id": 1,
          "object_type": 1,
          "object_id": 10,
          "start_location_lat": -74.5,
          "start_location_lng": 13.2,
          "destination_lat": 10.5,
          "destination_lng": 11.2,
          "en_route_at": "2020-08-03 10:11:12",
          "arrived_at": "2020-08-03 10:11:12",
          "completed_at": "2020-08-03 10:11:12",
          "skipped_at": "1970-01-01 10:11:12",
          "scheduled_meters": 0,
          "scheduled_start_ms": 1597042800000,
          "route_scheduled_or_updated_date": "2020-08-03",
          "scheduled_end_ms": 1597086000000,
          "scheduled_arrival_time": "2020-08-04 10:11:12",
          "complete_last_stop_on_departure": 1,
          "job_state": 3
        },
        {
          "job_id": 104,
          "route_id": 7000,
          "org_id": 1,
          "object_type": 1,
          "object_id": 20,
          "start_location_lat": -74.5,
          "start_location_lng": 13.2,
          "destination_lat": 10.5,
          "destination_lng": 11.2,
          "en_route_at": "2020-08-03 10:11:12",
          "arrived_at": "2020-08-03 10:11:12",
          "completed_at": "2020-08-03 10:11:12",
          "skipped_at": "1970-01-01 10:11:12",
          "scheduled_meters": 0,
          "scheduled_start_ms": 1597042800000,
          "route_scheduled_or_updated_date": "2020-08-03",
          "scheduled_end_ms": 1597086000000,
          "scheduled_arrival_time": "2020-08-04 10:11:12",
          "complete_last_stop_on_departure": 1,
          "job_state": 3
        }
      ]
    }
  ]
}

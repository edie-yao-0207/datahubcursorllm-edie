{
  "test_cases": [
    {
      "label": "last actual job is last scheduled job test",
      "parameters": {
        "start_date": " '2020-08-02' ",
        "end_date": " '2020-08-04' "
      },
      "input_data": {
        "dispatch_routes_report.selected_routes_and_jobs": [
          {
            "job_id": 1234,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 13:15:41",
            "arrived_at": "2020-08-03 14:01:31",
            "completed_at": "2020-08-03 14:55:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:30:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          },
          {
            "job_id": 1235,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 12.5,
            "destination_lng": 15.2,
            "en_route_at": "2020-08-03 13:35:41",
            "arrived_at": "2020-08-03 14:16:31",
            "completed_at": "2020-08-03 15:10:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:15:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          },
          {
            "job_id": 1236,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 22.5,
            "destination_lng": 25.2,
            "en_route_at": "2020-08-03 13:45:41",
            "arrived_at": "2020-08-03 14:31:31",
            "completed_at": "2020-08-03 15:25:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 15:00:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          }
        ]
      },
      "expected_data": [
        {
          "route_id": 5678,
          "org_id": 1,
          "object_type": 0,
          "object_id": 5,
          "actual_start_ms": 1596460541000,
          "actual_end_ms": 1596465091000,
          "scheduled_start_ms": 1596326400000,
          "route_scheduled_or_updated_date": "2020-08-02"
        }
      ]
    },
    {
      "label": "last actual job is not last scheduled job test",
      "parameters": {
        "start_date": " '2020-08-02' ",
        "end_date": " '2020-08-04' "
      },
      "input_data": {
        "dispatch_routes_report.selected_routes_and_jobs": [
          {
            "job_id": 1234,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 13:15:41",
            "arrived_at": "2020-08-03 14:01:31",
            "completed_at": "2020-08-03 14:55:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:30:00",
            "complete_last_stop_on_departure": 0,
            "job_state": 3
          },
          {
            "job_id": 1236,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 12.5,
            "destination_lng": 15.2,
            "en_route_at": "2020-08-03 13:35:41",
            "arrived_at": "2020-08-03 14:16:31",
            "completed_at": "2020-08-03 15:10:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:15:00",
            "complete_last_stop_on_departure": 0,
            "job_state": 3
          },
          {
            "job_id": 1235,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 22.5,
            "destination_lng": 25.2,
            "en_route_at": "2020-08-03 13:45:41",
            "arrived_at": "2020-08-03 14:31:31",
            "completed_at": "2020-08-03 15:25:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 15:00:00",
            "complete_last_stop_on_departure": 0,
            "job_state": 3
          }
        ]
      },
      "expected_data": [
        {
          "route_id": 5678,
          "org_id": 1,
          "object_type": 0,
          "object_id": 5,
          "actual_start_ms": 1596460541000,
          "actual_end_ms": 1596468308000,
          "scheduled_start_ms": 1596326400000,
          "route_scheduled_or_updated_date": "2020-08-02"
        }
      ]
    },
    {
      "label": "start ms is en route time test",
      "parameters": {
        "start_date": " '2020-08-02' ",
        "end_date": " '2020-08-04' "
      },
      "input_data": {
        "dispatch_routes_report.selected_routes_and_jobs": [
          {
            "job_id": 1234,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 13:15:41",
            "arrived_at": "2020-08-03 14:01:31",
            "completed_at": "2020-08-03 14:55:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:30:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          },
          {
            "job_id": 1235,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 12.5,
            "destination_lng": 15.2,
            "en_route_at": "2020-08-03 13:35:41",
            "arrived_at": "2020-08-03 14:16:31",
            "completed_at": "2020-08-03 15:10:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:45:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          }
        ]
      },
      "expected_data": [
        {
          "route_id": 5678,
          "org_id": 1,
          "object_type": 0,
          "object_id": 5,
          "actual_start_ms": 1596460541000,
          "actual_end_ms": 1596464191000,
          "scheduled_start_ms": 1596326400000,
          "route_scheduled_or_updated_date": "2020-08-02"
        }
      ]
    },
    {
      "label": "start ms is arrived at time, actual stop order same as scheduled stop order test",
      "parameters": {
        "start_date": " '2020-08-02' ",
        "end_date": " '2020-08-04' "
      },
      "input_data": {
        "dispatch_routes_report.selected_routes_and_jobs": [
          {
            "job_id": 1234,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 14:01:31",
            "arrived_at": "2020-08-03 13:15:41",
            "completed_at": "2020-08-03 14:55:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:30:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          },
          {
            "job_id": 1235,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 12.5,
            "destination_lng": 15.2,
            "en_route_at": "2020-08-03 14:56:41",
            "arrived_at": "2020-08-03 14:57:31",
            "completed_at": "2020-08-03 15:10:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 15:35:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          }
        ]
      },
      "expected_data": [
        {
          "route_id": 5678,
          "org_id": 1,
          "object_type": 0,
          "object_id": 5,
          "actual_start_ms": 1596460541000,
          "actual_end_ms": 1596466651000,
          "scheduled_start_ms": 1596326400000,
          "route_scheduled_or_updated_date": "2020-08-02"
        }
      ]
    },
    {
      "label": "start ms is completed at time test",
      "parameters": {
        "start_date": " '2020-08-02' ",
        "end_date": " '2020-08-04' "
      },
      "input_data": {
        "dispatch_routes_report.selected_routes_and_jobs": [
          {
            "job_id": 1234,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 14:01:31",
            "arrived_at": "2020-08-03 14:16:08",
            "completed_at": "2020-08-03 13:15:41",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:15:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          },
          {
            "job_id": 1235,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 12.5,
            "destination_lng": 15.2,
            "en_route_at": "2020-08-03 13:35:41",
            "arrived_at": "2020-08-03 14:55:31",
            "completed_at": "2020-08-03 15:10:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:30:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          }
        ]
      },
      "expected_data": [
        {
          "route_id": 5678,
          "org_id": 1,
          "object_type": 0,
          "object_id": 5,
          "actual_start_ms": 1596460541000,
          "actual_end_ms": 1596466531000,
          "scheduled_start_ms": 1596326400000,
          "route_scheduled_or_updated_date": "2020-08-02"
        }
      ]
    },
    {
      "label": "start ms is arrived at time test, actual stop order not same as scheduled stop order test",
      "parameters": {
        "start_date": " '2020-08-02' ",
        "end_date": " '2020-08-04' "
      },
      "input_data": {
        "dispatch_routes_report.selected_routes_and_jobs": [
          {
            "job_id": 1234,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 14:01:31",
            "arrived_at": "2020-08-03 13:15:41",
            "completed_at": "2020-08-03 14:55:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:30:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          },
          {
            "job_id": 1235,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 12.5,
            "destination_lng": 15.2,
            "en_route_at": "2020-08-03 13:35:41",
            "arrived_at": "2020-08-03 14:16:31",
            "completed_at": "2020-08-03 15:10:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:15:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          }
        ]
      },
      "expected_data": [
        {
          "route_id": 5678,
          "org_id": 1,
          "object_type": 0,
          "object_id": 5,
          "actual_start_ms": 1596460541000,
          "actual_end_ms": 1596467408000,
          "scheduled_start_ms": 1596326400000,
          "route_scheduled_or_updated_date": "2020-08-02"
        }
      ]
    },
    {
      "label": "skip last scheduled stop test",
      "parameters": {
        "start_date": " '2020-08-02' ",
        "end_date": " '2020-08-04' "
      },
      "input_data": {
        "dispatch_routes_report.selected_routes_and_jobs": [
          {
            "job_id": 1234,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 13:15:41",
            "arrived_at": "2020-08-03 14:01:31",
            "completed_at": "2020-08-03 14:55:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:30:00",
            "complete_last_stop_on_departure": 0,
            "job_state": 3
          },
          {
            "job_id": 1235,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 12.5,
            "destination_lng": 15.2,
            "en_route_at": "2020-08-03 13:35:41",
            "arrived_at": "2020-08-03 14:16:31",
            "completed_at": "2020-08-03 15:10:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:15:00",
            "complete_last_stop_on_departure": 0,
            "job_state": 3
          },
          {
            "job_id": 1236,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 22.5,
            "destination_lng": 25.2,
            "en_route_at": "1970-01-01 00:00:00",
            "arrived_at": "1970-01-01 00:00:00",
            "completed_at": "1970-01-01 00:00:00",
            "skipped_at": "2020-08-03 15:25:08",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 15:00:00",
            "complete_last_stop_on_departure": 0,
            "job_state": 4
          }
        ]
      },
      "expected_data": [
        {
          "route_id": 5678,
          "org_id": 1,
          "object_type": 0,
          "object_id": 5,
          "actual_start_ms": 1596460541000,
          "actual_end_ms": 1596467408000,
          "scheduled_start_ms": 1596326400000,
          "route_scheduled_or_updated_date": "2020-08-02"
        }
      ]
    },
    {
      "label": "skip middle scheduled stop test",
      "parameters": {
        "start_date": " '2020-08-02' ",
        "end_date": " '2020-08-04' "
      },
      "input_data": {
        "dispatch_routes_report.selected_routes_and_jobs": [
          {
            "job_id": 1234,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 10.5,
            "destination_lng": 11.2,
            "en_route_at": "2020-08-03 13:15:41",
            "arrived_at": "2020-08-03 14:01:31",
            "completed_at": "2020-08-03 14:55:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:30:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          },
          {
            "job_id": 1235,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 12.5,
            "destination_lng": 15.2,
            "en_route_at": "1970-01-01 00:00:00",
            "arrived_at": "1970-01-01 00:00:00",
            "completed_at": "1970-01-01 00:00:00",
            "skipped_at": "2020-08-03 15:10:08",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 14:15:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 4
          },
          {
            "job_id": 1236,
            "route_id": 5678,
            "org_id": 1,
            "object_type": 0,
            "object_id": 5,
            "start_location_lat": -74.5,
            "start_location_lng": 13.2,
            "destination_lat": 22.5,
            "destination_lng": 25.2,
            "en_route_at": "2020-08-03 13:45:41",
            "arrived_at": "2020-08-03 14:31:31",
            "completed_at": "2020-08-03 15:25:08",
            "skipped_at": "1970-01-01 00:00:00",
            "scheduled_meters": 0,
            "scheduled_start_ms": 1596326400000,
            "route_scheduled_or_updated_date": "2020-08-02",
            "scheduled_end_ms": 1596499200000,
            "scheduled_arrival_time": "2020-08-03 15:00:00",
            "complete_last_stop_on_departure": 1,
            "job_state": 3
          }
        ]
      },
      "expected_data": [
        {
          "route_id": 5678,
          "org_id": 1,
          "object_type": 0,
          "object_id": 5,
          "actual_start_ms": 1596460541000,
          "actual_end_ms": 1596465091000,
          "scheduled_start_ms": 1596326400000,
          "route_scheduled_or_updated_date": "2020-08-02"
        }
      ]
    }
  ]
}

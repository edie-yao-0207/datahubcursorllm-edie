{
  "test_cases": [
    {
      "label": "correctly summing over behavior label counts",
      "parameters": {
        "start_date": " '2022-01-04' ",
        "end_date": " '2022-01-07' "
      },
      "input_data": {
        "safety_report.trip_with_safety_event_labels_v2": [
          {
            "org_id": 123,
            "device_id": 1,
            "driver_id": 1,
            "trip_start_ms": 1641340800000,
            "trip_end_ms": 1641344340000,
            "trip_version": 101,
            "accel_type": 2,
            "event_ms": 1641342600000,
            "release_stage": 100,
            "date": "2022-01-05",
            "label_type": 2,
            "label_source": 1,
            "in_dismissed_states": 0,
            "in_recognition_states": 0,
            "in_coaching_states": 0,
            "in_triage_states": 1
          },
          {
            "org_id": 123,
            "device_id": 1,
            "driver_id": 1,
            "trip_start_ms": 1641340800000,
            "trip_end_ms": 1641344340000,
            "trip_version": 101,
            "accel_type": 2,
            "event_ms": 1641342600000,
            "release_stage": 100,
            "date": "2022-01-05",
            "label_type": 2,
            "label_source": 1,
            "in_dismissed_states": 0,
            "in_recognition_states": 0,
            "in_coaching_states": 0,
            "in_triage_states": 1
          },
          {
            "org_id": 123,
            "device_id": 1,
            "driver_id": 1,
            "trip_start_ms": 1641340800000,
            "trip_end_ms": 1641344340000,
            "trip_version": 101,
            "accel_type": 2,
            "event_ms": 1641342600000,
            "release_stage": 100,
            "date": "2022-01-05",
            "label_type": 17,
            "label_source": 1,
            "in_dismissed_states": 0,
            "in_recognition_states": 0,
            "in_coaching_states": 0,
            "in_triage_states": 1
          },
          {
            "org_id": 123,
            "device_id": 1,
            "driver_id": 1,
            "trip_start_ms": 1641340800000,
            "trip_end_ms": 1641344340000,
            "trip_version": 101,
            "accel_type": 2,
            "event_ms": 1641342600000,
            "release_stage": 100,
            "date": "2022-01-05",
            "label_type": 19,
            "label_source": 1,
            "in_dismissed_states": 0,
            "in_recognition_states": 0,
            "in_coaching_states": 0,
            "in_triage_states": 1
          }
        ]
      },
      "expected_data": [
        {
          "org_id": 123,
          "object_id": 1,
          "object_type": 1,
          "interval_start": "2022-01-05 00:00:00",
          "label_source": 1,
          "trip_version": 101,
          "release_stage": 100,
          "in_dismissed_states": 0,
          "in_recognition_states": 0,
          "in_coaching_states": 0,
          "in_triage_states": 1,
          "date": "2022-01-05",
          "invalid_count": null,
          "generic_tailgating_count": null,
          "generic_distraction_count": 2,
          "defensive_driving_count": null,
          "rolling_stop_count": null,
          "near_collison_count": null,
          "speeding_count": null,
          "obstructed_camera_count": null,
          "did_not_yield_count": null,
          "no_seatbelt_count": null,
          "mobile_usage_count": null,
          "drowsy_count": null,
          "lane_departure_count": null,
          "following_distance_severe_count": null,
          "following_distance_moderate_count": null,
          "late_response_count": null,
          "acceleration_count": null,
          "braking_count": 1,
          "harsh_turn_count": null,
          "crash_count": 1,
          "rollover_protection_count": null,
          "yaw_control_count": null,
          "ran_red_light_count": null,
          "forward_collision_warning_count": null,
          "eating_drinking_count": null,
          "smoking_count": null,
          "following_distance_count": null,
          "edge_distracted_driving_count": null,
          "policy_violation_mask_count": null,
          "eating_count": null,
          "drinking_count": null,
          "edge_railroad_crossing_violation_count": null,
          "max_speed_count": null
        },
        {
          "org_id": 123,
          "object_id": 1,
          "object_type": 5,
          "interval_start": "2022-01-05 00:00:00",
          "label_source": 1,
          "trip_version": 101,
          "release_stage": 100,
          "in_dismissed_states": 0,
          "in_recognition_states": 0,
          "in_coaching_states": 0,
          "in_triage_states": 1,
          "date": "2022-01-05",
          "invalid_count": null,
          "generic_tailgating_count": null,
          "generic_distraction_count": 2,
          "defensive_driving_count": null,
          "rolling_stop_count": null,
          "near_collison_count": null,
          "speeding_count": null,
          "obstructed_camera_count": null,
          "did_not_yield_count": null,
          "no_seatbelt_count": null,
          "mobile_usage_count": null,
          "drowsy_count": null,
          "lane_departure_count": null,
          "following_distance_severe_count": null,
          "following_distance_moderate_count": null,
          "late_response_count": null,
          "acceleration_count": null,
          "braking_count": 1,
          "harsh_turn_count": null,
          "crash_count": 1,
          "rollover_protection_count": null,
          "yaw_control_count": null,
          "ran_red_light_count": null,
          "forward_collision_warning_count": null,
          "eating_drinking_count": null,
          "smoking_count": null,
          "following_distance_count": null,
          "edge_distracted_driving_count": null,
          "policy_violation_mask_count": null,
          "eating_count": null,
          "drinking_count": null,
          "edge_railroad_crossing_violation_count": null,
          "max_speed_count": null
        }
      ]
    },
    {
      "label": "correctly grouping behavior label counts by intervals",
      "parameters": {
        "start_date": " '2022-01-04' ",
        "end_date": " '2022-01-07' "
      },
      "input_data": {
        "safety_report.trip_with_safety_event_labels_v2": [
          {
            "org_id": 123,
            "device_id": 1,
            "driver_id": 1,
            "trip_start_ms": 1641340800000,
            "trip_end_ms": 1641344340000,
            "trip_version": 101,
            "accel_type": 2,
            "event_ms": 1641342600000,
            "release_stage": 100,
            "date": "2022-01-05",
            "label_type": 2,
            "label_source": 1,
            "in_dismissed_states": 0,
            "in_recognition_states": 0,
            "in_coaching_states": 0,
            "in_triage_states": 1
          },
          {
            "org_id": 123,
            "device_id": 1,
            "driver_id": 1,
            "trip_start_ms": 1641340800000,
            "trip_end_ms": 1641344340000,
            "trip_version": 101,
            "accel_type": 2,
            "event_ms": 1641342600000,
            "release_stage": 100,
            "date": "2022-01-05",
            "label_type": 2,
            "label_source": 1,
            "in_dismissed_states": 0,
            "in_recognition_states": 0,
            "in_coaching_states": 0,
            "in_triage_states": 1
          },
          {
            "org_id": 123,
            "device_id": 1,
            "driver_id": 1,
            "trip_start_ms": 1641344400000,
            "trip_end_ms": 1641347940000,
            "trip_version": 101,
            "accel_type": 2,
            "event_ms": 1641346200000,
            "release_stage": 100,
            "date": "2022-01-05",
            "label_type": 17,
            "label_source": 1,
            "in_dismissed_states": 0,
            "in_recognition_states": 0,
            "in_coaching_states": 0,
            "in_triage_states": 1
          },
          {
            "org_id": 123,
            "device_id": 1,
            "driver_id": 1,
            "trip_start_ms": 1641344400000,
            "trip_end_ms": 1641347940000,
            "trip_version": 101,
            "accel_type": 2,
            "event_ms": 1641346200000,
            "release_stage": 100,
            "date": "2022-01-05",
            "label_type": 19,
            "label_source": 1,
            "in_dismissed_states": 0,
            "in_recognition_states": 0,
            "in_coaching_states": 0,
            "in_triage_states": 1
          }
        ]
      },
      "expected_data": [
        {
          "org_id": 123,
          "object_id": 1,
          "object_type": 1,
          "interval_start": "2022-01-05 00:00:00",
          "label_source": 1,
          "trip_version": 101,
          "release_stage": 100,
          "in_dismissed_states": 0,
          "in_recognition_states": 0,
          "in_coaching_states": 0,
          "in_triage_states": 1,
          "date": "2022-01-05",
          "invalid_count": null,
          "generic_tailgating_count": null,
          "generic_distraction_count": 2,
          "defensive_driving_count": null,
          "rolling_stop_count": null,
          "near_collison_count": null,
          "speeding_count": null,
          "obstructed_camera_count": null,
          "did_not_yield_count": null,
          "no_seatbelt_count": null,
          "mobile_usage_count": null,
          "drowsy_count": null,
          "lane_departure_count": null,
          "following_distance_severe_count": null,
          "following_distance_moderate_count": null,
          "late_response_count": null,
          "acceleration_count": null,
          "braking_count": null,
          "harsh_turn_count": null,
          "crash_count": null,
          "rollover_protection_count": null,
          "yaw_control_count": null,
          "ran_red_light_count": null,
          "forward_collision_warning_count": null,
          "eating_drinking_count": null,
          "smoking_count": null,
          "following_distance_count": null,
          "edge_distracted_driving_count": null,
          "policy_violation_mask_count": null,
          "eating_count": null,
          "drinking_count": null,
          "edge_railroad_crossing_violation_count": null,
          "max_speed_count": null
        },
        {
          "org_id": 123,
          "object_id": 1,
          "object_type": 5,
          "interval_start": "2022-01-05 00:00:00",
          "label_source": 1,
          "trip_version": 101,
          "release_stage": 100,
          "in_dismissed_states": 0,
          "in_recognition_states": 0,
          "in_coaching_states": 0,
          "in_triage_states": 1,
          "date": "2022-01-05",
          "invalid_count": null,
          "generic_tailgating_count": null,
          "generic_distraction_count": 2,
          "defensive_driving_count": null,
          "rolling_stop_count": null,
          "near_collison_count": null,
          "speeding_count": null,
          "obstructed_camera_count": null,
          "did_not_yield_count": null,
          "no_seatbelt_count": null,
          "mobile_usage_count": null,
          "drowsy_count": null,
          "lane_departure_count": null,
          "following_distance_severe_count": null,
          "following_distance_moderate_count": null,
          "late_response_count": null,
          "acceleration_count": null,
          "braking_count": null,
          "harsh_turn_count": null,
          "crash_count": null,
          "rollover_protection_count": null,
          "yaw_control_count": null,
          "ran_red_light_count": null,
          "forward_collision_warning_count": null,
          "eating_drinking_count": null,
          "smoking_count": null,
          "following_distance_count": null,
          "edge_distracted_driving_count": null,
          "policy_violation_mask_count": null,
          "eating_count": null,
          "drinking_count": null,
          "edge_railroad_crossing_violation_count": null,
          "max_speed_count": null
        },
        {
          "org_id": 123,
          "object_id": 1,
          "object_type": 1,
          "interval_start": "2022-01-05 01:00:00",
          "label_source": 1,
          "trip_version": 101,
          "release_stage": 100,
          "in_dismissed_states": 0,
          "in_recognition_states": 0,
          "in_coaching_states": 0,
          "in_triage_states": 1,
          "date": "2022-01-05",
          "invalid_count": null,
          "generic_tailgating_count": null,
          "generic_distraction_count": null,
          "defensive_driving_count": null,
          "rolling_stop_count": null,
          "near_collison_count": null,
          "speeding_count": null,
          "obstructed_camera_count": null,
          "did_not_yield_count": null,
          "no_seatbelt_count": null,
          "mobile_usage_count": null,
          "drowsy_count": null,
          "lane_departure_count": null,
          "following_distance_severe_count": null,
          "following_distance_moderate_count": null,
          "late_response_count": null,
          "acceleration_count": null,
          "braking_count": 1,
          "harsh_turn_count": null,
          "crash_count": 1,
          "rollover_protection_count": null,
          "yaw_control_count": null,
          "ran_red_light_count": null,
          "forward_collision_warning_count": null,
          "eating_drinking_count": null,
          "smoking_count": null,
          "following_distance_count": null,
          "edge_distracted_driving_count": null,
          "policy_violation_mask_count": null,
          "eating_count": null,
          "drinking_count": null,
          "edge_railroad_crossing_violation_count": null,
          "max_speed_count": null
        },
        {
          "org_id": 123,
          "object_id": 1,
          "object_type": 5,
          "interval_start": "2022-01-05 01:00:00",
          "label_source": 1,
          "trip_version": 101,
          "release_stage": 100,
          "in_dismissed_states": 0,
          "in_recognition_states": 0,
          "in_coaching_states": 0,
          "in_triage_states": 1,
          "date": "2022-01-05",
          "invalid_count": null,
          "generic_tailgating_count": null,
          "generic_distraction_count": null,
          "defensive_driving_count": null,
          "rolling_stop_count": null,
          "near_collison_count": null,
          "speeding_count": null,
          "obstructed_camera_count": null,
          "did_not_yield_count": null,
          "no_seatbelt_count": null,
          "mobile_usage_count": null,
          "drowsy_count": null,
          "lane_departure_count": null,
          "following_distance_severe_count": null,
          "following_distance_moderate_count": null,
          "late_response_count": null,
          "acceleration_count": null,
          "braking_count": 1,
          "harsh_turn_count": null,
          "crash_count": 1,
          "rollover_protection_count": null,
          "yaw_control_count": null,
          "ran_red_light_count": null,
          "forward_collision_warning_count": null,
          "eating_drinking_count": null,
          "smoking_count": null,
          "following_distance_count": null,
          "edge_distracted_driving_count": null,
          "policy_violation_mask_count": null,
          "eating_count": null,
          "drinking_count": null,
          "edge_railroad_crossing_violation_count": null,
          "max_speed_count": null
        }
      ]
    },
    {
      "label": "correctly grouping behavior label counts by intervals when trip ends at beginning of hourly interval",
      "parameters": {
        "start_date": " '2022-01-04' ",
        "end_date": " '2022-01-07' "
      },
      "input_data": {
        "safety_report.trip_with_safety_event_labels_v2": [
          {
            "org_id": 123,
            "device_id": 1,
            "driver_id": 1,
            "trip_start_ms": 1641340800000,
            "trip_end_ms": 1641344340000,
            "trip_version": 101,
            "accel_type": 2,
            "event_ms": 1641342600000,
            "release_stage": 100,
            "date": "2022-01-05",
            "label_type": 2,
            "label_source": 1,
            "in_dismissed_states": 0,
            "in_recognition_states": 0,
            "in_coaching_states": 0,
            "in_triage_states": 1
          },
          {
            "org_id": 123,
            "device_id": 1,
            "driver_id": 1,
            "trip_start_ms": 1641340800000,
            "trip_end_ms": 1641344400000,
            "trip_version": 101,
            "accel_type": 2,
            "event_ms": 1641342600000,
            "release_stage": 100,
            "date": "2022-01-05",
            "label_type": 17,
            "label_source": 1,
            "in_dismissed_states": 0,
            "in_recognition_states": 0,
            "in_coaching_states": 0,
            "in_triage_states": 1
          }
        ]
      },
      "expected_data": [
        {
          "org_id": 123,
          "object_id": 1,
          "object_type": 1,
          "interval_start": "2022-01-05 00:00:00",
          "label_source": 1,
          "trip_version": 101,
          "release_stage": 100,
          "in_dismissed_states": 0,
          "in_recognition_states": 0,
          "in_coaching_states": 0,
          "in_triage_states": 1,
          "date": "2022-01-05",
          "invalid_count": null,
          "generic_tailgating_count": null,
          "generic_distraction_count": 1,
          "defensive_driving_count": null,
          "rolling_stop_count": null,
          "near_collison_count": null,
          "speeding_count": null,
          "obstructed_camera_count": null,
          "did_not_yield_count": null,
          "no_seatbelt_count": null,
          "mobile_usage_count": null,
          "drowsy_count": null,
          "lane_departure_count": null,
          "following_distance_severe_count": null,
          "following_distance_moderate_count": null,
          "late_response_count": null,
          "acceleration_count": null,
          "braking_count": null,
          "harsh_turn_count": null,
          "crash_count": null,
          "rollover_protection_count": null,
          "yaw_control_count": null,
          "ran_red_light_count": null,
          "forward_collision_warning_count": null,
          "eating_drinking_count": null,
          "smoking_count": null,
          "following_distance_count": null,
          "edge_distracted_driving_count": null,
          "policy_violation_mask_count": null,
          "eating_count": null,
          "drinking_count": null,
          "edge_railroad_crossing_violation_count": null,
          "max_speed_count": null
        },
        {
          "org_id": 123,
          "object_id": 1,
          "object_type": 5,
          "interval_start": "2022-01-05 00:00:00",
          "label_source": 1,
          "trip_version": 101,
          "release_stage": 100,
          "in_dismissed_states": 0,
          "in_recognition_states": 0,
          "in_coaching_states": 0,
          "in_triage_states": 1,
          "date": "2022-01-05",
          "invalid_count": null,
          "generic_tailgating_count": null,
          "generic_distraction_count": 1,
          "defensive_driving_count": null,
          "rolling_stop_count": null,
          "near_collison_count": null,
          "speeding_count": null,
          "obstructed_camera_count": null,
          "did_not_yield_count": null,
          "no_seatbelt_count": null,
          "mobile_usage_count": null,
          "drowsy_count": null,
          "lane_departure_count": null,
          "following_distance_severe_count": null,
          "following_distance_moderate_count": null,
          "late_response_count": null,
          "acceleration_count": null,
          "braking_count": null,
          "harsh_turn_count": null,
          "crash_count": null,
          "rollover_protection_count": null,
          "yaw_control_count": null,
          "ran_red_light_count": null,
          "forward_collision_warning_count": null,
          "eating_drinking_count": null,
          "smoking_count": null,
          "following_distance_count": null,
          "edge_distracted_driving_count": null,
          "policy_violation_mask_count": null,
          "eating_count": null,
          "drinking_count": null,
          "edge_railroad_crossing_violation_count": null,
          "max_speed_count": null
        },
        {
          "org_id": 123,
          "object_id": 1,
          "object_type": 1,
          "interval_start": "2022-01-05 01:00:00",
          "label_source": 1,
          "trip_version": 101,
          "release_stage": 100,
          "in_dismissed_states": 0,
          "in_recognition_states": 0,
          "in_coaching_states": 0,
          "in_triage_states": 1,
          "date": "2022-01-05",
          "invalid_count": null,
          "generic_tailgating_count": null,
          "generic_distraction_count": null,
          "defensive_driving_count": null,
          "rolling_stop_count": null,
          "near_collison_count": null,
          "speeding_count": null,
          "obstructed_camera_count": null,
          "did_not_yield_count": null,
          "no_seatbelt_count": null,
          "mobile_usage_count": null,
          "drowsy_count": null,
          "lane_departure_count": null,
          "following_distance_severe_count": null,
          "following_distance_moderate_count": null,
          "late_response_count": null,
          "acceleration_count": null,
          "braking_count": 1,
          "harsh_turn_count": null,
          "crash_count": null,
          "rollover_protection_count": null,
          "yaw_control_count": null,
          "ran_red_light_count": null,
          "forward_collision_warning_count": null,
          "eating_drinking_count": null,
          "smoking_count": null,
          "following_distance_count": null,
          "edge_distracted_driving_count": null,
          "policy_violation_mask_count": null,
          "eating_count": null,
          "drinking_count": null,
          "edge_railroad_crossing_violation_count": null,
          "max_speed_count": null
        },
        {
          "org_id": 123,
          "object_id": 1,
          "object_type": 5,
          "interval_start": "2022-01-05 01:00:00",
          "label_source": 1,
          "trip_version": 101,
          "release_stage": 100,
          "in_dismissed_states": 0,
          "in_recognition_states": 0,
          "in_coaching_states": 0,
          "in_triage_states": 1,
          "date": "2022-01-05",
          "invalid_count": null,
          "generic_tailgating_count": null,
          "generic_distraction_count": null,
          "defensive_driving_count": null,
          "rolling_stop_count": null,
          "near_collison_count": null,
          "speeding_count": null,
          "obstructed_camera_count": null,
          "did_not_yield_count": null,
          "no_seatbelt_count": null,
          "mobile_usage_count": null,
          "drowsy_count": null,
          "lane_departure_count": null,
          "following_distance_severe_count": null,
          "following_distance_moderate_count": null,
          "late_response_count": null,
          "acceleration_count": null,
          "braking_count": 1,
          "harsh_turn_count": null,
          "crash_count": null,
          "rollover_protection_count": null,
          "yaw_control_count": null,
          "ran_red_light_count": null,
          "forward_collision_warning_count": null,
          "eating_drinking_count": null,
          "smoking_count": null,
          "following_distance_count": null,
          "edge_distracted_driving_count": null,
          "policy_violation_mask_count": null,
          "eating_count": null,
          "drinking_count": null,
          "edge_railroad_crossing_violation_count": null,
          "max_speed_count": null
        }
      ]
    }
  ]
}

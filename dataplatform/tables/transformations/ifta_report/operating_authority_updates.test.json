{
  "test_cases": [
    {
      "label": "vehicle id populated when single overlapping assignment exists",
      "parameters": {
        "start_date": "'2021-06-01'",
        "end_date": "'2021-06-03'",
        "pipeline_execution_time": "'2022-06-03 12:00:00'"
      },
      "input_data": {
        "compliancedb_shards.driver_carrier_entries": [
          {
            "uuid": "00000000000000000000000000000001",
            "org_id": 1,
            "driver_id": 10,
            "dot_number": 11111,
            "log_at_ms": 1622548800000,
            "created_at_ms": 1622505600000
          }
        ],
        "compliancedb_shards.driver_hos_vehicle_assignments": [
          {
            "id": 1,
            "org_id": 1,
            "driver_id": 10,
            "vehicle_id": 100,
            "start_at": "2021-05-30 00:00:00",
            "end_at": null,
            "is_passenger": 0,
            "session_uuid": "sess-1"
          }
        ]
      },
      "expected_data": [
        {
          "date": "2021-06-01",
          "org_id": 1,
          "driver_id": 10,
          "vehicle_id": 100,
          "operating_authority": 11111,
          "log_at": "2021-06-01 12:00:00",
          "updated_at": "2022-06-03 12:00:00"
        }
      ]
    },

    {
      "label": "latest overlapping assignment chosen when multiple exist",
      "parameters": {
        "start_date": "'2021-06-01'",
        "end_date": "'2021-06-03'",
        "pipeline_execution_time": "'2022-06-03 12:00:00'"
      },
      "input_data": {
        "compliancedb_shards.driver_carrier_entries": [
          {
            "uuid": "00000000000000000000000000000002",
            "org_id": 1,
            "driver_id": 20,
            "dot_number": 22222,
            "log_at_ms": 1622635200000,
            "created_at_ms": 1622592000000
          }
        ],
        "compliancedb_shards.driver_hos_vehicle_assignments": [
          {
            "id": 2,
            "org_id": 1,
            "driver_id": 20,
            "vehicle_id": 101,
            "start_at": "2021-05-25 00:00:00",
            "end_at": null,
            "is_passenger": 0,
            "session_uuid": "sess-2"
          },
          {
            "id": 3,
            "org_id": 1,
            "driver_id": 20,
            "vehicle_id": 102,
            "start_at": "2021-06-01 00:00:00",
            "end_at": null,
            "is_passenger": 0,
            "session_uuid": "sess-3"
          }
        ]
      },
      "expected_data": [
        {
          "date": "2021-06-02",
          "org_id": 1,
          "driver_id": 20,
          "vehicle_id": 102,
          "operating_authority": 22222,
          "log_at": "2021-06-02 12:00:00",
          "updated_at": "2022-06-03 12:00:00"
        }
      ]
    },

    {
      "label": "vehicle id set to 0 when no assignment overlaps",
      "parameters": {
        "start_date": "'2021-06-01'",
        "end_date": "'2021-06-03'",
        "pipeline_execution_time": "'2022-06-03 12:00:00'"
      },
      "input_data": {
        "compliancedb_shards.driver_carrier_entries": [
          {
            "uuid": "00000000000000000000000000000003",
            "org_id": 2,
            "driver_id": 30,
            "dot_number": 33333,
            "log_at_ms": 1622635200000,
            "created_at_ms": 1622592000000
          }
        ],
        "compliancedb_shards.driver_hos_vehicle_assignments": []
      },
      "expected_data": [
        {
          "date": "2021-06-02",
          "org_id": 2,
          "driver_id": 30,
          "vehicle_id": 0,
          "operating_authority": 33333,
          "log_at": "2021-06-02 12:00:00",
          "updated_at": "2022-06-03 12:00:00"
        }
      ]
    },

    {
      "label": "multiple carrier updates pick vehicle at each update",
      "parameters": {
        "start_date": "'2021-06-01'",
        "end_date": "'2021-06-04'",
        "pipeline_execution_time": "'2022-06-03 12:00:00'"
      },
      "input_data": {
        "compliancedb_shards.driver_carrier_entries": [
          {
            "uuid": "00000000000000000000000000000004",
            "org_id": 1,
            "driver_id": 40,
            "dot_number": 44444,
            "log_at_ms": 1622541600000,
            "created_at_ms": 1622505600000
          },
          {
            "uuid": "00000000000000000000000000000005",
            "org_id": 1,
            "driver_id": 40,
            "dot_number": 55555,
            "log_at_ms": 1622714400000,
            "created_at_ms": 1622678400000
          }
        ],
        "compliancedb_shards.driver_hos_vehicle_assignments": [
          {
            "id": 4,
            "org_id": 1,
            "driver_id": 40,
            "vehicle_id": 110,
            "start_at": "2021-05-30 00:00:00",
            "end_at": "2021-06-01 12:30:00",
            "is_passenger": 0,
            "session_uuid": "sess-4"
          },
          {
            "id": 5,
            "org_id": 1,
            "driver_id": 40,
            "vehicle_id": 111,
            "start_at": "2021-06-01 12:30:00",
            "end_at": null,
            "is_passenger": 0,
            "session_uuid": "sess-5"
          }
        ]
      },
      "expected_data": [
        {
          "date": "2021-06-01",
          "org_id": 1,
          "driver_id": 40,
          "vehicle_id": 110,
          "operating_authority": 44444,
          "log_at": "2021-06-01 10:00:00",
          "updated_at": "2022-06-03 12:00:00"
        },
        {
          "date": "2021-06-03",
          "org_id": 1,
          "driver_id": 40,
          "vehicle_id": 111,
          "operating_authority": 55555,
          "log_at": "2021-06-03 10:00:00",
          "updated_at": "2022-06-03 12:00:00"
        }
      ]
    }
  ]
}

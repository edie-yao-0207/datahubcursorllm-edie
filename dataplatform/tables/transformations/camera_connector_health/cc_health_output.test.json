{
  "test_cases": [
    {
      "label": "if < 10 hours total trip time, only s1 populated and matches overall",
      "parameters": {
        "end_date": " '2021-11-01' "
      },
      "input_data": {
        "productsdb.devices": [
          {
            "org_id": 10,
            "id": 100,
            "product_id": 24,
            "camera_serial": "ran-domSeri-al",
            "camera_first_connected_at_ms": 1635552000005
          }
        ],
        "productsdb.gateways": [
          {
            "org_id": 10,
            "device_id": 101,
            "product_id": 43,
            "serial": "random-Serial"
          }
        ],
        "camera_connector_health.combined_connected_and_recording_durations": [
          {
            "cm_id": 101,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000015,
            "vg_id": 100
          }
        ],
        "camera_connector_health.cc_reversing_and_recording_durations": [
          {
            "date": "2021-10-30",
            "org_id": 10,
            "reversing_start_ms": 1635552000015,
            "reversing_duration_ms": 5,
            "recording_per_reversing_ms": 5,
            "vg_id": 100
          }
        ]
      },
      "expected_data": [
        {
          "cm_id": 101,
          "connector_attribute": 2,
          "date": "2021-10-31",
          "org_id": 10,
          "overall_connected_ms": 5,
          "overall_connected_uptime_pct": 1.0,
          "overall_end_ms": 1635552000020,
          "overall_recording_ms": 5,
          "overall_recording_per_reversing_ms": 5,
          "overall_recording_uptime_pct": 1.0,
          "overall_reversing_ms": 5,
          "overall_start_ms": 1635552000015,
          "overall_trip_ms": 5,
          "s1_connected_ms": 5,
          "s1_end_ms": 1635552000020,
          "s1_recording_ms": 5,
          "s1_recording_per_reversing_ms": 5,
          "s1_recording_uptime_pct": 1.0,
          "s1_reversing_ms": 5,
          "s1_start_ms": 1635552000015,
          "s1_trip_ms": 5,
          "s2_connected_ms": 0,
          "s2_end_ms": 0,
          "s2_recording_ms": 0,
          "s2_recording_per_reversing_ms": 0,
          "s2_recording_uptime_pct": 0,
          "s2_reversing_ms": 0,
          "s2_start_ms": 0,
          "s2_trip_ms": 0,
          "s3_connected_ms": 0,
          "s3_end_ms": 0,
          "s3_recording_ms": 0,
          "s3_recording_per_reversing_ms": 0,
          "s3_recording_uptime_pct": 0,
          "s3_reversing_ms": 0,
          "s3_start_ms": 0,
          "s3_trip_ms": 0,
          "s4_connected_ms": 0,
          "s4_end_ms": 0,
          "s4_recording_ms": 0,
          "s4_recording_per_reversing_ms": 0,
          "s4_recording_uptime_pct": 0,
          "s4_reversing_ms": 0,
          "s4_start_ms": 0,
          "s4_trip_ms": 0,
          "s5_connected_ms": 0,
          "s5_end_ms": 0,
          "s5_recording_ms": 0,
          "s5_recording_per_reversing_ms": 0,
          "s5_recording_uptime_pct": 0,
          "s5_reversing_ms": 0,
          "s5_start_ms": 0,
          "s5_trip_ms": 0,
          "vg_id": 100
        }
      ]
    },
    {
      "label": "if 10-20 trip time are included, only s1 and s2 will be populated",
      "parameters": {
        "end_date": " '2021-11-01' "
      },
      "input_data": {
        "productsdb.devices": [
          {
            "org_id": 10,
            "id": 100,
            "product_id": 24,
            "camera_serial": "ran-domSeri-al",
            "camera_first_connected_at_ms": 1635552000005
          }
        ],
        "productsdb.gateways": [
          {
            "org_id": 10,
            "device_id": 101,
            "product_id": 43,
            "serial": "random-Serial"
          }
        ],
        "camera_connector_health.combined_connected_and_recording_durations": [
          {
            "cm_id": 101,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000015,
            "vg_id": 100
          },
          {
            "cm_id": 101,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000025,
            "vg_id": 100
          },
          {
            "cm_id": 101,
            "connected_ms": 36000000,
            "date": "2021-10-29",
            "org_id": 10,
            "recording_ms": 36000000,
            "trip_duration_ms": 36000000,
            "trip_start_ms": 1635465600015,
            "vg_id": 100
          }
        ],
        "camera_connector_health.cc_reversing_and_recording_durations": []
      },
      "expected_data": [
        {
          "cm_id": 101,
          "connector_attribute": 1,
          "date": "2021-10-31",
          "org_id": 10,
          "overall_connected_ms": 36000010,
          "overall_connected_uptime_pct": 1.0,
          "overall_end_ms": 1635552000030,
          "overall_recording_ms": 36000010,
          "overall_recording_per_reversing_ms": 0,
          "overall_recording_uptime_pct": 1.0,
          "overall_reversing_ms": 0,
          "overall_start_ms": 1635465600015,
          "overall_trip_ms": 36000010,
          "s1_connected_ms": 10,
          "s1_end_ms": 1635552000030,
          "s1_recording_ms": 10,
          "s1_recording_per_reversing_ms": 0,
          "s1_recording_uptime_pct": 1.0,
          "s1_reversing_ms": 0,
          "s1_start_ms": 1635552000015,
          "s1_trip_ms": 10,
          "s2_connected_ms": 36000000,
          "s2_end_ms": 1635501600015,
          "s2_recording_ms": 36000000,
          "s2_recording_per_reversing_ms": 0,
          "s2_recording_uptime_pct": 1.0,
          "s2_reversing_ms": 0,
          "s2_start_ms": 1635465600015,
          "s2_trip_ms": 36000000,
          "s3_connected_ms": 0,
          "s3_end_ms": 0,
          "s3_recording_ms": 0,
          "s3_recording_per_reversing_ms": 0,
          "s3_recording_uptime_pct": 0.0,
          "s3_reversing_ms": 0,
          "s3_start_ms": 0,
          "s3_trip_ms": 0,
          "s4_connected_ms": 0,
          "s4_end_ms": 0,
          "s4_recording_ms": 0,
          "s4_recording_per_reversing_ms": 0,
          "s4_recording_uptime_pct": 0.0,
          "s4_reversing_ms": 0,
          "s4_start_ms": 0,
          "s4_trip_ms": 0,
          "s5_connected_ms": 0,
          "s5_end_ms": 0,
          "s5_recording_ms": 0,
          "s5_recording_per_reversing_ms": 0,
          "s5_recording_uptime_pct": 0.0,
          "s5_reversing_ms": 0,
          "s5_start_ms": 0,
          "s5_trip_ms": 0,
          "vg_id": 100
        }
      ]
    },
    {
      "label": "if any reversing intervals, connector attribute is 2, and only reversing while recording intervals are used",
      "parameters": {
        "end_date": " '2021-11-01' "
      },
      "input_data": {
        "productsdb.devices": [
          {
            "org_id": 10,
            "id": 100,
            "product_id": 24,
            "camera_serial": "ran-domSeri-al",
            "camera_first_connected_at_ms": 1635552000005
          }
        ],
        "productsdb.gateways": [
          {
            "org_id": 10,
            "device_id": 101,
            "product_id": 43,
            "serial": "random-Serial"
          }
        ],
        "camera_connector_health.combined_connected_and_recording_durations": [
          {
            "cm_id": 101,
            "connected_ms": 27000000,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 18000000,
            "trip_duration_ms": 36000000,
            "trip_start_ms": 1635552000015,
            "vg_id": 100
          },
          {
            "cm_id": 101,
            "connected_ms": 27000000,
            "date": "2021-10-29",
            "org_id": 10,
            "recording_ms": 18000000,
            "trip_duration_ms": 36000000,
            "trip_start_ms": 1635516000025,
            "vg_id": 100
          }
        ],
        "camera_connector_health.cc_reversing_and_recording_durations": [
          {
            "date": "2021-10-30",
            "org_id": 10,
            "reversing_start_ms": 1635552000015,
            "reversing_duration_ms": 10,
            "recording_per_reversing_ms": 8,
            "vg_id": 100
          }
        ]
      },
      "expected_data": [
        {
          "cm_id": 101,
          "connector_attribute": 2,
          "date": "2021-10-31",
          "org_id": 10,
          "overall_connected_ms": 54000000,
          "overall_connected_uptime_pct": 0.75,
          "overall_end_ms": 1635588000015,
          "overall_recording_ms": 36000000,
          "overall_recording_per_reversing_ms": 8,
          "overall_recording_uptime_pct": 0.8,
          "overall_reversing_ms": 10,
          "overall_start_ms": 1635516000025,
          "overall_trip_ms": 72000000,
          "s1_connected_ms": 27000000,
          "s1_end_ms": 1635588000015,
          "s1_recording_ms": 18000000,
          "s1_recording_per_reversing_ms": 8,
          "s1_recording_uptime_pct": 0.8,
          "s1_reversing_ms": 10,
          "s1_start_ms": 1635552000015,
          "s1_trip_ms": 36000000,
          "s2_connected_ms": 27000000,
          "s2_end_ms": 1635552000025,
          "s2_recording_ms": 18000000,
          "s2_recording_per_reversing_ms": 8,
          "s2_recording_uptime_pct": 0.8,
          "s2_reversing_ms": 10,
          "s2_start_ms": 1635516000025,
          "s2_trip_ms": 36000000,
          "s3_connected_ms": 0,
          "s3_end_ms": 0,
          "s3_recording_ms": 0,
          "s3_recording_per_reversing_ms": 0,
          "s3_recording_uptime_pct": 0.0,
          "s3_reversing_ms": 0,
          "s3_start_ms": 0,
          "s3_trip_ms": 0,
          "s4_connected_ms": 0,
          "s4_end_ms": 0,
          "s4_recording_ms": 0,
          "s4_recording_per_reversing_ms": 0,
          "s4_recording_uptime_pct": 0.0,
          "s4_reversing_ms": 0,
          "s4_start_ms": 0,
          "s4_trip_ms": 0,
          "s5_connected_ms": 0,
          "s5_end_ms": 0,
          "s5_recording_ms": 0,
          "s5_recording_per_reversing_ms": 0,
          "s5_recording_uptime_pct": 0.0,
          "s5_reversing_ms": 0,
          "s5_start_ms": 0,
          "s5_trip_ms": 0,
          "vg_id": 100
        }
      ]
    },
    {
      "label": "any trips beyond 50 hours of aggregated trip time are excluded",
      "parameters": {
        "end_date": " '2021-11-01' "
      },
      "input_data": {
        "productsdb.devices": [
          {
            "org_id": 10,
            "id": 100,
            "product_id": 24,
            "camera_serial": "ran-domSeri-al",
            "camera_first_connected_at_ms": 1635552000005
          }
        ],
        "productsdb.gateways": [
          {
            "org_id": 10,
            "device_id": 101,
            "product_id": 43,
            "serial": "random-Serial"
          }
        ],
        "camera_connector_health.combined_connected_and_recording_durations": [
          {
            "cm_id": 101,
            "connected_ms": 7200000,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 7200000,
            "trip_duration_ms": 36000000,
            "trip_start_ms": 1635552000015,
            "vg_id": 100
          },
          {
            "cm_id": 101,
            "connected_ms": 14400000,
            "date": "2021-10-29",
            "org_id": 10,
            "recording_ms": 14400000,
            "trip_duration_ms": 36000000,
            "trip_start_ms": 1635516000025,
            "vg_id": 100
          },
          {
            "cm_id": 101,
            "connected_ms": 21600000,
            "date": "2021-10-28",
            "org_id": 10,
            "recording_ms": 21600000,
            "trip_duration_ms": 36000000,
            "trip_start_ms": 1635379200030,
            "vg_id": 100
          },
          {
            "cm_id": 101,
            "connected_ms": 28800000,
            "date": "2021-10-27",
            "org_id": 10,
            "recording_ms": 28800000,
            "trip_duration_ms": 36000000,
            "trip_start_ms": 1635292800035,
            "vg_id": 100
          },
          {
            "cm_id": 101,
            "connected_ms": 36000000,
            "date": "2021-10-26",
            "org_id": 10,
            "recording_ms": 36000000,
            "trip_duration_ms": 36000000,
            "trip_start_ms": 1635206400040,
            "vg_id": 100
          },
          {
            "cm_id": 101,
            "connected_ms": 0,
            "date": "2021-10-25",
            "org_id": 10,
            "recording_ms": 0,
            "trip_duration_ms": 36000000,
            "trip_start_ms": 1635120000045,
            "vg_id": 100
          }
        ],
        "camera_connector_health.cc_reversing_and_recording_durations": []
      },
      "expected_data": [
        {
          "cm_id": 101,
          "connector_attribute": 1,
          "date": "2021-10-31",
          "org_id": 10,
          "overall_connected_ms": 108000000,
          "overall_connected_uptime_pct": 0.6,
          "overall_end_ms": 1635588000015,
          "overall_recording_ms": 108000000,
          "overall_recording_per_reversing_ms": 0,
          "overall_recording_uptime_pct": 1.0,
          "overall_reversing_ms": 0,
          "overall_start_ms": 1635206400040,
          "overall_trip_ms": 180000000,
          "s1_connected_ms": 7200000,
          "s1_end_ms": 1635588000015,
          "s1_recording_ms": 7200000,
          "s1_recording_per_reversing_ms": 0,
          "s1_recording_uptime_pct": 1.0,
          "s1_reversing_ms": 0,
          "s1_start_ms": 1635552000015,
          "s1_trip_ms": 36000000,
          "s2_connected_ms": 14400000,
          "s2_end_ms": 1635552000025,
          "s2_recording_ms": 14400000,
          "s2_recording_per_reversing_ms": 0,
          "s2_recording_uptime_pct": 1.0,
          "s2_reversing_ms": 0,
          "s2_start_ms": 1635516000025,
          "s2_trip_ms": 36000000,
          "s3_connected_ms": 21600000,
          "s3_end_ms": 1635415200030,
          "s3_recording_ms": 21600000,
          "s3_recording_per_reversing_ms": 0,
          "s3_recording_uptime_pct": 1.0,
          "s3_reversing_ms": 0,
          "s3_start_ms": 1635379200030,
          "s3_trip_ms": 36000000,
          "s4_connected_ms": 28800000,
          "s4_end_ms": 1635328800035,
          "s4_recording_ms": 28800000,
          "s4_recording_per_reversing_ms": 0,
          "s4_recording_uptime_pct": 1.0,
          "s4_reversing_ms": 0,
          "s4_start_ms": 1635292800035,
          "s4_trip_ms": 36000000,
          "s5_connected_ms": 36000000,
          "s5_end_ms": 1635242400040,
          "s5_recording_ms": 36000000,
          "s5_recording_per_reversing_ms": 0,
          "s5_recording_uptime_pct": 1.0,
          "s5_reversing_ms": 0,
          "s5_start_ms": 1635206400040,
          "s5_trip_ms": 36000000,
          "vg_id": 100
        }
      ]
    },
    {
      "label": "if VG swapped between two CMs, we only include the most recent CM",
      "parameters": {
        "end_date": " '2021-11-01' "
      },
      "input_data": {
        "productsdb.devices": [
          {
            "org_id": 10,
            "id": 100,
            "product_id": 24,
            "camera_serial": "cur-rentSeri-al",
            "camera_first_connected_at_ms": 1635552000020
          }
        ],
        "productsdb.gateways": [
          {
            "org_id": 10,
            "device_id": 101,
            "product_id": 43,
            "serial": "random-Serial"
          },
          {
            "org_id": 10,
            "device_id": 102,
            "product_id": 43,
            "serial": "current-Serial"
          }
        ],
        "camera_connector_health.combined_connected_and_recording_durations": [
          {
            "cm_id": 101,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000015,
            "vg_id": 100
          },
          {
            "cm_id": 102,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000025,
            "vg_id": 100
          }
        ],
        "camera_connector_health.cc_reversing_and_recording_durations": []
      },
      "expected_data": [
        {
          "cm_id": 102,
          "connector_attribute": 1,
          "date": "2021-10-31",
          "org_id": 10,
          "overall_connected_ms": 5,
          "overall_connected_uptime_pct": 1.0,
          "overall_end_ms": 1635552000030,
          "overall_recording_ms": 5,
          "overall_recording_per_reversing_ms": 0,
          "overall_recording_uptime_pct": 1.0,
          "overall_reversing_ms": 0,
          "overall_start_ms": 1635552000025,
          "overall_trip_ms": 5,
          "s1_connected_ms": 5,
          "s1_end_ms": 1635552000030,
          "s1_recording_ms": 5,
          "s1_recording_per_reversing_ms": 0,
          "s1_recording_uptime_pct": 1.0,
          "s1_reversing_ms": 0,
          "s1_start_ms": 1635552000025,
          "s1_trip_ms": 5,
          "s2_connected_ms": 0,
          "s2_end_ms": 0,
          "s2_recording_ms": 0,
          "s2_recording_per_reversing_ms": 0,
          "s2_recording_uptime_pct": 0.0,
          "s2_reversing_ms": 0,
          "s2_start_ms": 0,
          "s2_trip_ms": 0,
          "s3_connected_ms": 0,
          "s3_end_ms": 0,
          "s3_recording_ms": 0,
          "s3_recording_per_reversing_ms": 0,
          "s3_recording_uptime_pct": 0.0,
          "s3_reversing_ms": 0,
          "s3_start_ms": 0,
          "s3_trip_ms": 0,
          "s4_connected_ms": 0,
          "s4_end_ms": 0,
          "s4_recording_ms": 0,
          "s4_recording_per_reversing_ms": 0,
          "s4_recording_uptime_pct": 0.0,
          "s4_reversing_ms": 0,
          "s4_start_ms": 0,
          "s4_trip_ms": 0,
          "s5_connected_ms": 0,
          "s5_end_ms": 0,
          "s5_recording_ms": 0,
          "s5_recording_per_reversing_ms": 0,
          "s5_recording_uptime_pct": 0.0,
          "s5_reversing_ms": 0,
          "s5_start_ms": 0,
          "s5_trip_ms": 0,
          "vg_id": 100
        }
      ]
    },
    {
      "label": "if no CM is attached to VG, output includes a cm_id of 0",
      "parameters": {
        "end_date": " '2021-11-01' "
      },
      "input_data": {
        "productsdb.devices": [
          {
            "org_id": 10,
            "id": 100,
            "product_id": 24,
            "camera_serial": "",
            "camera_first_connected_at_ms": 1635552000020
          }
        ],
        "productsdb.gateways": [],
        "camera_connector_health.combined_connected_and_recording_durations": [
          {
            "cm_id": null,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000025,
            "vg_id": 100
          }
        ],
        "camera_connector_health.cc_reversing_and_recording_durations": []
      },
      "expected_data": [
        {
          "cm_id": 0,
          "connector_attribute": 1,
          "date": "2021-10-31",
          "org_id": 10,
          "overall_connected_ms": 5,
          "overall_connected_uptime_pct": 1.0,
          "overall_end_ms": 1635552000030,
          "overall_recording_ms": 5,
          "overall_recording_per_reversing_ms": 0,
          "overall_recording_uptime_pct": 1.0,
          "overall_reversing_ms": 0,
          "overall_start_ms": 1635552000025,
          "overall_trip_ms": 5,
          "s1_connected_ms": 5,
          "s1_end_ms": 1635552000030,
          "s1_recording_ms": 5,
          "s1_recording_per_reversing_ms": 0,
          "s1_recording_uptime_pct": 1.0,
          "s1_reversing_ms": 0,
          "s1_start_ms": 1635552000025,
          "s1_trip_ms": 5,
          "s2_connected_ms": 0,
          "s2_end_ms": 0,
          "s2_recording_ms": 0,
          "s2_recording_per_reversing_ms": 0,
          "s2_recording_uptime_pct": 0.0,
          "s2_reversing_ms": 0,
          "s2_start_ms": 0,
          "s2_trip_ms": 0,
          "s3_connected_ms": 0,
          "s3_end_ms": 0,
          "s3_recording_ms": 0,
          "s3_recording_per_reversing_ms": 0,
          "s3_recording_uptime_pct": 0.0,
          "s3_reversing_ms": 0,
          "s3_start_ms": 0,
          "s3_trip_ms": 0,
          "s4_connected_ms": 0,
          "s4_end_ms": 0,
          "s4_recording_ms": 0,
          "s4_recording_per_reversing_ms": 0,
          "s4_recording_uptime_pct": 0.0,
          "s4_reversing_ms": 0,
          "s4_start_ms": 0,
          "s4_trip_ms": 0,
          "s5_connected_ms": 0,
          "s5_end_ms": 0,
          "s5_recording_ms": 0,
          "s5_recording_per_reversing_ms": 0,
          "s5_recording_uptime_pct": 0.0,
          "s5_reversing_ms": 0,
          "s5_start_ms": 0,
          "s5_trip_ms": 0,
          "vg_id": 100
        }
      ]
    }
  ]
}

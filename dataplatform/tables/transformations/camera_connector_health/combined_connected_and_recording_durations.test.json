{
  "test_cases": [
    {
      "label": "combines Auxcam and Baxter connected and recording intervals",
      "parameters": {
        "start_date": " '2021-10-26' ",
        "end_date": " '2021-11-01' ",
        "pipeline_execution_time": " '2021-11-02 12:00:00' "
      },
      "input_data": {
        "deviceassociationsdb_shards.device_collection_associations": [
          {
            "org_id": 10,
            "device_id": 101,
            "product_id": 126,
            "collection_uuid": "123",
            "end_at": null
          },
          {
            "org_id": 10,
            "device_id": 100,
            "product_id": 24,
            "collection_uuid": "123",
            "end_at": null
          }
        ],
        "productsdb.devices": [
          {
            "org_id": 10,
            "id": 100,
            "product_id": 24,
            "camera_serial": "das-camSeri-al",
            "camera_first_connected_at_ms": 1635552000005
          },
          {
            "org_id": 10,
            "id": 102,
            "product_id": 24,
            "camera_serial": "ran-domSeri-al",
            "camera_first_connected_at_ms": 1635552000005
          }
        ],
        "productsdb.gateways": [
          {
            "org_id": 10,
            "device_id": 103,
            "product_id": 43,
            "serial": "random-Serial"
          },
          {
            "org_id": 10,
            "device_id": 101,
            "product_id": 43,
            "serial": "dascam-Serial"
          }
        ],
        "camera_connector_health.cc_connected_and_recording_durations": [
          {
            "cm_id": 103,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000015,
            "vg_id": 102
          }
        ],
        "camera_connector_health.auxcam_connected_and_recording_durations": [
          {
            "auxcam_id": 101,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000015,
            "vg_id": 100
          }
        ]
      },
      "expected_data": [
        {
          "cm_id": 101,
          "connected_ms": 5,
          "date": "2021-10-30",
          "org_id": 10,
          "recording_ms": 5,
          "trip_duration_ms": 5,
          "trip_start_ms": 1635552000015,
          "vg_id": 100
        },
        {
          "cm_id": 103,
          "connected_ms": 5,
          "date": "2021-10-30",
          "org_id": 10,
          "recording_ms": 5,
          "trip_duration_ms": 5,
          "trip_start_ms": 1635552000015,
          "vg_id": 102
        }
      ]
    },
    {
      "label": "populates Auxcam data even when no cm_id is found",
      "parameters": {
        "start_date": " '2021-10-26' ",
        "end_date": " '2021-11-01' ",
        "pipeline_execution_time": " '2021-11-02 12:00:00' "
      },
      "input_data": {
        "deviceassociationsdb_shards.device_collection_associations": [
          {
            "org_id": 10,
            "device_id": 101,
            "product_id": 126,
            "collection_uuid": "123",
            "end_at": null
          },
          {
            "org_id": 10,
            "device_id": 100,
            "product_id": 24,
            "collection_uuid": "123",
            "end_at": null
          }
        ],
        "productsdb.devices": [
          {
            "org_id": 10,
            "id": 102,
            "product_id": 24,
            "camera_serial": "ran-domSeri-al",
            "camera_first_connected_at_ms": 1635552000005
          }
        ],
        "productsdb.gateways": [
          {
            "org_id": 10,
            "device_id": 103,
            "product_id": 43,
            "serial": "random-Serial"
          }
        ],
        "camera_connector_health.cc_connected_and_recording_durations": [
          {
            "cm_id": 103,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000015,
            "vg_id": 102
          }
        ],
        "camera_connector_health.auxcam_connected_and_recording_durations": [
          {
            "auxcam_id": 101,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000015,
            "vg_id": 100
          }
        ]
      },
      "expected_data": [
        {
          "cm_id": null,
          "connected_ms": 5,
          "date": "2021-10-30",
          "org_id": 10,
          "recording_ms": 5,
          "trip_duration_ms": 5,
          "trip_start_ms": 1635552000015,
          "vg_id": 100
        },
        {
          "cm_id": 103,
          "connected_ms": 5,
          "date": "2021-10-30",
          "org_id": 10,
          "recording_ms": 5,
          "trip_duration_ms": 5,
          "trip_start_ms": 1635552000015,
          "vg_id": 102
        }
      ]
    },
    {
      "label": "if device has both Auxcam and Baxter data and is currently associated with Auxcam, use only Auxcam data",
      "parameters": {
        "start_date": " '2021-10-26' ",
        "end_date": " '2021-11-01' ",
        "pipeline_execution_time": " '2021-11-02 12:00:00' "
      },
      "input_data": {
        "deviceassociationsdb_shards.device_collection_associations": [
          {
            "org_id": 10,
            "device_id": 101,
            "product_id": 126,
            "collection_uuid": "123",
            "end_at": null
          },
          {
            "org_id": 10,
            "device_id": 100,
            "product_id": 24,
            "collection_uuid": "123",
            "end_at": null
          }
        ],
        "productsdb.devices": [
          {
            "org_id": 10,
            "id": 100,
            "product_id": 24,
            "camera_serial": "das-camSeri-al",
            "camera_first_connected_at_ms": 1635552000005
          }
        ],
        "productsdb.gateways": [
          {
            "org_id": 10,
            "device_id": 102,
            "product_id": 43,
            "serial": "dascam-Serial"
          }
        ],
        "camera_connector_health.cc_connected_and_recording_durations": [
          {
            "cm_id": 102,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000015,
            "vg_id": 100
          }
        ],
        "camera_connector_health.auxcam_connected_and_recording_durations": [
          {
            "auxcam_id": 101,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000030,
            "vg_id": 100
          }
        ]
      },
      "expected_data": [
        {
          "cm_id": 102,
          "connected_ms": 5,
          "date": "2021-10-30",
          "org_id": 10,
          "recording_ms": 5,
          "trip_duration_ms": 5,
          "trip_start_ms": 1635552000030,
          "vg_id": 100
        }
      ]
    },
    {
      "label": "if device has both Auxcam and Baxter data and is not currently associated with Auxcam, use only Baxter data",
      "parameters": {
        "start_date": " '2021-10-26' ",
        "end_date": " '2021-11-01' ",
        "pipeline_execution_time": " '2021-10-30 17:00:00' "
      },
      "input_data": {
        "deviceassociationsdb_shards.device_collection_associations": [
          {
            "org_id": 10,
            "device_id": 101,
            "product_id": 126,
            "collection_uuid": "123",
            "end_at": "2021-11-02 12:00:00"
          },
          {
            "org_id": 10,
            "device_id": 100,
            "product_id": 24,
            "collection_uuid": "123",
            "end_at": "2021-11-02 12:00:00"
          }
        ],
        "productsdb.devices": [
          {
            "org_id": 10,
            "id": 100,
            "product_id": 24,
            "camera_serial": "das-camSeri-al",
            "camera_first_connected_at_ms": 1635552000005
          }
        ],
        "productsdb.gateways": [
          {
            "org_id": 10,
            "device_id": 102,
            "product_id": 43,
            "serial": "dascam-Serial"
          }
        ],
        "camera_connector_health.cc_connected_and_recording_durations": [
          {
            "cm_id": 102,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000015,
            "vg_id": 100
          }
        ],
        "camera_connector_health.auxcam_connected_and_recording_durations": [
          {
            "auxcam_id": 101,
            "connected_ms": 5,
            "date": "2021-10-30",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635552000030,
            "vg_id": 100
          }
        ]
      },
      "expected_data": [
        {
          "cm_id": 102,
          "connected_ms": 5,
          "date": "2021-10-30",
          "org_id": 10,
          "recording_ms": 5,
          "trip_duration_ms": 5,
          "trip_start_ms": 1635552000015,
          "vg_id": 100
        }
      ]
    },
    {
      "label": "rounds date of Auxcam and Baxter data within past month of end_date",
      "parameters": {
        "start_date": " '2021-10-26' ",
        "end_date": " '2021-11-01' ",
        "pipeline_execution_time": " '2021-11-02 12:00:00' "
      },
      "input_data": {
        "deviceassociationsdb_shards.device_collection_associations": [
          {
            "org_id": 10,
            "device_id": 101,
            "product_id": 126,
            "collection_uuid": "123",
            "end_at": null
          },
          {
            "org_id": 10,
            "device_id": 100,
            "product_id": 24,
            "collection_uuid": "123",
            "end_at": null
          }
        ],
        "productsdb.devices": [
          {
            "org_id": 10,
            "id": 100,
            "product_id": 24,
            "camera_serial": "das-camSeri-al",
            "camera_first_connected_at_ms": 1635552000005
          },
          {
            "org_id": 10,
            "id": 102,
            "product_id": 24,
            "camera_serial": "ran-domSeri-al",
            "camera_first_connected_at_ms": 1635552000005
          }
        ],
        "productsdb.gateways": [
          {
            "org_id": 10,
            "device_id": 103,
            "product_id": 43,
            "serial": "random-Serial"
          },
          {
            "org_id": 10,
            "device_id": 104,
            "product_id": 43,
            "serial": "dascam-Serial"
          }
        ],
        "camera_connector_health.cc_connected_and_recording_durations": [
          {
            "cm_id": 103,
            "connected_ms": 5,
            "date": "2021-10-02",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1633197600005,
            "vg_id": 102
          },
          {
            "cm_id": 103,
            "connected_ms": 5,
            "date": "2022-11-02",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635876000025,
            "vg_id": 102
          }
        ],
        "camera_connector_health.auxcam_connected_and_recording_durations": [
          {
            "auxcam_id": 101,
            "connected_ms": 5,
            "date": "2021-10-02",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1633197600005,
            "vg_id": 100
          },
          {
            "auxcam_id": 101,
            "connected_ms": 5,
            "date": "2022-11-02",
            "org_id": 10,
            "recording_ms": 5,
            "trip_duration_ms": 5,
            "trip_start_ms": 1635876000025,
            "vg_id": 100
          }
        ]
      },
      "expected_data": [
        {
          "cm_id": 104,
          "connected_ms": 5,
          "date": "2021-10-26",
          "org_id": 10,
          "recording_ms": 5,
          "trip_duration_ms": 5,
          "trip_start_ms": 1633197600005,
          "vg_id": 100
        },
        {
          "cm_id": 103,
          "connected_ms": 5,
          "date": "2021-10-26",
          "org_id": 10,
          "recording_ms": 5,
          "trip_duration_ms": 5,
          "trip_start_ms": 1633197600005,
          "vg_id": 102
        },
        {
          "cm_id": 104,
          "connected_ms": 5,
          "date": "2021-11-01",
          "org_id": 10,
          "recording_ms": 5,
          "trip_duration_ms": 5,
          "trip_start_ms": 1635876000025,
          "vg_id": 100
        },
        {
          "cm_id": 103,
          "connected_ms": 5,
          "date": "2021-11-01",
          "org_id": 10,
          "recording_ms": 5,
          "trip_duration_ms": 5,
          "trip_start_ms": 1635876000025,
          "vg_id": 102
        }
      ]
    }
  ]
}

{
  "test_cases": [
    {
      "label": "only data in the [start_date, end_date) interval is included",
      "parameters": {
        "start_date": " '2021-10-26' ",
        "end_date": " '2021-11-01' ",
        "pipeline_execution_time": " '2021-11-02 12:00:00' "
      },
      "input_data": {
        "attributedb_shards.attribute_values": [
          {
            "org_id": 10,
            "uuid": "R3V3R53_0N17",
            "string_value": "Reverse Only"
          }
        ],
        "attributedb_shards.attribute_cloud_entities": [
          {
            "entity_id": 100,
            "attribute_value_id": "R3V3R53_0N17"
          }
        ],
        "kinesisstats.osdobdcableid": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "int_value": 7,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "kinesisstats.osdcanbustype": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "proto_value": {
                "can_bus_info": {
                  "can_bus_type_enum": 28
                }
              },
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "camera_connector_health.cc_recording_intervals": [
          {
            "vg_id": 100,
            "start_ms": 1635552005000,
            "end_ms": 1635465610000
          },
          {
            "vg_id": 100,
            "start_ms": 1635552015000,
            "end_ms": 1635552020000
          }
        ],
        "kinesisstats.osdvehiclecurrentgear": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552005000,
            "value": {
              "int_value": -1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-09-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "int_value": 1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552015000,
            "value": {
              "int_value": -1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552020000,
            "value": {
              "int_value": 1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1641081625000,
            "value": {
              "int_value": -1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2022-01-02"
          }
        ]
      },
      "expected_data": [
        {
          "date": "2021-10-30",
          "org_id": 10,
          "reversing_start_ms": 1635552015000,
          "reversing_duration_ms": 5000,
          "recording_per_reversing_ms": 5000,
          "vg_id": 100
        }
      ]
    },
    {
      "label": "only recording intervals within reversing intervals are included",
      "parameters": {
        "start_date": " '2021-10-26' ",
        "end_date": " '2021-11-01' ",
        "pipeline_execution_time": " '2021-11-02 12:00:00' "
      },
      "input_data": {
        "attributedb_shards.attribute_values": [
          {
            "org_id": 10,
            "uuid": "R3V3R53_0N17",
            "string_value": "Reverse Only"
          }
        ],
        "attributedb_shards.attribute_cloud_entities": [
          {
            "entity_id": 100,
            "attribute_value_id": "R3V3R53_0N17"
          }
        ],
        "kinesisstats.osdobdcableid": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "int_value": 7,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "kinesisstats.osdcanbustype": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "proto_value": {
                "can_bus_info": {
                  "can_bus_type_enum": 28
                }
              },
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "camera_connector_health.cc_recording_intervals": [
          {
            "vg_id": 100,
            "start_ms": 1635552014000,
            "end_ms": 1635552016000
          },
          {
            "vg_id": 100,
            "start_ms": 1635552018000,
            "end_ms": 1635552022000
          }
        ],
        "kinesisstats.osdvehiclecurrentgear": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552015000,
            "value": {
              "int_value": -1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552020000,
            "value": {
              "int_value": 1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          }
        ]
      },
      "expected_data": [
        {
          "date": "2021-10-30",
          "org_id": 10,
          "reversing_start_ms": 1635552015000,
          "reversing_duration_ms": 5000,
          "recording_per_reversing_ms": 3000,
          "vg_id": 100
        }
      ]
    },
    {
      "label": "reversing intervals are included, but non-reversing intervals are not",
      "parameters": {
        "start_date": " '2021-10-26' ",
        "end_date": " '2021-11-01' ",
        "pipeline_execution_time": " '2021-11-02 12:00:00' "
      },
      "input_data": {
        "attributedb_shards.attribute_values": [
          {
            "org_id": 10,
            "uuid": "R3V3R53_0N17",
            "string_value": "Reverse Only"
          }
        ],
        "attributedb_shards.attribute_cloud_entities": [
          {
            "entity_id": 100,
            "attribute_value_id": "R3V3R53_0N17"
          }
        ],
        "kinesisstats.osdobdcableid": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "int_value": 7,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "kinesisstats.osdcanbustype": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "proto_value": {
                "can_bus_info": {
                  "can_bus_type_enum": 28
                }
              },
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "camera_connector_health.cc_recording_intervals": [
          {
            "vg_id": 100,
            "start_ms": 1635552005000,
            "end_ms": 1635552045000
          }
        ],
        "kinesisstats.osdvehiclecurrentgear": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552005000,
            "value": {
              "int_value": 2,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552010000,
            "value": {
              "int_value": 0,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552015000,
            "value": {
              "int_value": -1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552020000,
            "value": {
              "int_value": 1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552025000,
            "value": {
              "int_value": 3,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552030000,
            "value": {
              "int_value": 5,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552035000,
            "value": {
              "int_value": 0,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552040000,
            "value": {
              "int_value": 4,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          }
        ]
      },
      "expected_data": [
        {
          "date": "2021-10-30",
          "org_id": 10,
          "reversing_start_ms": 1635552015000,
          "reversing_duration_ms": 5000,
          "recording_per_reversing_ms": 5000,
          "vg_id": 100
        }
      ]
    },
    {
      "label": "vehicles with `ignition on` attributes are not included",
      "parameters": {
        "start_date": " '2021-10-26' ",
        "end_date": " '2021-11-01' ",
        "pipeline_execution_time": " '2021-11-02 12:00:00' "
      },
      "input_data": {
        "attributedb_shards.attribute_values": [
          {
            "org_id": 10,
            "uuid": "R3V3R53_0N17",
            "string_value": "Reverse Only"
          },
          {
            "org_id": 10,
            "uuid": "1GN1T10N_0N",
            "string_value": "Ignition On"
          }
        ],
        "attributedb_shards.attribute_cloud_entities": [
          {
            "entity_id": 100,
            "attribute_value_id": "1GN1T10N_0N"
          }
        ],
        "kinesisstats.osdobdcableid": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "int_value": 7,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "kinesisstats.osdcanbustype": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "proto_value": {
                "can_bus_info": {
                  "can_bus_type_enum": 28
                }
              },
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "camera_connector_health.cc_recording_intervals": [
          {
            "vg_id": 100,
            "start_ms": 1635552015000,
            "end_ms": 1635552020000
          }
        ],
        "kinesisstats.osdvehiclecurrentgear": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552015000,
            "value": {
              "int_value": -1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552020000,
            "value": {
              "int_value": 1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          }
        ]
      },
      "expected_data": []
    },
    {
      "label": "vehicles without J1939-compatible cables are not included",
      "parameters": {
        "start_date": " '2021-10-26' ",
        "end_date": " '2021-11-01' ",
        "pipeline_execution_time": " '2021-11-02 12:00:00' "
      },
      "input_data": {
        "attributedb_shards.attribute_values": [
          {
            "org_id": 10,
            "uuid": "R3V3R53_0N17",
            "string_value": "Reverse Only"
          },
          {
            "org_id": 10,
            "uuid": "1GN1T10N_0N",
            "string_value": "Ignition On"
          }
        ],
        "attributedb_shards.attribute_cloud_entities": [
          {
            "entity_id": 100,
            "attribute_value_id": "R3V3R53_0N17"
          }
        ],
        "kinesisstats.osdobdcableid": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "int_value": 11,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "kinesisstats.osdcanbustype": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "proto_value": {
                "can_bus_info": {
                  "can_bus_type_enum": 28
                }
              },
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "camera_connector_health.cc_recording_intervals": [
          {
            "vg_id": 100,
            "start_ms": 1635552015000,
            "end_ms": 1635552020000
          }
        ],
        "kinesisstats.osdvehiclecurrentgear": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552015000,
            "value": {
              "int_value": -1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552020000,
            "value": {
              "int_value": 1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          }
        ]
      },
      "expected_data": []
    },
    {
      "label": "vehicles without J1939-compatible ports are not included",
      "parameters": {
        "start_date": " '2021-10-26' ",
        "end_date": " '2021-11-01' ",
        "pipeline_execution_time": " '2021-11-02 12:00:00' "
      },
      "input_data": {
        "attributedb_shards.attribute_values": [
          {
            "org_id": 10,
            "uuid": "R3V3R53_0N17",
            "string_value": "Reverse Only"
          },
          {
            "org_id": 10,
            "uuid": "1GN1T10N_0N",
            "string_value": "Ignition On"
          }
        ],
        "attributedb_shards.attribute_cloud_entities": [
          {
            "entity_id": 100,
            "attribute_value_id": "R3V3R53_0N17"
          }
        ],
        "kinesisstats.osdobdcableid": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "int_value": 7,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "kinesisstats.osdcanbustype": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "proto_value": {
                "can_bus_info": {
                  "can_bus_type_enum": 2
                }
              },
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "camera_connector_health.cc_recording_intervals": [
          {
            "vg_id": 100,
            "start_ms": 1635552015000,
            "end_ms": 1635552020000
          }
        ],
        "kinesisstats.osdvehiclecurrentgear": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552015000,
            "value": {
              "int_value": -1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552020000,
            "value": {
              "int_value": 1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          }
        ]
      },
      "expected_data": []
    },
    {
      "label": "will remove any intervals from the previous node of less than 1 second",
      "parameters": {
        "start_date": " '2021-10-26' ",
        "end_date": " '2021-11-01' ",
        "pipeline_execution_time": " '2021-11-02 12:00:00' "
      },
      "input_data": {
        "attributedb_shards.attribute_values": [
          {
            "org_id": 10,
            "uuid": "R3V3R53_0N17",
            "string_value": "Reverse Only"
          }
        ],
        "attributedb_shards.attribute_cloud_entities": [
          {
            "entity_id": 100,
            "attribute_value_id": "R3V3R53_0N17"
          }
        ],
        "kinesisstats.osdobdcableid": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "int_value": 7,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "kinesisstats.osdcanbustype": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "proto_value": {
                "can_bus_info": {
                  "can_bus_type_enum": 28
                }
              },
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          }
        ],
        "camera_connector_health.cc_recording_intervals": [
          {
            "vg_id": 100,
            "start_ms": 1635552005000,
            "end_ms": 1635465610000
          },
          {
            "vg_id": 100,
            "start_ms": 1635552015000,
            "end_ms": 1635552015050
          },
          {
            "vg_id": 100,
            "start_ms": 1635552015050,
            "end_ms": 1635552020000
          }
        ],
        "kinesisstats.osdvehiclecurrentgear": [
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552005000,
            "value": {
              "int_value": -1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-09-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635465610000,
            "value": {
              "int_value": 1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-29"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552015000,
            "value": {
              "int_value": -1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1635552020000,
            "value": {
              "int_value": 1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2021-10-30"
          },
          {
            "org_id": 10,
            "object_id": 100,
            "time": 1641081625000,
            "value": {
              "int_value": -1,
              "is_databreak": false,
              "is_end": false,
              "is_start": false
            },
            "date": "2022-01-02"
          }
        ]
      },
      "expected_data": [
        {
          "date": "2021-10-30",
          "org_id": 10,
          "reversing_start_ms": 1635552015000,
          "reversing_duration_ms": 5000,
          "recording_per_reversing_ms": 4950,
          "vg_id": 100
        }
      ]
    }
  ]
}

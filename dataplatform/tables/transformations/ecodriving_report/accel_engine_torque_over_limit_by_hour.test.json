{
  "test_cases": [
    {
      "label": "identify intervals for a single datapoint per hour",
      "parameters": {
        "start_date": " '2020-01-20' ",
        "end_date": " '2020-01-30' "
      },
      "input_data": {
        "objectstat_diffs.accel_engine_torque_over_limit": [
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579946400000,
            "accel_engine_torque_over_limit_ms": 5000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579950000000,
            "accel_engine_torque_over_limit_ms": 6000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 0,
          "interval_start": "2020-01-25 10:00:00",
          "interval_end": "2020-01-25 11:00:00",
          "accel_engine_torque_over_limit_ms": 5000
        },
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 0,
          "interval_start": "2020-01-25 11:00:00",
          "interval_end": "2020-01-25 12:00:00",
          "accel_engine_torque_over_limit_ms": 6000
        }
      ]
    },
    {
      "label": "identify intervals for multiple datapoints per hour",
      "parameters": {
        "start_date": " '2020-01-20' ",
        "end_date": " '2020-01-30' "
      },
      "input_data": {
        "objectstat_diffs.accel_engine_torque_over_limit": [
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579946400000,
            "accel_engine_torque_over_limit_ms": 5000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579948200000,
            "accel_engine_torque_over_limit_ms": 5000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579950000000,
            "accel_engine_torque_over_limit_ms": 6000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579951800000,
            "accel_engine_torque_over_limit_ms": 6000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 0,
          "interval_start": "2020-01-25 10:00:00",
          "interval_end": "2020-01-25 11:00:00",
          "accel_engine_torque_over_limit_ms": 10000
        },
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 0,
          "interval_start": "2020-01-25 11:00:00",
          "interval_end": "2020-01-25 12:00:00",
          "accel_engine_torque_over_limit_ms": 12000
        }
      ]
    },
    {
      "label": "identify intervals for multiple datapoints and devices per hour",
      "parameters": {
        "start_date": " '2020-01-20' ",
        "end_date": " '2020-01-30' "
      },
      "input_data": {
        "objectstat_diffs.accel_engine_torque_over_limit": [
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579946400000,
            "accel_engine_torque_over_limit_ms": 5000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 500,
            "time": 1579946400000,
            "accel_engine_torque_over_limit_ms": 5500
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579948200000,
            "accel_engine_torque_over_limit_ms": 5000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 500,
            "time": 1579948200000,
            "accel_engine_torque_over_limit_ms": 5500
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579950000000,
            "accel_engine_torque_over_limit_ms": 6000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 500,
            "time": 1579950000000,
            "accel_engine_torque_over_limit_ms": 6500
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579951800000,
            "accel_engine_torque_over_limit_ms": 6000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 500,
            "time": 1579951800000,
            "accel_engine_torque_over_limit_ms": 6500
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 0,
          "interval_start": "2020-01-25 10:00:00",
          "interval_end": "2020-01-25 11:00:00",
          "accel_engine_torque_over_limit_ms": 10000
        },
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 500,
          "driver_id": 0,
          "interval_start": "2020-01-25 10:00:00",
          "interval_end": "2020-01-25 11:00:00",
          "accel_engine_torque_over_limit_ms": 11000
        },
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 0,
          "interval_start": "2020-01-25 11:00:00",
          "interval_end": "2020-01-25 12:00:00",
          "accel_engine_torque_over_limit_ms": 12000
        },
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 500,
          "driver_id": 0,
          "interval_start": "2020-01-25 11:00:00",
          "interval_end": "2020-01-25 12:00:00",
          "accel_engine_torque_over_limit_ms": 13000
        }
      ]
    },
    {
      "label": "join driver assignment to datapoint when assignment covers whole interval",
      "parameters": {
        "start_date": " '2020-01-20' ",
        "end_date": " '2020-01-30' "
      },
      "input_data": {
        "objectstat_diffs.accel_engine_torque_over_limit": [
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579946400000,
            "accel_engine_torque_over_limit_ms": 5000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579950000000,
            "accel_engine_torque_over_limit_ms": 6000
          }
        ],
        "fuel_energy_efficiency_report.driver_assignments": [
          {
            "date": "2020-01-25",
            "org_id": 100,
            "device_id": 200,
            "driver_id": 300,
            "start_time": 1579946400000,
            "end_time": 1579953600000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 300,
          "interval_start": "2020-01-25 10:00:00",
          "interval_end": "2020-01-25 11:00:00",
          "accel_engine_torque_over_limit_ms": 5000
        },
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 300,
          "interval_start": "2020-01-25 11:00:00",
          "interval_end": "2020-01-25 12:00:00",
          "accel_engine_torque_over_limit_ms": 6000
        }
      ]
    },
    {
      "label": "join driver assignment to datapoint when assignment covers part of an interval",
      "parameters": {
        "start_date": " '2020-01-20' ",
        "end_date": " '2020-01-30' "
      },
      "input_data": {
        "objectstat_diffs.accel_engine_torque_over_limit": [
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579946400000,
            "accel_engine_torque_over_limit_ms": 5000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579950000000,
            "accel_engine_torque_over_limit_ms": 6000
          }
        ],
        "fuel_energy_efficiency_report.driver_assignments": [
          {
            "date": "2020-01-25",
            "org_id": 100,
            "device_id": 200,
            "driver_id": 300,
            "start_time": 1579946400000,
            "end_time": 1579948200000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 300,
          "interval_start": "2020-01-25 10:00:00",
          "interval_end": "2020-01-25 11:00:00",
          "accel_engine_torque_over_limit_ms": 5000
        },
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 0,
          "interval_start": "2020-01-25 11:00:00",
          "interval_end": "2020-01-25 12:00:00",
          "accel_engine_torque_over_limit_ms": 6000
        }
      ]
    },
    {
      "label": "exclude unrelated driver assignment even though it falls in interval",
      "parameters": {
        "start_date": " '2020-01-20' ",
        "end_date": " '2020-01-30' "
      },
      "input_data": {
        "objectstat_diffs.accel_engine_torque_over_limit": [
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579946400000,
            "accel_engine_torque_over_limit_ms": 5000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579950000000,
            "accel_engine_torque_over_limit_ms": 6000
          }
        ],
        "fuel_energy_efficiency_report.driver_assignments": [
          {
            "date": "2020-01-25",
            "org_id": 100,
            "device_id": 200,
            "driver_id": 300,
            "start_time": 1579946400000,
            "end_time": 1579948200000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "device_id": 200,
            "driver_id": 400,
            "start_time": 1579948200000,
            "end_time": 1579949100000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 300,
          "interval_start": "2020-01-25 10:00:00",
          "interval_end": "2020-01-25 11:00:00",
          "accel_engine_torque_over_limit_ms": 5000
        },
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 0,
          "interval_start": "2020-01-25 11:00:00",
          "interval_end": "2020-01-25 12:00:00",
          "accel_engine_torque_over_limit_ms": 6000
        }
      ]
    },
    {
      "label": "group coalesce ZERO and missing driver assignments for a datapoint due to partial driver assignment for data in interval",
      "parameters": {
        "start_date": " '2020-01-20' ",
        "end_date": " '2020-01-30' "
      },
      "input_data": {
        "objectstat_diffs.accel_engine_torque_over_limit": [
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579946400000,
            "accel_engine_torque_over_limit_ms": 5000
          },
          {
            "date": "2020-01-25",
            "org_id": 100,
            "object_id": 200,
            "time": 1579949100000,
            "accel_engine_torque_over_limit_ms": 6000
          }
        ],
        "fuel_energy_efficiency_report.driver_assignments": [
          {
            "date": "2020-01-25",
            "org_id": 100,
            "device_id": 200,
            "driver_id": 0,
            "start_time": 1579946400000,
            "end_time": 1579949100000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-01-25",
          "org_id": 100,
          "device_id": 200,
          "driver_id": 0,
          "interval_start": "2020-01-25 10:00:00",
          "interval_end": "2020-01-25 11:00:00",
          "accel_engine_torque_over_limit_ms": 11000
        }
      ]
    }
  ]
}

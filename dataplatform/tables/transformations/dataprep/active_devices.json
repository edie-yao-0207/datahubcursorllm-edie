{
  "name": "dataprep.active_devices",
  "owner": "DataEngineering",
  "description": "This table contains a daily snapshot of the active/inactive product devices and their associated trip summary for each Samsara organization.",
  "dependencies": [
    {
      "dbname": "productsdb",
      "tablename": "devices",
      "type": "table",
      "external": true
    },
    {
      "dbname": "clouddb",
      "tablename": "groups",
      "type": "table",
      "external": true
    },
    {
      "dbname": "trips2db_shards",
      "tablename": "trips",
      "type": "table",
      "external": true
    },
    {
      "dbname": "kinesisstats",
      "tablename": "osdhubserverdeviceheartbeat",
      "type": "table",
      "external": true
    },
    {
      "dbname": "oemdb_shards",
      "tablename": "oem_sources",
      "type": "table",
      "external": true
    },
    {
      "dbname": "definitions",
      "tablename": "445_calendar",
      "type": "table",
      "external": true
    }
  ],
  "parameters": ["start_date", "end_date"],
  "output": {
    "dbname": "dataprep",
    "tablename": "active_devices",
    "type": "table",
    "primary_key": ["device_id", "org_id", "date"],
    "partition": ["date"],
    "schema": [
      {
        "name": "date",
        "type": "string",
        "nullable": false,
        "metadata": {
          "comment": "The calendar date in 'YYYY-mm-dd' format"
        }
      },
      {
        "name": "device_id",
        "type": "long",
        "nullable": false,
        "metadata": {
          "comment": "The Samsara ID of the attached device"
        }
      },
      {
        "name": "product_id",
        "type": "long",
        "metadata": {
          "comment": "The internal ID of the Samsara product. [Preview in 'definitions.products'](https://amundsen.internal.samsara.com/table_detail/cluster/delta/definitions/products)"
        }
      },
      {
        "name": "org_id",
        "type": "long",
        "nullable": false,
        "metadata": {
          "comment": "$org_id_default_description"
        }
      },
      {
        "name": "active_heartbeat",
        "type": "boolean",
        "nullable": false,
        "metadata": {
          "comment": "A boolean flag indicating whether the device was active/inactive on 'date'"
        }
      },
      {
        "name": "trip_count",
        "type": "long",
        "metadata": {
          "comment": "The total number of trips recorded by the device"
        }
      },
      {
        "name": "total_distance",
        "type": "double",
        "metadata": {
          "comment": "The total distance (in meters) that the device has travelled"
        }
      }
    ],
    "write_mode": "merge"
  },
  "nonproduction": true
}

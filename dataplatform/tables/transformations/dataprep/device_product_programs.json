{
  "name": "dataprep.device_product_programs",
  "owner": "DataEngineering",
  "nonproduction": true,
  "description": "ATTENTION: This table should NEVER BE BACKFILLED! This table contains the product programs for every org and gateway id.",
  "dependencies": [
    {
      "external": true,
      "dbname": "kinesisstats",
      "tablename": "osdhubserverdeviceheartbeat",
      "type": "table"
    },
    {
      "external": true,
      "dbname": "firmwaredb",
      "tablename": "gateway_program_override_rollout_stages",
      "type": "table"
    },
    {
      "external": true,
      "dbname": "firmwaredb",
      "tablename": "org_program_override_rollout_stages",
      "type": "table"
    }
  ],
  "parameters": ["start_date", "end_date"],
  "output": {
    "dbname": "dataprep",
    "tablename": "device_product_programs",
    "type": "table",
    "write_mode": "merge",
    "partition": ["date"],
    "primary_key": ["date", "org_id", "device_id", "latest_gateway_id"],
    "schema": [
      {
        "name": "date",
        "type": "string",
        "nullable": false,
        "metadata": {
          "comment": "The date that the date of the recording of the device's heartbeat."
        }
      },
      {
        "name": "org_id",
        "type": "long",
        "metadata": {
          "comment": "This is the org_id the device belongs to."
        }
      },
      {
        "name": "device_id",
        "type": "long",
        "metadata": {
          "comment": "The id of the device that this heartbeat is associated with."
        }
      },
      {
        "name": "latest_gateway_id",
        "type": "long",
        "metadata": {
          "comment": "The id of the latest gateway the device was connected to."
        }
      },
      {
        "name": "product_program_id",
        "type": "short",
        "metadata": {
          "comment": "The is the program id assigned to the gateway or the org for firmware rollouts. Read this RFC for more details: [RFC](https://paper.dropbox.com/doc/Release-by-Program-RFC-NzlWyPen2Z1PRh9gMROcc)"
        }
      },
      {
        "name": "product_program_id_type",
        "type": "string",
        "metadata": {
          "comment": "The values indicate if the assigned product program id is at the org level or gateway level or any other level."
        }
      }
    ]
  }
}

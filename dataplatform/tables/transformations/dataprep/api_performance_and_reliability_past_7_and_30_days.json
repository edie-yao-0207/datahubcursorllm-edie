{
  "name": "dataprep.api_performance_and_reliability_past_7_and_30_days",
  "owner": "DataEngineering",
  "description": "This table contains api performance and reliability metrics for the last 7 and 30 days from execution for each endpoint",
  "dependencies": [
    {
      "dbname": "dataprep",
      "tablename": "api_reliability",
      "type": "table"
    }
  ],
  "output": {
    "dbname": "dataprep",
    "tablename": "api_performance_and_reliability_past_7_and_30_days",
    "type": "table",
    "primary_key": [
      "http_method",
      "path_template",
      "owning_team",
      "org_id",
      "org_name",
      "org_size_segment",
      "industry",
      "access_token_id",
      "token_name",
      "oauth_token_id",
      "oauth_token_app_uuid",
      "app_name"
    ],
    "schema": [
      {
        "name": "http_method",
        "type": "string",
        "metadata": {
          "comment": "The name of the http method (i.e., verb) in the api request"
        }
      },
      {
        "name": "path_template",
        "type": "string",
        "metadata": {
          "comment": "The path of the api endpoint"
        }
      },
      {
        "name": "owning_team",
        "type": "string",
        "metadata": {
          "comment": "The name of the team that owns the api"
        }
      },
      {
        "name": "org_id",
        "type": "long",
        "metadata": {
          "comment": "The ID of the org which called the api"
        }
      },
      {
        "name": "org_name",
        "type": "string",
        "metadata": {
          "comment": "The name of the org which called the api"
        }
      },
      {
        "name": "org_size_segment",
        "type": "string",
        "metadata": {
          "comment": "The size segment of the org which called the api -- (e.g., 'AE1', 'AE2/AE3', 'ENT')"
        }
      },
      {
        "name": "industry",
        "type": "string",
        "metadata": {
          "comment": "The industry of the org which called the api"
        }
      },
      {
        "name": "access_token_id",
        "type": "string",
        "metadata": {
          "comment": "The access token id which was used to invoke the api -- will be empty if access token was used oauth app"
        }
      },
      {
        "name": "token_name",
        "type": "string",
        "metadata": {
          "comment": "The name assocated with the access token id which was used to invoke the api -- will be empty if access token was used oauth app"
        }
      },
      {
        "name": "oauth_token_id",
        "type": "string",
        "metadata": {
          "comment": "The oauth token id which was used to invoke the api -- will be empty if access token was used instead"
        }
      },
      {
        "name": "oauth_token_app_uuid",
        "type": "string",
        "metadata": {
          "comment": "The uuid of the oauth app which was used to invoke the api -- will be empty if access token was used instead"
        }
      },
      {
        "name": "app_name",
        "type": "string",
        "metadata": {
          "comment": "The name of the oauth app which was used to invoke the api -- will be empty if access token was used instead"
        }
      },
      {
        "name": "num_requests_less_than_or_equal_to_5_seconds_daily_past_7_days",
        "type": "long",
        "metadata": {
          "comment": "The number of api requests in the past 7 days which took <= 5 seconds to complete"
        }
      },
      {
        "name": "num_requests_daily_past_7_days",
        "type": "long",
        "metadata": {
          "comment": "The total number of api requests in the past 7 days"
        }
      },
      {
        "name": "total_duration_ms_past_7_days",
        "type": "long",
        "metadata": {
          "comment": "The total time over the past 7 days it took to complete all of the api requests in ms"
        }
      },
      {
        "name": "num_fails_daily_past_7_days",
        "type": "long",
        "metadata": {
          "comment": "The number of api requests over the past 7 days whose responses returned with status codes 5xx"
        }
      },
      {
        "name": "num_requests_less_than_or_equal_to_5_seconds_daily_past_30_days",
        "type": "long",
        "metadata": {
          "comment": ""
        }
      },
      {
        "name": "num_requests_daily_past_30_days",
        "type": "long",
        "metadata": {
          "comment": "The number of api requests in the past 30 days which took <= 5 seconds to complete"
        }
      },
      {
        "name": "total_duration_ms_past_30_days",
        "type": "long",
        "metadata": {
          "comment": "The total time over the past 30 days it took to complete all of the api requests in ms"
        }
      },
      {
        "name": "num_fails_daily_past_30_days",
        "type": "long",
        "metadata": {
          "comment": "The number of api requests over the past 30 days whose responses returned with status codes 5xx"
        }
      },
      {
        "name": "performance_past_7_days",
        "type": "double",
        "metadata": {
          "comment": "The average request duration over the past 7 days in milliseconds -- (total_duration_ms_past_7_days / num_requests_daily_past_7_days)"
        }
      },
      {
        "name": "reliability_past_7_days",
        "type": "double",
        "metadata": {
          "comment": "The percentage of successful api requests over the past 7 days -- (num_requests_daily_past_7_days - num_fails_daily_past_7_days) / num_requests_daily_past_7_days"
        }
      },
      {
        "name": "percentage_of_requests_daily_less_than_or_equal_to_5_seconds_past_7_days",
        "type": "double",
        "metadata": {
          "comment": "The percentage of api requests in the past 7 days that completed in less than 5 seconds -- (num_requests_less_than_or_equal_to_5_seconds_daily_past_7_days / num_requests_daily_past_7_days) * 100"
        }
      },
      {
        "name": "performance_past_30_days",
        "type": "double",
        "metadata": {
          "comment": "The average request duration over the past 30 days in milliseconds -- (total_duration_ms_past_30_days / num_requests_daily_past_30_days)"
        }
      },
      {
        "name": "reliability_past_30_days",
        "type": "double",
        "metadata": {
          "comment": "The percentage of successful api requests over the past 30 days -- (num_requests_daily_past_30_days - num_fails_daily_past_30_days) / num_requests_daily_past_30_days"
        }
      },
      {
        "name": "percentage_of_requests_daily_less_than_or_equal_to_5_seconds_past_30_days",
        "type": "double",
        "metadata": {
          "comment": "The percentage of api requests in the past 30 days that completed in less than 5 seconds -- (num_requests_less_than_or_equal_to_5_seconds_daily_past_30_days / num_requests_daily_past_30_days) * 100"
        }
      },
      {
        "name": "complete_api_request",
        "type": "string",
        "metadata": {
          "comment": "The request line of the api request -- (http_method + ' ' + path_template)"
        }
      }
    ],
    "write_mode": "overwrite"
  },
  "nonproduction": true
}

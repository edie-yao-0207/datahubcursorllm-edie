{
  "test_cases": [
    {
      "label": "should outer join material-type specific nodes",
      "parameters": {
        "start_date": "'2020-01-01'",
        "end_date": "'2020-01-02'"
      },
      "input_data": {
        "material_usage_report.aggr_dry_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 15:00:00",
            "material_spread_mg_from_deltas": 888,
            "material_spread_mg_from_spread_rate": null,
            "distance_spread_meters_from_spread_rate": null,
            "duration_spread_ms_from_spread_rate": null
          }
        ],
        "material_usage_report.aggr_wet_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 16:00:00",
            "material_spread_ml_from_deltas": 1234,
            "material_spread_ml_from_spread_rate": null,
            "distance_spread_meters_from_spread_rate": null,
            "duration_spread_ms_from_spread_rate": null
          }
        ],
        "material_usage_report.aggr_prewet_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 17:00:00",
            "material_spread_ml_from_deltas": 42,
            "material_spread_ml_from_spread_rate": 43,
            "distance_spread_meters_from_spread_rate": 44,
            "duration_spread_ms_from_spread_rate": 45,
            "material_spread_ml_from_mix_rate": 46,
            "distance_spread_meters_from_mix_rate": 47,
            "duration_spread_ms_from_mix_rate": 48
          }
        ],
        "material_usage_report.time_driven_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "hour_start": "2020-01-01 15:00:00",
            "hour_end": "2020-01-01 16:00:00",
            "duration_driven_ms": 240000
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-01-01",
          "org_id": 1,
          "device_id": 1,
          "interval_start": "2020-01-01 15:00:00",
          "dry_quantity_spread_mg_from_deltas": 888,
          "dry_quantity_spread_mg_from_spread_rate": null,
          "dry_distance_spread_meters_from_spread_rate": null,
          "dry_duration_spread_ms_from_spread_rate": null,
          "wet_quantity_spread_ml_from_deltas": null,
          "wet_quantity_spread_ml_from_spread_rate": null,
          "wet_distance_spread_meters_from_spread_rate": null,
          "wet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_deltas": null,
          "prewet_quantity_spread_ml_from_spread_rate": null,
          "prewet_distance_spread_meters_from_spread_rate": null,
          "prewet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_mix_rate": null,
          "prewet_distance_spread_meters_from_mix_rate": null,
          "prewet_duration_spread_ms_from_mix_rate": null,
          "duration_driven_ms": 240000
        },
        {
          "date": "2020-01-01",
          "org_id": 1,
          "device_id": 1,
          "interval_start": "2020-01-01 16:00:00",
          "dry_quantity_spread_mg_from_deltas": null,
          "dry_quantity_spread_mg_from_spread_rate": null,
          "dry_distance_spread_meters_from_spread_rate": null,
          "dry_duration_spread_ms_from_spread_rate": null,
          "wet_quantity_spread_ml_from_deltas": 1234,
          "wet_quantity_spread_ml_from_spread_rate": null,
          "wet_distance_spread_meters_from_spread_rate": null,
          "wet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_deltas": null,
          "prewet_quantity_spread_ml_from_spread_rate": null,
          "prewet_distance_spread_meters_from_spread_rate": null,
          "prewet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_mix_rate": null,
          "prewet_distance_spread_meters_from_mix_rate": null,
          "prewet_duration_spread_ms_from_mix_rate": null,
          "duration_driven_ms": null
        },
        {
          "date": "2020-01-01",
          "org_id": 1,
          "device_id": 1,
          "interval_start": "2020-01-01 17:00:00",
          "dry_quantity_spread_mg_from_deltas": null,
          "dry_quantity_spread_mg_from_spread_rate": null,
          "dry_distance_spread_meters_from_spread_rate": null,
          "dry_duration_spread_ms_from_spread_rate": null,
          "wet_quantity_spread_ml_from_deltas": null,
          "wet_quantity_spread_ml_from_spread_rate": null,
          "wet_distance_spread_meters_from_spread_rate": null,
          "wet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_deltas": 42,
          "prewet_quantity_spread_ml_from_spread_rate": 43,
          "prewet_distance_spread_meters_from_spread_rate": 44,
          "prewet_duration_spread_ms_from_spread_rate": 45,
          "prewet_quantity_spread_ml_from_mix_rate": 46,
          "prewet_distance_spread_meters_from_mix_rate": 47,
          "prewet_duration_spread_ms_from_mix_rate": 48,
          "duration_driven_ms": null
        }
      ]
    },
    {
      "label": "should combine rows of the same interval start for pre_wet and wet",
      "parameters": {
        "start_date": "'2020-01-01'",
        "end_date": "'2020-01-02'"
      },
      "input_data": {
        "material_usage_report.aggr_dry_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 15:00:00",
            "material_spread_mg_from_deltas": 888,
            "material_spread_mg_from_spread_rate": null,
            "distance_spread_meters_from_spread_rate": null,
            "duration_spread_ms_from_spread_rate": null
          }
        ],
        "material_usage_report.aggr_wet_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 16:00:00",
            "material_spread_ml_from_deltas": 1234,
            "material_spread_ml_from_spread_rate": null,
            "distance_spread_meters_from_spread_rate": null,
            "duration_spread_ms_from_spread_rate": null
          }
        ],
        "material_usage_report.aggr_prewet_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 16:00:00",
            "material_spread_ml_from_deltas": 42,
            "material_spread_ml_from_spread_rate": 43,
            "distance_spread_meters_from_spread_rate": 44,
            "duration_spread_ms_from_spread_rate": 45,
            "material_spread_ml_from_mix_rate": 46,
            "distance_spread_meters_from_mix_rate": 47,
            "duration_spread_ms_from_mix_rate": 48
          }
        ],
        "material_usage_report.time_driven_by_hour": []
      },
      "expected_data": [
        {
          "date": "2020-01-01",
          "org_id": 1,
          "device_id": 1,
          "interval_start": "2020-01-01 15:00:00",
          "dry_quantity_spread_mg_from_deltas": 888,
          "dry_quantity_spread_mg_from_spread_rate": null,
          "dry_distance_spread_meters_from_spread_rate": null,
          "dry_duration_spread_ms_from_spread_rate": null,
          "wet_quantity_spread_ml_from_deltas": null,
          "wet_quantity_spread_ml_from_spread_rate": null,
          "wet_distance_spread_meters_from_spread_rate": null,
          "wet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_deltas": null,
          "prewet_quantity_spread_ml_from_spread_rate": null,
          "prewet_distance_spread_meters_from_spread_rate": null,
          "prewet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_mix_rate": null,
          "prewet_distance_spread_meters_from_mix_rate": null,
          "prewet_duration_spread_ms_from_mix_rate": null,
          "duration_driven_ms": null
        },
        {
          "date": "2020-01-01",
          "org_id": 1,
          "device_id": 1,
          "interval_start": "2020-01-01 16:00:00",
          "dry_quantity_spread_mg_from_deltas": null,
          "dry_quantity_spread_mg_from_spread_rate": null,
          "dry_distance_spread_meters_from_spread_rate": null,
          "dry_duration_spread_ms_from_spread_rate": null,
          "wet_quantity_spread_ml_from_deltas": 1234,
          "wet_quantity_spread_ml_from_spread_rate": null,
          "wet_distance_spread_meters_from_spread_rate": null,
          "wet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_deltas": 42,
          "prewet_quantity_spread_ml_from_spread_rate": 43,
          "prewet_distance_spread_meters_from_spread_rate": 44,
          "prewet_duration_spread_ms_from_spread_rate": 45,
          "prewet_quantity_spread_ml_from_mix_rate": 46,
          "prewet_distance_spread_meters_from_mix_rate": 47,
          "prewet_duration_spread_ms_from_mix_rate": 48,
          "duration_driven_ms": null
        }
      ]
    },
    {
      "label": "should combine rows of the same interval start for dry and wet",
      "parameters": {
        "start_date": "'2020-01-01'",
        "end_date": "'2020-01-02'"
      },
      "input_data": {
        "material_usage_report.aggr_dry_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 15:00:00",
            "material_spread_mg_from_deltas": 888,
            "material_spread_mg_from_spread_rate": null,
            "distance_spread_meters_from_spread_rate": null,
            "duration_spread_ms_from_spread_rate": null
          }
        ],
        "material_usage_report.aggr_wet_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 15:00:00",
            "material_spread_ml_from_deltas": 1234,
            "material_spread_ml_from_spread_rate": null,
            "distance_spread_meters_from_spread_rate": null,
            "duration_spread_ms_from_spread_rate": null
          }
        ],
        "material_usage_report.aggr_prewet_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 16:00:00",
            "material_spread_ml_from_deltas": 42,
            "material_spread_ml_from_spread_rate": 43,
            "distance_spread_meters_from_spread_rate": 44,
            "duration_spread_ms_from_spread_rate": 45,
            "material_spread_ml_from_mix_rate": 46,
            "distance_spread_meters_from_mix_rate": 47,
            "duration_spread_ms_from_mix_rate": 48
          }
        ],
        "material_usage_report.time_driven_by_hour": []
      },
      "expected_data": [
        {
          "date": "2020-01-01",
          "org_id": 1,
          "device_id": 1,
          "interval_start": "2020-01-01 15:00:00",
          "dry_quantity_spread_mg_from_deltas": 888,
          "dry_quantity_spread_mg_from_spread_rate": null,
          "dry_distance_spread_meters_from_spread_rate": null,
          "dry_duration_spread_ms_from_spread_rate": null,
          "wet_quantity_spread_ml_from_deltas": 1234,
          "wet_quantity_spread_ml_from_spread_rate": null,
          "wet_distance_spread_meters_from_spread_rate": null,
          "wet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_deltas": null,
          "prewet_quantity_spread_ml_from_spread_rate": null,
          "prewet_distance_spread_meters_from_spread_rate": null,
          "prewet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_mix_rate": null,
          "prewet_distance_spread_meters_from_mix_rate": null,
          "prewet_duration_spread_ms_from_mix_rate": null,
          "duration_driven_ms": null
        },
        {
          "date": "2020-01-01",
          "org_id": 1,
          "device_id": 1,
          "interval_start": "2020-01-01 16:00:00",
          "dry_quantity_spread_mg_from_deltas": null,
          "dry_quantity_spread_mg_from_spread_rate": null,
          "dry_distance_spread_meters_from_spread_rate": null,
          "dry_duration_spread_ms_from_spread_rate": null,
          "wet_quantity_spread_ml_from_deltas": null,
          "wet_quantity_spread_ml_from_spread_rate": null,
          "wet_distance_spread_meters_from_spread_rate": null,
          "wet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_deltas": 42,
          "prewet_quantity_spread_ml_from_spread_rate": 43,
          "prewet_distance_spread_meters_from_spread_rate": 44,
          "prewet_duration_spread_ms_from_spread_rate": 45,
          "prewet_quantity_spread_ml_from_mix_rate": 46,
          "prewet_distance_spread_meters_from_mix_rate": 47,
          "prewet_duration_spread_ms_from_mix_rate": 48,
          "duration_driven_ms": null
        }
      ]
    },
    {
      "label": "should combine rows of the same interval start for dry and prewet",
      "parameters": {
        "start_date": "'2020-01-01'",
        "end_date": "'2020-01-02'"
      },
      "input_data": {
        "material_usage_report.aggr_dry_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 16:00:00",
            "material_spread_mg_from_deltas": 888,
            "material_spread_mg_from_spread_rate": null,
            "distance_spread_meters_from_spread_rate": null,
            "duration_spread_ms_from_spread_rate": null
          }
        ],
        "material_usage_report.aggr_wet_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 15:00:00",
            "material_spread_ml_from_deltas": 1234,
            "material_spread_ml_from_spread_rate": null,
            "distance_spread_meters_from_spread_rate": null,
            "duration_spread_ms_from_spread_rate": null
          }
        ],
        "material_usage_report.aggr_prewet_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 16:00:00",
            "material_spread_ml_from_deltas": 42,
            "material_spread_ml_from_spread_rate": 43,
            "distance_spread_meters_from_spread_rate": 44,
            "duration_spread_ms_from_spread_rate": 45,
            "material_spread_ml_from_mix_rate": 46,
            "distance_spread_meters_from_mix_rate": 47,
            "duration_spread_ms_from_mix_rate": 48
          }
        ],
        "material_usage_report.time_driven_by_hour": []
      },
      "expected_data": [
        {
          "date": "2020-01-01",
          "org_id": 1,
          "device_id": 1,
          "interval_start": "2020-01-01 15:00:00",
          "dry_quantity_spread_mg_from_deltas": null,
          "dry_quantity_spread_mg_from_spread_rate": null,
          "dry_distance_spread_meters_from_spread_rate": null,
          "dry_duration_spread_ms_from_spread_rate": null,
          "wet_quantity_spread_ml_from_deltas": 1234,
          "wet_quantity_spread_ml_from_spread_rate": null,
          "wet_distance_spread_meters_from_spread_rate": null,
          "wet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_deltas": null,
          "prewet_quantity_spread_ml_from_spread_rate": null,
          "prewet_distance_spread_meters_from_spread_rate": null,
          "prewet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_mix_rate": null,
          "prewet_distance_spread_meters_from_mix_rate": null,
          "prewet_duration_spread_ms_from_mix_rate": null,
          "duration_driven_ms": null
        },
        {
          "date": "2020-01-01",
          "org_id": 1,
          "device_id": 1,
          "interval_start": "2020-01-01 16:00:00",
          "dry_quantity_spread_mg_from_deltas": 888,
          "dry_quantity_spread_mg_from_spread_rate": null,
          "dry_distance_spread_meters_from_spread_rate": null,
          "dry_duration_spread_ms_from_spread_rate": null,
          "wet_quantity_spread_ml_from_deltas": null,
          "wet_quantity_spread_ml_from_spread_rate": null,
          "wet_distance_spread_meters_from_spread_rate": null,
          "wet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_deltas": 42,
          "prewet_quantity_spread_ml_from_spread_rate": 43,
          "prewet_distance_spread_meters_from_spread_rate": 44,
          "prewet_duration_spread_ms_from_spread_rate": 45,
          "prewet_quantity_spread_ml_from_mix_rate": 46,
          "prewet_distance_spread_meters_from_mix_rate": 47,
          "prewet_duration_spread_ms_from_mix_rate": 48,
          "duration_driven_ms": null
        }
      ]
    },
    {
      "label": "should combine rows of the same interval start for dry and prewet",
      "parameters": {
        "start_date": "'2020-01-01'",
        "end_date": "'2020-01-02'"
      },
      "input_data": {
        "material_usage_report.aggr_dry_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 16:00:00",
            "material_spread_mg_from_deltas": 888,
            "material_spread_mg_from_spread_rate": null,
            "distance_spread_meters_from_spread_rate": null,
            "duration_spread_ms_from_spread_rate": null
          }
        ],
        "material_usage_report.aggr_wet_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 16:00:00",
            "material_spread_ml_from_deltas": 1234,
            "material_spread_ml_from_spread_rate": null,
            "distance_spread_meters_from_spread_rate": null,
            "duration_spread_ms_from_spread_rate": null
          }
        ],
        "material_usage_report.aggr_prewet_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 16:00:00",
            "material_spread_ml_from_deltas": 42,
            "material_spread_ml_from_spread_rate": 43,
            "distance_spread_meters_from_spread_rate": 44,
            "duration_spread_ms_from_spread_rate": 45,
            "material_spread_ml_from_mix_rate": 46,
            "distance_spread_meters_from_mix_rate": 47,
            "duration_spread_ms_from_mix_rate": 48
          }
        ],
        "material_usage_report.time_driven_by_hour": []
      },
      "expected_data": [
        {
          "date": "2020-01-01",
          "org_id": 1,
          "device_id": 1,
          "interval_start": "2020-01-01 16:00:00",
          "dry_quantity_spread_mg_from_deltas": 888,
          "dry_quantity_spread_mg_from_spread_rate": null,
          "dry_distance_spread_meters_from_spread_rate": null,
          "dry_duration_spread_ms_from_spread_rate": null,
          "wet_quantity_spread_ml_from_deltas": 1234,
          "wet_quantity_spread_ml_from_spread_rate": null,
          "wet_distance_spread_meters_from_spread_rate": null,
          "wet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_deltas": 42,
          "prewet_quantity_spread_ml_from_spread_rate": 43,
          "prewet_distance_spread_meters_from_spread_rate": 44,
          "prewet_duration_spread_ms_from_spread_rate": 45,
          "prewet_quantity_spread_ml_from_mix_rate": 46,
          "prewet_distance_spread_meters_from_mix_rate": 47,
          "prewet_duration_spread_ms_from_mix_rate": 48,
          "duration_driven_ms": null
        }
      ]
    },
    {
      "label": "should not output rows for which there is only duration driven data",
      "parameters": {
        "start_date": "'2020-01-01'",
        "end_date": "'2020-01-02'"
      },
      "input_data": {
        "material_usage_report.aggr_dry_material_spread_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "interval_start": "2020-01-01 15:00:00",
            "material_spread_mg_from_deltas": 888,
            "material_spread_mg_from_spread_rate": null,
            "distance_spread_meters_from_spread_rate": null,
            "duration_spread_ms_from_spread_rate": null
          }
        ],
        "material_usage_report.aggr_wet_material_spread_by_hour": [],
        "material_usage_report.aggr_prewet_material_spread_by_hour": [],
        "material_usage_report.time_driven_by_hour": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "hour_start": "2020-01-01 15:00:00",
            "hour_end": "2020-01-01 16:00:00",
            "duration_driven_ms": 240000
          },
          {
            "date": "2020-01-01",
            "org_id": 1,
            "device_id": 1,
            "hour_start": "2020-01-01 16:00:00",
            "hour_end": "2020-01-01 17:00:00",
            "duration_driven_ms": 12345
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-01-01",
          "org_id": 1,
          "device_id": 1,
          "interval_start": "2020-01-01 15:00:00",
          "dry_quantity_spread_mg_from_deltas": 888,
          "dry_quantity_spread_mg_from_spread_rate": null,
          "dry_distance_spread_meters_from_spread_rate": null,
          "dry_duration_spread_ms_from_spread_rate": null,
          "wet_quantity_spread_ml_from_deltas": null,
          "wet_quantity_spread_ml_from_spread_rate": null,
          "wet_distance_spread_meters_from_spread_rate": null,
          "wet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_deltas": null,
          "prewet_quantity_spread_ml_from_spread_rate": null,
          "prewet_distance_spread_meters_from_spread_rate": null,
          "prewet_duration_spread_ms_from_spread_rate": null,
          "prewet_quantity_spread_ml_from_mix_rate": null,
          "prewet_distance_spread_meters_from_mix_rate": null,
          "prewet_duration_spread_ms_from_mix_rate": null,
          "duration_driven_ms": 240000
        }
      ]
    }
  ]
}

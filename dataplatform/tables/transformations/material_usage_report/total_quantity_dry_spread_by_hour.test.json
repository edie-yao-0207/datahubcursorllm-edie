{
  "test_cases": [
    {
      "label": "object stats not in the date range should not create any intervals",
      "parameters": {
        "start_date": "'2020-12-28'",
        "end_date": "'2020-12-29'"
      },
      "input_data": {
        "kinesisstats.osdsaltspreaderquantityspreaddrymilligrams": [
          {
            "date": "2020-01-01",
            "org_id": 1,
            "object_id": 1,
            "time": 1577923190000,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "int_value": 10
            }
          }
        ]
      },
      "expected_data": []
    },
    {
      "label": "invalid object stats in the date range should not create any intervals",
      "parameters": {
        "start_date": "'2020-12-28'",
        "end_date": "'2020-12-29'"
      },
      "input_data": {
        "kinesisstats.osdsaltspreaderquantityspreaddrymilligrams": [
          {
            "date": "2020-12-28",
            "org_id": 1,
            "object_id": 1,
            "time": 1609156800000,
            "value": {
              "is_databreak": true,
              "is_end": false,
              "int_value": 10
            }
          }
        ]
      },
      "expected_data": []
    },
    {
      "label": "should exclude stats >= 10^9",
      "parameters": {
        "start_date": "'2020-12-28'",
        "end_date": "'2020-12-29'"
      },
      "input_data": {
        "kinesisstats.osdsaltspreaderquantityspreaddrymilligrams": [
          {
            "date": "2020-12-28",
            "org_id": 1,
            "object_id": 1,
            "time": 1609156800000,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "int_value": 1000000000
            }
          }
        ]
      },
      "expected_data": []
    },
    {
      "label": "one delta stat should create one hourly interval",
      "parameters": {
        "start_date": "'2020-12-28'",
        "end_date": "'2020-12-29'"
      },
      "input_data": {
        "kinesisstats.osdsaltspreaderquantityspreaddrymilligrams": [
          {
            "date": "2020-12-28",
            "org_id": 1,
            "object_id": 1,
            "time": 1609156800000,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "int_value": 10
            }
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-12-28",
          "org_id": 1,
          "device_id": 1,
          "hour_start": "2020-12-28 12:00:00",
          "total_quantity_spread": 10
        }
      ]
    },
    {
      "label": "delta stats of different hours should create two hourly intervals",
      "parameters": {
        "start_date": "'2020-12-28'",
        "end_date": "'2020-12-29'"
      },
      "input_data": {
        "kinesisstats.osdsaltspreaderquantityspreaddrymilligrams": [
          {
            "date": "2020-12-28",
            "org_id": 1,
            "object_id": 1,
            "time": 1609156800000,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "int_value": 10
            }
          },
          {
            "date": "2020-12-28",
            "org_id": 1,
            "object_id": 1,
            "time": 1609164000000,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "int_value": 20
            }
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-12-28",
          "org_id": 1,
          "device_id": 1,
          "hour_start": "2020-12-28 12:00:00",
          "total_quantity_spread": 10
        },
        {
          "date": "2020-12-28",
          "org_id": 1,
          "device_id": 1,
          "hour_start": "2020-12-28 14:00:00",
          "total_quantity_spread": 20
        }
      ]
    },
    {
      "label": "multiple deltas stats should be aggregated in the same hourly interval if they occurred in the same hour",
      "parameters": {
        "start_date": "'2020-12-28'",
        "end_date": "'2020-12-29'"
      },
      "input_data": {
        "kinesisstats.osdsaltspreaderquantityspreaddrymilligrams": [
          {
            "date": "2020-12-28",
            "org_id": 1,
            "object_id": 1,
            "time": 1609156800000,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "int_value": 10
            }
          },
          {
            "date": "2020-12-28",
            "org_id": 1,
            "object_id": 1,
            "time": 1609158600000,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "int_value": 20
            }
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-12-28",
          "org_id": 1,
          "device_id": 1,
          "hour_start": "2020-12-28 12:00:00",
          "total_quantity_spread": 30
        }
      ]
    },
    {
      "label": "delta stats for a spreader interval that spans multiple days should have date column associated with time of stat",
      "parameters": {
        "start_date": "'2020-12-28'",
        "end_date": "'2020-12-29'"
      },
      "input_data": {
        "kinesisstats.osdsaltspreaderquantityspreaddrymilligrams": [
          {
            "date": "2020-12-28",
            "org_id": 1,
            "object_id": 1,
            "time": 1609199118000,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "int_value": 10
            }
          },
          {
            "date": "2020-12-28",
            "org_id": 1,
            "object_id": 1,
            "time": 1609200198000,
            "value": {
              "is_databreak": false,
              "is_end": false,
              "int_value": 20
            }
          }
        ]
      },
      "expected_data": [
        {
          "date": "2020-12-28",
          "org_id": 1,
          "device_id": 1,
          "hour_start": "2020-12-28 23:00:00",
          "total_quantity_spread": 10
        },
        {
          "date": "2020-12-29",
          "org_id": 1,
          "device_id": 1,
          "hour_start": "2020-12-29 00:00:00",
          "total_quantity_spread": 20
        }
      ]
    }
  ]
}
